!function(e){function t(t){for(var o,a,c=t[0],s=t[1],l=t[2],p=0,h=[];p<c.length;p++)a=c[p],r[a]&&h.push(r[a][0]),r[a]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(u&&u(t);h.length;)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={1:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=s;i.push([137,2,0]),n()}({119:function(e,t,n){},124:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){},130:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){"use strict";n.r(t);var o=n(9),r=n.n(o),i=n(0),a=n.n(i),c=n(61),s=n.n(c);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={};function p(e){"function"==typeof e.onChange&&e.onChange(u)}var h={store:u,onChange:new Function,fill:function(e,t){var n=this,o=!1;if(!1===t)return u=this.store=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){l(e,t,n[t])})}return e}({},u,e),void p(this);Object.keys(e).map(function(t){o=n.set(t,e[t],!0)||o}),o&&!t&&p(this)},set:function(e,t,n){return!1===n?(u[e]=t,p(this),!0):!s()(u[e],t)&&(u[e]=t,n||p(this),!0)},get:function(e){return u[e]}},f=(n(72),n(2)),m=new f.PointLight(16777215);m.position.set(0,2e3,0),m.tc={birth:new Date,add:!0};var d=navigator.userAgent.toLowerCase().indexOf("macintosh")>-1,y=d?{C:"⌘",A:"⌥",S:"⇧"}:{C:"Ctrl + ",A:"Alt + ",S:"Shift + "},b=.5,g={timer:0,rootPrefix:"/__tceditor__",root:"",path:"",compressMode:2,mesh3d:{},lights:{defaultLight:m},selectedMesh:null,selectedVector:null,selectedVectorIndex:-1,selectedLight:null,activeGroup:"default group",panel:[],group:[{label:"default group",expend:!0}],stage:{colorStage:["#3D3D3D",4013373],colorGrid:["#8F908A",9408650],camera3D:{cameraRadius:2500,cameraAngleA:40,cameraAngleB:45,lookAt:{x:0,y:0,z:0}},gridVisible:!0,gridSize3D:5e3,gridStep3D:50},mouse3d:{x:0,y:0,z:0},view:"all",tool:"moveCamera",transformer3Dinfo:{mode:"translate",size:1,space:"world"},morpher3Dinfo:{anchorColor:52480,anchorSize:1e3}},v={editorTitle:"TcEditor 5",arrestedHotKey:["f1","ctrl + h","ctrl + o","ctrl + s","ctrl + shift + i","ctrl + shift + o","ctrl + d","ctrl + f","ctrl + g","ctrl + e"],colors:{normalMeshHover:[16776960,"#d97915"],selectedMesh:[14252309,"#d97915"]},menu:[{label:"File",children:[{label:"New",value:"newFile"},{label:"Open",value:"openFile",hotKey:"".concat(y.C,"O")},{label:"Save",value:"saveFile",hotKey:"".concat(y.C,"S")},{label:"Save As",value:"saveFileAs",hotKey:"".concat(y.C).concat(y.S,"S")},{label:"Import",value:"importFile",hotKey:"".concat(y.C).concat(y.S,"I")},{label:"Export",value:"exportFile",hotKey:"".concat(y.C).concat(y.S,"O")}]},{label:"View",key:"view",children:[{label:"Mesh List",value:"openPanel meshPanel",key:"meshPanel"},{label:"Light List",value:"openPanel lightPanel",key:"lightPanel"},{label:"Geometry Editor",value:"openPanel geoEditor",key:"geoEditor"},{label:"Material Editor",value:"openPanel mtlEditor",key:"mtlEditor"}]},{label:"Geometry",key:"geometry",children:[{label:"Plane",value:"changeTool createPlane"},{label:"Sphere",value:"changeTool createSphere"}]},{label:"Help",children:[{label:"Hotkey",value:"popHotkeyInfo",hotKey:d?"".concat(y.C,"H"):"F1"}]}],command:["VIEWS",{label:"3D",value:"changeView 3d",title:"3D view (".concat(y.A,"1)")},{label:"XOZ",value:"changeView xoz",title:"XOZ view (".concat(y.A,"2)")},{label:"XOY",value:"changeView xoy",title:"XOY view (".concat(y.A,"3)")},{label:"ZOY",value:"changeView zoy",title:"ZOY view (".concat(y.A,"4)")},{icon:"tc-icon-screen4",value:"changeView all",title:"ALL view (".concat(y.A,"5)")},"TOOLS",{icon:"tc-icon-pickup-mesh",value:"changeTool pickMesh",title:"pick up geometry (".concat(y.C,"D)")},{icon:"tc-icon-pickup-joint",value:"changeTool pickJoint",title:"pick up joint (".concat(y.C,"F)")},{icon:"tc-icon-light",value:"pickLight",title:"pick up light (".concat(y.C,"G)")},"CAMERA",{icon:"tc-icon-trans",value:"moveCamera",title:"move camera (".concat(y.C,"E)")},{icon:"tc-icon-zoom-in",value:"zoomInCamera",title:"zoom in (MOUSE WHEEL UP)"},{icon:"tc-icon-zoom-out",value:"zoomOutCamera",title:"zoom out (MOUSE WHEEL DOWN)"},{icon:"tc-icon-reset",value:"resetCamera",title:"reset camera"},"GRID",{icon:"tc-icon-enlarge",value:"enlargeGrid",title:"enlarge grid"},{icon:"tc-icon-narrow",value:"narrowGrid",title:"narrow grid"},{icon:"tc-icon-visible",value:"toggleHelper",title:"hide/show stage helper"}],transformer3DTools:[{icon:"tc-icon-trans",value:"setTransformerMode translate",title:"(".concat(y.A,"Q)")},{icon:"tc-icon-rotate",value:"setTransformerMode rotate",title:"(".concat(y.A,"Q)")},{icon:"tc-icon-plus",value:"setTransformerSize enlarge"},{icon:"tc-icon-minus",value:"setTransformerSize"},{icon:"tc-icon-earth",value:"toggleTransformerSpace space"}],morpher3DTools:[{icon:"tc-icon-color",value:"setMorpherColor"},{icon:"tc-icon-plus",value:"setMorpherSize enlarge"},{icon:"tc-icon-minus",value:"setMorpherSize"}]};function k(e,t,n){n=-n;var o=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),r=-t.x/o,i=-t.y/o,a=-t.z/o,c=Math.cos(n),s=Math.sin(n),l=1-c;return{x:e.x*(r*r*l+c)+e.y*(r*i*l-a*s)+e.z*(r*a*l+i*s),y:e.x*(r*i*l+a*s)+e.y*(i*i*l+c)+e.z*(i*a*l-r*s),z:e.x*(r*a*l-i*s)+e.y*(i*a*l+r*s)+e.z*(a*a*l+c)}}function w(e){var t={x:1,y:0,z:0},n={x:0,y:1,z:0},o={x:0,y:0,z:1};return n=k(n,t,e.rotation.x),o=k(o,t,e.rotation.x),t=k(t,n,e.rotation.y),o=k(o,n,e.rotation.y),t=k(t,o,e.rotation.z),n=k(n,o,e.rotation.z),[[t.x,n.x,o.x],[t.y,n.y,o.y],[t.z,n.z,o.z]]}function O(e,t,n,o){var r=e-o.position.x,i=t-o.position.y,a=n-o.position.z,c=w(o),s=c[0][0],l=c[0][1],u=c[0][2],p=c[1][0],h=c[1][1],f=c[1][2],m=c[2][0],d=c[2][1],y=c[2][2],b=s*h*y+l*f*m+u*p*d-u*h*m-l*p*y-s*f*d,g=(r*h*y+l*f*a+u*i*d-u*h*a-l*i*y-r*f*d)/b,v=(s*i*y+r*f*m+u*p*a-u*i*m-r*p*y-s*f*a)/b,k=(s*h*a+l*i*m+r*p*d-r*h*m-l*p*a-s*i*d)/b;return[g/=o.scale.x,v/=o.scale.y,k/=o.scale.z]}function x(e,t,n,o,r){var i=function(e,t,n,o){return[e*o.x,t*o.y,n*o.z]}(e,t,n,r.scale);return i=function(e,t,n,o){return[e+o.x,t+o.y,n+o.z]}((i=function(e,t,n,o){return[o[0][0]*e+o[0][1]*t+o[0][2]*n,o[1][0]*e+o[1][1]*t+o[1][2]*n,o[2][0]*e+o[2][1]*t+o[2][2]*n]}(i[0],i[1],i[2],o))[0],i[1],i[2],r.position)}function C(e){var t=e.vertices,n={};return t.map(function(e,t){n[t]=[]}),t.map(function(e,o){t.map(function(t,r){o!==r&&(t.distanceTo(e)>1||n[o].push(r))})}),Object.keys(n).map(function(e){0===n[e].length&&delete n[e]}),n}var M={getVectorLinkHash:C,getRotateMatrix:w,world2local:O,local2world:x,axis2screen:function(e,t,n,o,r,i,a,c){var s,l,u;switch(r=r instanceof Array&&2===r.length?r:[0,0],i=i||1,a=a||0,s=Math.sin(Math.PI*a/180),l=Math.cos(Math.PI*a/180),e-=r[0],t-=r[1],u=(t/=i)*l-(e/=i)*s,e=e*l+t*s,t=u,c.v){case"xoz":e+=.5*n,t=c.a>=0?t+.5*o:.5*o-t;break;case"xoy":e=c.b<=180?e+.5*n:.5*n-e,t=.5*o-t;break;case"zoy":e=c.b<=90||c.b>=315?.5*n-e:e+.5*n,t=.5*o-t;break;default:e+=.5*n,t=.5*o-t}return[e,t]},screen2axis:function(e,t,n,o,r,i,a,c){var s,l,u;switch(r=r instanceof Array&&2===r.length?r:[0,0],i=i||1,a=a||0,s=Math.sin(-Math.PI*a/180),l=Math.cos(-Math.PI*a/180),c.v){case"xoz":e-=.5*n,t=c.a>=0?t-.5*o:.5*o-t;break;case"xoy":e=c.b<=180?e-.5*n:.5*n-e,t=.5*o-t;break;case"zoy":e=c.b<=90||c.b>=315?.5*n-e:e-.5*n,t=.5*o-t;break;default:e-=.5*n,t=.5*o-t}return u=t*l-e*s,e=e*l+t*s,t=u,e*=i,t*=i,[e+=r[0],t+=r[1]]}};function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){P(e,t,n[t])})}return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){E(e,t,n[t])})}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _=function(e,t){return t&&"object"===A(e)&&Math.abs(e.cameraInfo.angleA)>2&&!(0===e.mouseDelta3D.x&&0===e.mouseDelta3D.y&&0===e.mouseDelta3D.z)},z=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2,z:(e.z+t.z)/2}},I=function(){return new f.MeshPhongMaterial({color:16777215,flatShading:f.FlatShading,side:f.DoubleSide})};function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e,t){var n=t.get("selectedLight");return"string"==typeof n&&n===e||!(!n||!n.tc||n.tc.lightKey!==e)};function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=n(3),V={},B=!1;document.body.addEventListener("keydown",function(e){0===e.code.indexOf("Meta")&&(B=!0);var t,n,o=(t=e,n="",(!d&&t.ctrlKey||d&&B)&&(n="ctrl + "),t.altKey&&(n+="alt + "),t.shiftKey&&(n+="shift + "),n+=t.code.replace("Key","").toLowerCase());if(V[o]instanceof Array&&V[o].length&&V[o].map(function(e){return e()}),v.arrestedHotKey.indexOf(o)>-1)return e.preventDefault(),!1}),document.body.addEventListener("keyup",function(e){0===e.code.indexOf("Meta")&&(B=!1)});var F={on:function(e,t){"string"==typeof e&&e.length&&"function"==typeof t&&(e=e.indexOf(",")>-1?e.split(","):[e]).forEach(function(e){V[e]=V[e]||[],V[e].filter(function(e){return e===t}).length||V[e].push(t)})},un:function(e,t){"string"==typeof e&&e.length&&"function"==typeof t&&(e=e.indexOf(",")>-1?e.split(","):[e]).forEach(function(e){V[e]=V[e]||[],V[e]=V[e].filter(function(e){return e!==t})})}};function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=n(13),W=n.n(U),J=n(62),q=n.n(J);function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){X(e,t,n[t])})}return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var K=function(e){var t=e.store,n={},o={},r={};Object.keys(t.mesh3d).map(function(e){var o=function(e){var t=e.toJSON();return t.tc=Y({},e.tc),t.tc.birth=t.tc.birth.getTime(),delete t.tc.vectorLinkHash,t.geometries[0].vertices=JSON.parse(JSON.stringify(e.geometry.vertices)),t.materials[0].color=t.tc.materialColor,t.materials[0].emissive=t.tc.materialEmissive,t.materials[0].opacity=t.tc.materialOpacity,t}(t.mesh3d[e]);o.images instanceof Array&&o.images.map(function(e){var t=e.uuid;Object.keys(r).map(function(n){r[n]===e.url&&(t=n)}),o.textures instanceof Array&&o.textures.map(function(n){n.image===e.uuid&&(n.image=t)}),r[t]=e.url}),delete o.images,function(e,t){0!==t&&e.geometries.map(function(e){var n=[];e.vertices.map(function(e){n.push(1*parseFloat(e.x).toFixed(t)),n.push(1*parseFloat(e.y).toFixed(t)),n.push(1*parseFloat(e.z).toFixed(t))}),e.vertices=n})}(o,t.compressMode),n[e]=o}),Object.keys(t.lights).map(function(e){var n,r;o[e]=(n=t.lights[e],(r=n.toJSON()).tc=Y({},n.tc),r)});var i=function(e,t){var n={};return Object.keys(e).map(function(o){if(!(t.indexOf(o)>-1))try{n[o]=JSON.parse(JSON.stringify(e[o]))}catch(t){n[o]=e[o]}}),n}(t,["timer","path","mesh3d","lights","selectedMesh","selectedVector","selectedVectorIndex","selectedLight"].concat(Object.keys(v)));return{meshes:n,lights:o,images:r,editor:i}},Z=n(63),Q={},$=new(n.n(Z).a);function ee(e){return new Promise(function(t,n){var o=e.files[0];if(0===o.type.indexOf("image/")){var r=o.lastModified+"."+o.size+"."+o.name,i=Q[r];if(i)t(i);else{var a=new FileReader;a.onload=function(e){var n=document.createElement("img");n.src=e.target.result,n.onload=function(){Q[r]=n,t(n)}},a.onerror=function(){n()},a.readAsDataURL(o)}}else n()})}function te(e,t){return new Promise(function(n){var o=null;if(Object.keys(Q).map(function(e){Q[e].src===t&&(o=Q[e])}),o)n(o);else{var r=document.createElement("img");r.src=t,Q[e]=r,n(r)}})}$.uploadImage=ee,$.uploadFromBrowser=function(e){var t=document.createElement("input");return t.type="file",t.style.cssText="visibility:hidden;",document.body.appendChild(t),new Promise(function(n,o){t.onchange=function(r){document.body.removeChild(t);var i=r.target.files[0];if(e&&i.name.split(".").pop()!==e)o();else{var a=new FileReader;a.onload=function(e){n(e)},a.onerror=function(){o()},a.readAsArrayBuffer(i)}},t.click()})},$.importImage=te;var ne=$;function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e,t,n){return(re=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&ie(r,n.prototype),r}).apply(null,arguments)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ce(e,t){var n=function(e){var t=e.geometries[0];if("function"!=typeof f[t.type])return null;var n=[];switch(t.type){case"PlaneGeometry":n=[t.width,t.height,t.widthSegments,t.heightSegments];break;case"SphereGeometry":n=[t.radius,t.widthSegments,t.heightSegments];break;default:return null}for(var o=re(f[t.type],ae(n)),r=0;r<t.vertices.length;r+=3){var i=parseInt(r/3,10);if(!o.vertices[i])break;o.vertices[i].x=t.vertices[r],o.vertices[i].y=t.vertices[r+1],o.vertices[i].z=t.vertices[r+2]}return o.verticesNeedUpdate=!0,o}(e),o=function(e,t){var n=e.materials[0];if("function"==typeof f[n.type]){var o={color:e.tc.materialColor,emissive:e.tc.materialEmissive,side:n.side};["opacity","wireframe"].map(function(e){n.hasOwnProperty(e)&&(o[e]=n[e],"opacity"===e&&(o.transparent=n[e]<1))});var r=new f[n.type](o);return e.textures instanceof Array&&e.textures.length&&t.images[e.textures[0].image]&&te(e.textures[0].image,t.images[e.textures[0].image]).then(function(e){r.map=new f.Texture(e),r.map.needsUpdate=!0,r.needsUpdate=!0}),r}}(e,t);if(!n)return null;var r=new f.Mesh(n,o);return r.tc=e.tc,r.tc.birth=new Date(e.tc.birth),r.tc.add=!1,r.tc.materialOpacity=o.opacity,r.tc.vectorLinkHash=M.getVectorLinkHash(n),r}var se=function(e,t){var n={timer:+new Date};return n.mesh3d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){oe(e,t,n[t])})}return e}({},e.store.mesh3d),Object.keys(t.meshes).map(function(e){var o,r,i=t.meshes[e],a=ce(i,t);a&&(a.applyMatrix((o=i.object.matrix,(r=new f.Matrix4).set(o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]),r)),n.mesh3d[a.uuid]=a)}),n.group=[].concat(e.store.group),t.editor.group.map(function(e){for(var t=0;t<n.group.length;t++)if(n.group[t].label===e.label)return;n.group.push(e)}),Object.keys(t.lights).map(function(n){var o=t.lights[n];"defaultLight"!==n||e.store.lights.defaultLight.position.set(o.object.matrix[12],o.object.matrix[13],o.object.matrix[14])}),n};function le(){Object(R.b)({type:"failed",message:"Import File Failed."})}var ue=function(e){e&&e.material.setValues({color:e.tc.materialColor,opacity:e.tc.materialOpacity})};function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){he(e,t,n[t])})}return e}function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){me(e,t,n[t])})}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var be=n(1),ge=n.n(be),ve=n(15),ke=n(27),we=n(7),Oe=function(e,t){e&&(e.focus(),e.setSelectionRange(t,t))};function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function De(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe,Se,Ee,Ae=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Me(t).call(this,e))||"object"!==xe(r)&&"function"!=typeof r?De(o):r).onEnterClick=n.onEnterClick.bind(De(n)),n.onTextBoxChange=n.onTextBoxChange.bind(De(n)),n.state={value:n.props.initialName,isVaild:!0},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){Oe(this.refs.textbox.refs.rootContainer,this.state.value.length)}},{key:"onEnterClick",value:function(){this.props.onEnter(this.state.value.trim()),this.props.close()}},{key:"onTextBoxChange",value:function(e){var t=e.target.value,n=!0;this.props.group.map(function(e){(e.label||e.name)===t.trim()&&(n=!1)}),this.setState({value:t,isVaild:n})}},{key:"render",value:function(){var e={skin:"black",width:70,disabled:!this.state.value||!this.state.isVaild||this.state.value===this.props.initialName,label:"OK",onClick:this.onEnterClick},t={style:{width:70,marginLeft:10},label:"Cancel",onClick:this.props.close},n={ref:"textbox",value:this.state.value,onChange:this.onTextBoxChange};return a.a.createElement("div",{style:{width:340,padding:10}},a.a.createElement("div",{style:{marginBottom:10}},"Name: ",a.a.createElement(ve.a,n)),this.state.isVaild?null:a.a.createElement("div",{style:{lineHeight:"28px",height:30,color:"red",paddingLeft:10}},"The name already exists."),a.a.createElement(we.a,e),a.a.createElement(we.a,t))}}])&&Ce(n.prototype,o),r&&Ce(n,r),t}();function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ie(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Pe=Ae,Se="propTypes",Ee={initialName:ge.a.string.isRequired,onEnter:ge.a.func.isRequired,close:ge.a.func.isRequired,group:ge.a.array.isRequired},Se in Pe?Object.defineProperty(Pe,Se,{value:Ee,enumerable:!0,configurable:!0,writable:!0}):Pe[Se]=Ee;var Ne=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ie(this,Le(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(t,i["Component"]),n=t,(o=[{key:"render",value:function(){return a.a.createElement("div",null)}}])&&ze(n.prototype,o),r&&ze(n,r),t}();function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=function(e){return e.props.me.props.onAction},Ue=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Be(t).call(this,e))||"object"!==Re(r)&&"function"!=typeof r?Fe(o):r).onFileNameClick=n.onFileNameClick.bind(Fe(n)),n.onFileEditClick=n.onFileEditClick.bind(Fe(n)),n.onFileCutClick=n.onFileCutClick.bind(Fe(n)),n.onFileCopyClick=n.onFileCopyClick.bind(Fe(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,i["Component"]),n=t,(o=[{key:"onFileNameClick",value:function(){Ge(this)("select",this.props.data)}},{key:"onFileEditClick",value:function(e){e.stopPropagation(),Ge(this)("rename",this.props.data)}},{key:"onFileCutClick",value:function(e){e.stopPropagation(),Ge(this)("cut",this.props.data)}},{key:"onFileCopyClick",value:function(e){e.stopPropagation(),Ge(this)("copy",this.props.data)}},{key:"render",value:function(){var e=this.props.data,t=e.isDirectory,n=e.fullPath,o=e.name,r="tc-icon "+(t?"tc-icon-folder":"tc-icon-file"),i=n===this.props.me.props.clipboard?{color:"grey"}:null;return a.a.createElement("td",{className:"file-name",style:i,onClick:this.onFileNameClick},a.a.createElement("span",{className:"tc-icon tc-icon-edit",onClick:this.onFileEditClick}),a.a.createElement("span",{className:"tc-icon tc-icon-cut",onClick:this.onFileCutClick}),a.a.createElement("span",{className:"tc-icon tc-icon-copy",onClick:this.onFileCopyClick}),a.a.createElement("span",{className:r}),o)}}])&&Ve(n.prototype,o),r&&Ve(n,r),t}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(e){for(var t=0;e>1024;)e/=1024,t++;return e.toFixed(0===t?0:2)+["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"][t]}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Ue,"propTypes",{data:ge.a.object,clipboard:ge.a.string,me:ge.a.object});var Ze=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=qe(t).call(this,e))||"object"!==We(r)&&"function"!=typeof r?Ye(o):r).getMeta=n.getMeta.bind(Ye(n)),n.state={mtime:0,size:"-"},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){this.getMeta(this.props.data)}},{key:"componentDidUpdate",value:function(e){this.props.data!==e.data&&this.getMeta(this.props.data)}},{key:"getMeta",value:function(e){var t=this;e.getMetadata(function(n){t.setState({mtime:n.modificationTime.format("YYYY/MM/DD hh:mm:ss"),size:e.isDirectory?"-":Ke(n.size)})})}},{key:"render",value:function(){return a.a.createElement("td",{className:"file-meta",key:this.props.data.fullPath},this.state[this.props.fieldConfig.field])}}])&&Je(n.prototype,o),r&&Je(n,r),t}();function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Ze,"propTypes",{data:ge.a.object,fieldConfig:ge.a.object});var ot=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=et(t).call(this,e))||"object"!==Qe(r)&&"function"!=typeof r?tt(o):r).onDeleteBtnClick=n.onDeleteBtnClick.bind(tt(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(t,i["Component"]),n=t,(o=[{key:"onDeleteBtnClick",value:function(){this.props.me.props.onAction("delete",this.props.data)}},{key:"render",value:function(){return a.a.createElement("td",{className:"file-operation"},a.a.createElement("span",{className:"tc-icon tc-icon-delete",onClick:this.onDeleteBtnClick}))}}])&&$e(n.prototype,o),r&&$e(n,r),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ot,"propTypes",{data:ge.a.object,me:ge.a.object});var rt=[{label:"name",field:"name",width:300,renderer:Ue},{label:"size",field:"size",width:60,renderer:Ze},{label:"time",field:"mtime",width:140,renderer:Ze},{label:" ",field:"operation",width:30,renderer:ot}];n(119);function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function at(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(){R.a.toast({message:"Mission Failed",type:"failed"})}var ht=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=ct(t).call(this,e))||"object"!==it(r)&&"function"!=typeof r?st(o):r).getDirectory=n.getDirectory.bind(st(n)),n.onCancelBtnClick=n.onCancelBtnClick.bind(st(n)),n.onEnterBtnClick=n.onEnterBtnClick.bind(st(n)),n.onCreateBtnClick=n.onCreateBtnClick.bind(st(n)),n.onUpBtnClick=n.onUpBtnClick.bind(st(n)),n.onPasteBtnClick=n.onPasteBtnClick.bind(st(n)),n.onTableAction=n.onTableAction.bind(st(n)),n.onRootChange=n.onRootChange.bind(st(n)),n.onSelectedBoxChange=n.onSelectedBoxChange.bind(st(n)),n.state={path:n.props.prefix+"/"+n.props.root,isPathExist:!0,root:n.props.root,directory:[],selected:"dir"===n.props.mode?n.props.prefix+"/"+n.props.root:"",clipboard:"",clipboardIsDirectory:!1,clipboardType:""},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){var e=this;ne.md(this.state.path).then(function(){return e.getDirectory()},pt)}},{key:"getDirectory",value:function(e){var t=this;e=e||this.state.path,ne.dir(e).then(function(n){var o=t.refs.path.refs.rootContainer;t.setState({path:e,directory:n,isPathExist:!0},function(){return Oe(o,e.length)})},function(){t.setState({isPathExist:!1})})}},{key:"onCancelBtnClick",value:function(){this.state.isPathExist&&this.props.onClose({root:this.state.root}),this.props.close()}},{key:"onEnterBtnClick",value:function(){var e=this,t=function(e){var t=e.state.selected;return e.props.extension.length&&t.split(".").pop()!==e.props.extension&&(t+="."+e.props.extension),t}(this),n=function(){e.props.onChange({selected:t,root:e.state.isPathExist?e.state.root:void 0}),e.props.close()};"create"===this.props.mode?ne.open(t).then(function(){R.a.confirm({title:"Warning",labels:{enter:"Enter",cancel:"Cancel"},message:"There a file with the same name.<br/>Override it or not?",onEnter:function(){return n()}})},function(){ne.create(t).then(n,pt)}):n()}},{key:"onCreateBtnClick",value:function(){var e=this;R.a.pop({title:"Create New Folder",content:Ae,contentProps:{initialName:"",group:this.state.directory,onEnter:function(t){ne.md(e.state.path+"/"+t).then(function(){return e.getDirectory()},pt)}}})}},{key:"onUpBtnClick",value:function(){var e=this.state.path.split("/");e.pop();var t=e.join("/"),n=t.replace(this.props.prefix+"/","").replace(this.props.prefix,"");t.indexOf(this.props.prefix)<0&&(t=this.props.prefix+"/",n=""),this.setState({path:t,root:n}),this.getDirectory(t)}},{key:"onPasteBtnClick",value:function(){var e=this,t=this.state,n=t.clipboard,o=t.clipboardType,r=t.path,i=t.directory,a=n.split("/");if(a.join("/")!==r){var c=a.pop(),s=i.filter(function(e){return e.name===c}).length,l=function(){ne["copy"===o?"copy":"move"](n,r).then(function(){e.getDirectory(),e.setState({clipboard:"copy"===o?n:""})},pt)};s?R.a.confirm({title:"Warning",labels:{enter:"Enter",cancel:"Cancel"},appSkin:"oneux3",message:"There a "+(this.state.clipboardIsDirectory?"directory":"file")+" with the same name.<br/>Override it or not?",onEnter:function(){return l()}}):l()}}},{key:"onTableAction",value:function(e,t){var n=this,o=function(){n.setState({selected:n.state.selected===t.fullPath?"":n.state.selected,clipboard:n.state.clipboard===t.fullPath?"":n.state.clipboard}),n.getDirectory()};if("select"===e){var r={path:t.isDirectory?t.fullPath:this.state.path,root:t.isDirectory?t.fullPath.replace(this.props.prefix+"/",""):this.state.root};if("dir"===this.props.mode&&t.isDirectory)r.selected=t.fullPath;else if(("file"===this.props.mode||"create"===this.props.mode)&&!t.isDirectory&&(r.selected=t.fullPath,r.selected===this.state.selected))return void this.onEnterBtnClick();return this.setState(r),void(t.isDirectory&&this.getDirectory(t.fullPath))}"cut"!==e?"copy"!==e?"rename"!==e?"delete"===e&&R.a.confirm({title:"Please Confirm",message:"Are you sure to delete "+t.name+"?",labels:{enter:"Enter",cancel:"Cancel"},appSkin:"oneux3",onEnter:function(){ne[t.isDirectory?"deltree":"del"](t.fullPath).then(o,pt)}}):R.a.pop({title:"Rename "+(t.isDirectory?"Folder":"File"),content:Ae,contentProps:{initialName:t.name,group:this.state.directory,onEnter:function(e){ne.ren(t.fullPath,e).then(o,pt)}}}):this.setState({clipboard:t.fullPath,clipboardIsDirectory:t.isDirectory,clipboardType:"copy"}):this.setState({clipboard:t.fullPath,clipboardIsDirectory:t.isDirectory,clipboardType:"cut"})}},{key:"onRootChange",value:function(e){this.setState({root:e.target.value}),this.getDirectory(this.props.prefix+"/"+e.target.value)}},{key:"onSelectedBoxChange",value:function(e){var t=e.target.value.replace(/\//g,"");t=(t=this.state.path+"/"+t).replace(/\/\//g,"/"),this.setState({selected:t})}},{key:"render",value:function(){var e={ref:"path",width:475,value:this.state.root,onChange:this.onRootChange},t={style:{height:300,margin:10},datasource:this.state.directory,fieldConfig:rt,noDataRenderer:Ne,clipboard:this.state.clipboard,onAction:this.onTableAction},n={className:"tc-icon tc-icon-paste",onClick:this.state.clipboard?this.onPasteBtnClick:void 0,style:this.state.clipboard?{}:{color:"grey"}},o={width:440,disabled:"create"!==this.props.mode,value:this.state.selected.split("/").pop(),onChange:"create"===this.props.mode?this.onSelectedBoxChange:void 0},r={style:{width:60,marginLeft:10},label:"Cancel",onClick:this.onCancelBtnClick},i={style:{width:60,marginLeft:10},skin:"black",label:"create"!==this.props.mode?"Select":"OK",disabled:!this.state.selected.length,onClick:this.onEnterBtnClick};return a.a.createElement("div",{className:"tc-explorer"},a.a.createElement("span",{className:"tc-icon tc-icon-create-folder",onClick:this.onCreateBtnClick}),a.a.createElement("span",{className:"tc-icon tc-icon-up-level",onClick:this.onUpBtnClick}),a.a.createElement("span",n),a.a.createElement("div",{className:"dir-bar"},a.a.createElement("span",null,"/"),a.a.createElement(ve.a,e)),a.a.createElement(ke.a,t),a.a.createElement("div",{style:{paddingLeft:10}},a.a.createElement(ve.a,o),a.a.createElement(we.a,i),a.a.createElement(we.a,r)))}}])&&at(n.prototype,o),r&&at(n,r),t}();function ft(){R.a.toast({type:"failed",message:"Open File Failed."})}function mt(e){e.fill({mesh3d:{},lights:{defaultLight:e.store.lights.defaultLight}})}function dt(e,t){var n=se(t,e);t.fill(n),t.fill(e.editor)}ut(ht,"defaultProps",{prefix:"",root:"",mode:"dir",extension:"tcm",onChange:new Function,onClose:new Function}),ut(ht,"propTypes",{prefix:ge.a.string,root:ge.a.string,mode:ge.a.string,onClose:ge.a.func,onChange:ge.a.func,close:ge.a.func.isRequired});var yt=function(e,t,n,o){var r=new f.Vector3(e/n.refs.container.offsetWidth*2-1,-t/n.refs.container.offsetHeight*2+1,1);r.unproject(n.camera),n.raycaster.ray.set(n.camera.position,r.sub(n.camera.position).normalize());var i=n.raycaster.intersectObjects(o||[]);return i.length?i[0].object:null},bt=function(e,t){if(e){var n=t&&t.uuid===e.uuid?v.colors.selectedMesh[0]:e.tc.materialColor,o=t&&t.uuid===e.uuid?1:e.tc.materialOpacity||1;e.material.setValues({color:n,opacity:o,transparent:o<1})}},gt=null,vt=function(e,t,n){var o=yt(e.event.nativeEvent.offsetX,e.event.nativeEvent.offsetY,e.stage3D,n);if(o){if(o.tc.locked)return;if(t&&o.uuid===t.uuid)return;bt(gt,t),(gt=o).material.setValues({color:v.colors.normalMeshHover[0]})}else gt&&(bt(gt,t),gt=null);return gt},kt=null,wt=function(e){return Object.keys(e.store.mesh3d).map(function(t){return e.store.mesh3d[t]})};function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){xt(e,t,n[t])})}return e}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ct=function(e,t,n){e&&e.uuid===t.uuid||(ue(e),ue(n.get("selectedVector")),t.material.setValues({color:v.colors.selectedMesh[0],opacity:1,transparent:!0}),n.fill({selectedMesh:t,morpher3Dinfo:Ot({},n.get("morpher3Dinfo"),{anchorColor:t.tc.anchorColor}),selectedVector:null,selectedVectorIndex:-1}))};function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Dt=null,jt=null,Pt=null,St=function(e,t){var n=e.mouseCurrent2D,o=e.stage2D.renderer2D.getObject2dByMouse2D(n.x,n.y);if(o){if(o.tc.locked)return;if(t&&o.uuid===t.uuid)return;bt(Pt,t),(Pt=o).material.setValues({color:v.colors.normalMeshHover[0]})}else Pt&&(bt(Pt,t),Pt=null);return Pt};function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var At=null;function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var zt=null;function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Lt=null;function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Nt=null;function Rt(e){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Bt(e,t){return!t||"object"!==Rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gt=[{hotkey:"".concat(y.C,"O"),info:"Open file from browser storage."},{hotkey:"".concat(y.C,"S"),info:"Save File."},{hotkey:"".concat(y.C).concat(y.S,"S"),info:"Save As"},{hotkey:"".concat(y.C).concat(y.S,"I"),info:"Import file from os."},{hotkey:"".concat(y.C).concat(y.S,"O"),info:"Export file to os."},{hotkey:"".concat(y.A,"1"),info:"Switch to 3D stage."},{hotkey:"".concat(y.A,"2"),info:"Switch to XOZ stage."},{hotkey:"".concat(y.A,"3"),info:"Switch to XOY stage."},{hotkey:"".concat(y.A,"4"),info:"Switch to ZOY stage."},{hotkey:"".concat(y.A,"5"),info:"Display all stages."},{hotkey:"".concat(y.C,"D"),info:"Activate mesh transformer"},{hotkey:"".concat(y.C,"F"),info:"Activate mesh morpher"},{hotkey:"".concat(y.C,"G"),info:"Activate light transformer"},{hotkey:"".concat(y.C,"E"),info:"Move the camera by dragging"},{hotkey:"".concat(y.A,"Q"),info:"Switch transformer working mode between translating and rotating."},{hotkey:"ESC",info:"Unselect mesh or joint."},{hotkey:"Delete",info:"Delete selected mesh"},{hotkey:d?"".concat(y.C,"H"):"F1",info:"See hotkey config."},{hotkey:"Arrow Down",info:"Move the camera downward."},{hotkey:"Arrow Up",info:"Move the camera upward."},{hotkey:"Arrow Left",info:"Move the camera clockwise."},{hotkey:"Arrow Right",info:"Move the camera anticlockwise."}],Ut=[{label:"hotkey",field:"hotkey",width:200,align:"right"},{label:"info",field:"info",width:500}],Wt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Bt(this,Ft(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,i["Component"]),n=t,(o=[{key:"render",value:function(){return a.a.createElement("div",{style:{width:600}},a.a.createElement(ke.a,{datasource:Gt,fieldConfig:Ut,style:{margin:10}}))}}])&&Vt(n.prototype,o),r&&Vt(n,r),t}(),Jt=function(e,t){var n=K(t),o=new W.a;return o.file("content",JSON.stringify(n)),o.generateAsync({type:"blob"}).then(function(t){return ne.write(e,{data:t,append:!1})}).then(function(){Object(R.b)({type:"success",message:"File Saved."})})};function qt(){R.a.toast({type:"failed",message:"Write File Failed."})}var Yt=function(e,t){R.a.pop({contentProps:{prefix:e.get("rootPrefix"),root:e.get("root"),extension:"tcm",mode:"create",onChange:function(t){Jt(t.selected,e).then(function(){e.fill({root:t.root,path:t.selected})},qt)},onClose:function(t){e.set("root",t.root)}},content:ht,title:t||"Save As"})},Xt=n(67);function Kt(e){return(Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Qt(e){return(Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function en(e,t){return(en=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tn(e){for(e=e.toString(16);e.length<6;)e="0"+e;return JSON.stringify({css:"#"+e})}var nn=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Qt(t).call(this,e))||"object"!==Kt(r)&&"function"!=typeof r?$t(o):r).onColorPickerChange=n.onColorPickerChange.bind($t(n)),n.onEnterClick=n.onEnterClick.bind($t(n)),n.state={value:tn(n.props.value)},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&en(e,t)}(t,i["Component"]),n=t,(o=[{key:"onColorPickerChange",value:function(e){this.setState({value:e.target.value})}},{key:"onEnterClick",value:function(){var e=JSON.parse(this.state.value);this.props.onChange(parseInt(e.css.replace("#",""),16)),this.props.close()}},{key:"render",value:function(){var e={skin:"black",width:70,style:{marginLeft:10},label:"OK",onClick:this.onEnterClick},t={width:70,style:{marginLeft:10},label:"Cancel",onClick:this.props.close},n={value:this.state.value,onChange:this.onColorPickerChange};return a.a.createElement("div",{style:{width:340,height:260}},a.a.createElement(Xt.a,n),a.a.createElement(we.a,e),a.a.createElement(we.a,t))}}])&&Zt(n.prototype,o),r&&Zt(n,r),t}();function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(nn,"propTypes",{value:ge.a.number.isRequired,onChange:ge.a.func.isRequired,close:ge.a.func.isRequired});function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ln(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){fn(e,t,n[t])})}return e}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){dn(e,t,n[t])})}return e}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var yn={addGroup:function(e){this.fill({group:[].concat(this.get("group"),[{label:e,expend:!0}]),activeGroup:e})},addMesh:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){D(e,t,n[t])})}return e}({},this.get("mesh3d"));e.tc={birth:new Date,add:!0,group:this.get("activeGroup"),anchorColor:52480,materialColor:e.material.color.getHex(),materialEmissive:e.material.emissive.getHex(),materialOpacity:e.material.opacity,vectorLinkHash:C(e.geometry)},t[e.uuid]=e,this.set("mesh3d",t)},changeActiveGroup:function(e){this.set("activeGroup",e)},changeCamera3D:function(e){var t=j({},this.get("stage"));t.camera3D=j({},t.camera3D,e),this.set("stage",t)},changeMeshGroup:function(e,t){var n=this.get("mesh3d")[e];n&&(n.tc.group=t,this.set("timer",+new Date))},changeMouse3D:function(e){this.set("mouse3d",e)},changeTool:function(e){var t=this.get("selectedMesh");t&&t.material.setValues({color:t.tc.materialColor});var n=0===e.indexOf("create")&&"all"!==this.get("view")?"3d":this.get("view"),o=S({},this.get("stage"));o.camera3D=S({},o.camera3D),o.camera3D.cameraAngleA=0===e.indexOf("create")&&Math.abs(o.camera3D.cameraAngleA)<2?40:o.camera3D.cameraAngleA,this.fill({tool:e,view:n,stage:o,selectedMesh:null})},changeView:function(e){this.set("view",e)},clearSelected:function(){var e=this.get("tool"),t=this.get("selectedMesh"),n=this.get("selectedVector"),o=this.get("selectedVectorIndex"),r=this.get("selectedLight");if("pickJoint"===e&&(n||o>-1))return n&&n.material.setValues({color:n.tc.materialColor}),void this.fill({selectedVector:null,selectedVectorIndex:-1});r&&this.set("selectedLight",null),t&&(t.material.setValues({color:t.tc.materialColor,opacity:t.tc.materialOpacity,transparent:t.tc.materialOpacity<1}),this.set("selectedMesh",null))},closePanel:function(e){var t=[];this.get("panel").map(function(n){n.type!==e&&t.push(n)}),this.set("panel",t)},createPlane:function(e,t){if(_(e,t)){var n,o,r=e.stage3D,i=(n=e.mouseDown3D,o=e.mouseCurrent3D,{width:Math.abs(n.x-o.x),height:Math.abs(n.z-o.z)}),a=z(e.mouseDown3D,e.mouseCurrent3D),c=I();r.tempMesh&&r.scene.remove(r.tempMesh);var s=parseInt(i.width/100,10),l=parseInt(i.height/100,10),u=new f.PlaneGeometry(i.width,i.height,s,l);r.tempMesh=new f.Mesh(u,c),r.tempMesh.rotation.x=-1.5*Math.PI,r.tempMesh.rotation.y=Math.PI,r.tempMesh.position.set(a.x,a.y,a.z),r.scene.add(r.tempMesh)}},createSphere:function(e,t){if(_(e,t)){var n,o,r,i,a,c=e.stage3D,s=(n=e.mouseDown3D,o=e.mouseCurrent3D,r=n.x-o.x,i=n.y-o.y,a=n.z-o.z,Math.sqrt(r*r+i*i+a*a)),l=z(e.mouseDown3D,e.mouseCurrent3D),u=I();c.tempMesh&&c.scene.remove(c.tempMesh);var p=new f.SphereGeometry(s/2,20,10);c.tempMesh=new f.Mesh(p,u),c.tempMesh.position.set(l.x,l.y,l.z),c.scene.add(c.tempMesh)}},deleteGroup:function(e,t){var n=[],o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){L(e,t,n[t])})}return e}({},this.get("mesh3d")),r=this.get("selectedMesh"),i={group:n,mesh3d:o,activeGroup:this.get("activeGroup")===e?"default group":this.get("activeGroup"),timer:+new Date};this.get("group").map(function(t){t.label!==e&&n.push(t)}),Object.keys(o).map(function(n){var a=o[n];a.tc.group===e&&(t&&!a.tc.locked?(delete o[n],r&&r.uuid===n&&(i.selectedMesh=null,i.selectedVector=null,i.selectedVectorIndex=-1)):a.tc.group="default group")}),this.fill(i)},deleteLight:function(e){if(this.get("lights")[e]){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){N(e,t,n[t])})}return e}({},this.get("lights")),n={lights:t};delete t[e],T(e,this)&&(n.selectedLight=null),this.fill(n)}},deleteMesh:function(e){var t=this;function n(){R.a.close(),F.un("enter",n);var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){H(e,t,n[t])})}return e}({},t.get("mesh3d")),r=t.get("selectedMesh"),i={mesh3d:o};delete o[e],r&&r.uuid===e&&(i.selectedMesh=null,i.selectedVector=null,i.selectedVectorIndex=-1),t.fill(i)}R.a.confirm({title:"Please Confirm",message:"<h4>Are you sure to remove this mesh?</h4>",appSkin:"oneux3",labels:{enter:"Yes",cancel:"No"},onClose:function(){return F.un("enter",n)},onEnter:function(){return n()}}),F.on("enter",n)},enlargeGrid:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){G(e,t,n[t])})}return e}({},this.get("stage"));e.gridSize3D=Math.min(e.gridSize3D+1e3,2e4),e.gridStep3D=e.gridSize3D/50,this.set("stage",e)},exportFile:function(){var e=K(this),t=new W.a,n=this.store.path?this.store.path.split("/").pop():"tcModel.tcm";return t.file("content",JSON.stringify(e)),t.generateAsync({type:"blob"}).then(function(e){q()(e,n)})},importFile:function(){var e=this;ne.uploadFromBrowser("tcm").then(function(e){return(new W.a).loadAsync(e.target.result)}).then(function(e){return e.file("content").async("string")}).then(function(t){try{t=JSON.parse(t)}catch(e){return t=null,void le()}t&&e.fill(se(e,t))},le)},lockGroup:function(e,t){var n={timer:+new Date},o=this.get("selectedMesh"),r=this.get("mesh3d");Object.keys(r).map(function(i){var a=r[i];a.tc.group===e&&(a.tc.locked=t,o&&o.uuid===a.uuid&&(ue(o),n.selectedMesh=null,n.selectedVector=null,n.selectedVectorIndex=-1))}),this.fill(n)},lockLight:function(e){var t={timer:+new Date},n=this.get("lights")[e];n&&(n.tc.locked=!n.tc.locked,T(e,this)&&(t.selectedLight=null),this.fill(t))},lockMesh:function(e){var t={timer:+new Date},n=this.get("mesh3d")[e];if(n){n.tc.locked=!n.tc.locked;var o=this.get("selectedMesh");o&&o.uuid===e&&(ue(o),t.selectedMesh=null,t.selectedVector=null,t.selectedVectorIndex=-1),this.fill(t)}},moveCamera:function(e,t){if("moveCamera"!==this.get("tool")){var n=this.get("selectedMesh");return n&&n.material.setValues({color:n.tc.materialColor}),void this.fill({tool:"moveCamera",selectedMesh:null})}if(t){var o=e.stage3D,r=o.props.cameraAngleB,i=o.props.cameraMoveSpeed,a=o.camera.position,c=o.props.cameraRadius*e.mouseDelta2D.x*i*.2/o.refs.container.offsetWidth,s=o.props.cameraRadius*e.mouseDelta2D.y*i*.2/o.refs.container.offsetHeight,l=o.props.cameraLookAt;l={x:l.x,y:l.y,z:l.z},Math.abs(o.props.cameraAngleA)>2?(l.x-=Math.sin(Math.PI*r/180)*c,l.z+=Math.cos(Math.PI*r/180)*c,l.x-=Math.cos(Math.PI*r/180)*s*Math.abs(a.y)/a.y,l.z-=Math.sin(Math.PI*r/180)*s*Math.abs(a.y)/a.y):(l.x-=Math.sin(Math.PI*r/180)*c,l.z+=Math.cos(Math.PI*r/180)*c,l.y+=s),(o=pe({},this.get("stage"))).camera3D=pe({},o.camera3D,{lookAt:l}),this.set("stage",o)}},moveCamera2D:function(e,t){if(t&&"mouseup"!==e){var n=fe({},this.get("stage")),o=e.stage2D.grid2D.getMouse3D(0,0),r=e.stage2D.grid2D.getMouse3D(e.mouseDelta2D.x,e.mouseDelta2D.y),i=[r[0]-o[0],r[1]-o[1]],a=JSON.parse(JSON.stringify(e.stage2D.props.cameraLookAt));a[e.stage2D.props.axis[0]]-=i[0],a[e.stage2D.props.axis[1]]-=i[1],n.camera3D=fe({},n.camera3D,{lookAt:a}),this.set("stage",n)}},moveGroup:function(e,t){var n=[],o=[],r=null;this.get("group").map(function(t){t.label!==e?n.push(t):r=t}),r&&(n.map(function(e){e.label===t?(o.push(e),o.push(r),r=null):o.push(e)}),r||this.set("group",o))},narrowGrid:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){de(e,t,n[t])})}return e}({},this.get("stage"));e.gridSize3D=Math.max(e.gridSize3D-1e3,1e3),e.gridStep3D=e.gridSize3D/50,this.set("stage",e)},newFile:function(){this.fill(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ye(e,t,n[t])})}return e}({},v,g)),document.title=v.editorTitle},openFile:function(){var e=this;R.a.pop({contentProps:{prefix:e.get("rootPrefix"),root:e.get("root"),extension:"tcm",mode:"file",onChange:function(t){var n;(n=t.selected,ne.read(n,{type:"readAsArrayBuffer"}).then(function(e){return(new W.a).loadAsync(e.target.result)}).then(function(e){return e.file("content").async("string")}).then(function(e){try{e=JSON.parse(e)}catch(t){e=null}return new Promise(function(t,n){e?t(e):n()})})).then(function(n){var o,r;e.fill({root:t.root,path:t.selected}),o=n,r=e,Object.keys(r.store.mesh3d).length?R.a.confirm({title:"Please Confirm",message:"Clear the editor?",appSkin:"oneux3",labels:{enter:"Yes",cancel:"No"},onEnter:function(){mt(r),dt(o,r)},onCancel:function(){dt(o,r)}}):(mt(r),dt(o,r))},ft)},onClose:function(t){e.set("root",t.root)}},content:ht,title:"Open"})},openPanel:function(e){var t=[],n=!1;this.get("panel").map(function(o){o.type===e?n=!0:t.push(o)}),n||t.push({type:e,expend:!0}),this.set("panel",t)},pickJoint:function(e,t){var n=this.get("selectedMesh"),o=this.get("selectedVector");if("pickJoint"===this.get("tool")){if("mouseup"===e&&jt)!function(e,t,n){e&&e.uuid===t.uuid||(ue(e),t.material.setValues({color:v.colors.selectedMesh[0]}),n.fill({selectedVector:t,selectedVectorIndex:t.tc.index}))}(o,jt,this);else if("mouseup"===e&&Dt)Ct(n,Dt,this);else if("object"===Mt(e)&&!t)if(null!=n){if(null!=n){if(bt(Dt,n),jt=function(e,t){var n=yt(e.event.nativeEvent.offsetX,e.event.nativeEvent.offsetY,e.stage3D,e.stage3D.morpher.anchors.filter(function(e){return e.added}));return n?(bt(kt,t),(kt=n).material.setValues({color:v.colors.normalMeshHover[0]})):kt&&(bt(kt,t),kt=null),kt}(e,o))return;Dt=vt(e,n,wt(this))}}else Dt=vt(e,n,wt(this))}else this.fill({tool:"pickJoint",selectedVector:null,selectedVectorIndex:-1})},pickJoint2D:function(e,t){var n=this.get("selectedMesh");"mouseup"===e&&At?Ct(n,At,this):"object"!==Et(e)||t||(At=St(e,n))},pickJointAnchor:function(e){e&&e.tc?this.fill({selectedVectorIndex:e.tc.index,selectedVector:e}):this.set("selectedVectorIndex",e)},pickLight:function(e,t){var n=this.get("selectedLight");if("pickLight"!==this.get("tool"))return ue(this.get("selectedMesh")),ue(this.get("selectedVector")),n&&n.tc&&(n=n.tc.lightKey),void this.fill({tool:"pickLight",selectedMesh:null,selectedVector:null,selectedVectorIndex:-1,selectedLight:"string"==typeof n?n:null});"mouseup"===e&&zt?function(e,t,n){if(!e||e.uuid!==t.uuid){if(ue(e),t&&t.tc.lightKey){var o=n.get("lights")[t.tc.lightKey];if(!o||!o.visible||o.tc.locked)return}n.fill({selectedLight:t})}}(n,zt,this):"object"!==_t(e)||t||(zt=vt(e,null,e.stage3D.lightHelper.anchorArray))},pickMesh:function(e,t){var n=this.get("selectedMesh");"pickMesh"===this.get("tool")?"mouseup"===e&&Lt?Ct(n,Lt,this):"object"!==It(e)||t||(Lt=vt(e,n,wt(this))):this.fill({tool:"pickMesh",selectedVector:null,selectedVectorIndex:-1})},pickMesh2D:function(e,t){var n=this.get("selectedMesh");"mouseup"===e&&Nt?Ct(n,Nt,this):"object"!==Tt(e)||t||(Nt=St(e,n))},popHotkeyInfo:function(){R.a.pop({title:"Hotkey Config",content:Wt})},renameGroup:function(e,t){var n=JSON.parse(JSON.stringify(this.get("group"))),o=this.get("mesh3d");Object.keys(o).map(function(n){var r=o[n];r.tc.group=r.tc.group===e?t:r.tc.group}),n.map(function(n){n.label=n.label===e?t:n.label}),this.fill({group:n,activeGroup:t})},resetCamera:function(){this.fill({stage:{colorStage:["#3D3D3D",4013373],colorGrid:["#8F908A",9408650],camera3D:{cameraRadius:1e3,cameraAngleA:40,cameraAngleB:45,lookAt:{x:0,y:0,z:0}},gridVisible:!0,gridSize3D:2500,gridStep3D:50},mouse3d:{x:0,y:0,z:0}})},saveFile:function(){var e=this,t=e.store.path;t?ne.open(t).then(function(){Jt(t,e)},function(){Yt(e,"Save")}):Yt(e,"Save")},saveFileAs:function(){Yt(this)},selectLight:function(e,t){var n={selectedLight:null},o=this.get("lights")[e];t?n.selectedLight=t:o&&o.visible&&!o.tc.locked&&(n.selectedLight=e),n.selectedLight&&this.fill(n)},selectMesh:function(e){var t=this.get("selectedMesh"),n=this.get("mesh3d")[e];n&&!n.tc.locked&&n.visible&&(t&&t.uuid===e||(ue(t),ue(this.get("selectedVector")),n.material.setValues({color:v.colors.selectedMesh[0]}),this.fill({selectedMesh:n,selectedVector:null,selectedVectorIndex:-1})))},setMorpherColor:function(){var e=this;R.a.pop({contentProps:{value:this.get("morpher3Dinfo").anchorColor,onChange:function(t){var n=e.get("selectedMesh");n&&n.tc&&(n.tc.anchorColor=t),e.set("morpher3Dinfo",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){on(e,t,n[t])})}return e}({},e.get("morpher3Dinfo"),{anchorColor:t}))}},content:nn,title:"Please Choose Anchor Color"})},setMorpherSize:function(e){var t=this.get("morpher3Dinfo"),n=t.anchorSize;e?(n/=1.1,n=Math.max(n,500)):(n*=1.1,n=Math.min(n,1e3)),this.set("morpher3Dinfo",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){rn(e,t,n[t])})}return e}({},t,{anchorSize:n}))},setTransformerMode:function(e){this.set("transformer3Dinfo",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){an(e,t,n[t])})}return e}({},this.get("transformer3Dinfo"),{mode:e}))},setTransformerSize:function(e){var t=this.get("transformer3Dinfo");this.set("transformer3Dinfo",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){cn(e,t,n[t])})}return e}({},t,{size:e?t.size+.1:Math.max(t.size-.1,.1)}))},toggleGroup:function(e){var t=[].concat([],this.get("group"));t.map(function(n,o){n.label===e&&(t[o]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){sn(e,t,n[t])})}return e}({},n,{expend:!n.expend}))}),this.set("group",t)},toggleGroupVisibility:function(e,t){var n={timer:+new Date},o=this.get("selectedMesh"),r=this.get("mesh3d");Object.keys(r).map(function(i){var a=r[i];a.tc.group===e&&(a.visible=t,o&&o.uuid===a.uuid&&(ue(o),n.selectedMesh=null,n.selectedVector=null,n.selectedVectorIndex=-1))}),this.fill(n)},toggleHelper:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ln(e,t,n[t])})}return e}({},this.get("stage"));e.gridVisible=!e.gridVisible,this.set("stage",e)},toggleLightVisibility:function(e){var t={timer:+new Date},n=this.get("lights")[e];n&&(n.visible=!n.visible,T(e,this)&&(t.selectedLight=null),this.fill(t))},toggleMeshVisibility:function(e){var t={timer:+new Date},n=this.get("mesh3d")[e];if(n){n.visible=!n.visible;var o=this.get("selectedMesh");o&&o.uuid===e&&(ue(o),t.selectedMesh=null,t.selectedVector=null,t.selectedVectorIndex=-1),this.fill(t)}},togglePanel:function(e){var t=[].concat([],this.get("panel"));t.map(function(n,o){n.type===e&&(t[o]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){un(e,t,n[t])})}return e}({},n,{expend:!n.expend}))}),this.set("panel",t)},toggleTransformerSpace:function(){var e=this.get("transformer3Dinfo");this.set("transformer3Dinfo",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){pn(e,t,n[t])})}return e}({},e,{space:"world"===e.space?"local":"world"}))},updateTimer:function(){this.set("timer",(new Date).getTime())},zoomInCamera:function(){var e=hn({},this.get("stage")),t=e.camera3D.cameraRadius;t-=.2*t*240/document.body.offsetWidth,t=Math.max(t,50),t=Math.min(t,5e3),e.camera3D=hn({},e.camera3D,{cameraRadius:t}),this.set("stage",e)},zoomOutCamera:function(){var e=mn({},this.get("stage")),t=e.camera3D.cameraRadius;t+=.2*t*240/document.body.offsetWidth,t=Math.max(t,50),t=Math.min(t,5e3),e.camera3D=mn({},e.camera3D,{cameraRadius:t}),this.set("stage",e)}},bn=n(28);function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kn(e){return(kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function On(e,t){return(On=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Cn=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=kn(t).call(this,e))||"object"!==gn(r)&&"function"!=typeof r?wn(o):r).onClick=n.onClick.bind(wn(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&On(e,t)}(t,i["Component"]),n=t,(o=[{key:"onClick",value:function(e){this.props.disabled||(e.target=this.refs.container,e.target.value=this.props.value,this.props.onClick(e))}},{key:"render",value:function(){var e={ref:"container",className:"tc-menu-item"+(this.props.disabled?" tc-menu-item-disabled":""),onClick:this.onClick},t=this.props.checked?"●":"";return a.a.createElement("div",e,this.props.hasOwnProperty("checked")?a.a.createElement("span",{className:"checked"},t):null,a.a.createElement("span",null,this.props.label),this.props.hotKey?a.a.createElement("span",{className:"hotkey"},this.props.hotKey):null)}}])&&vn(n.prototype,o),r&&vn(n,r),t}();xn(Cn,"propTypes",{disabled:ge.a.bool,checked:ge.a.bool,hotKey:ge.a.string,value:ge.a.string.isRequired,label:ge.a.string.isRequired,onClick:ge.a.func.isRequired}),xn(Cn,"defaultProps",{disabled:!1,checked:!1,hotKey:""});n(124);function Mn(){return(Mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){_n(e,t,n[t])})}return e}function jn(e){return(jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function En(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zn=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Sn(t).call(this,e))||"object"!==jn(r)&&"function"!=typeof r?En(o):r).onClick=n.onClick.bind(En(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&An(e,t)}(t,i["Component"]),n=t,(o=[{key:"onClick",value:function(e){this.context.dispatch.apply(null,e.target.value.split(" "))}},{key:"render",value:function(){return a.a.createElement("div",{className:"tc-menu"},(t=(e=this).props,n=t.panel,o=t.menu,r=n.reduce(function(e,t){return Object.assign({},e,_n({},t.type,1))},{}),o.map(function(t){var n={label:t.label,datasource:t.children,onClick:e.onClick,itemRenderer:Cn};return"view"===t.key&&(n.datasource=t.children.map(function(e){return Dn({},e,{checked:r.hasOwnProperty(e.key)})})),"geometry"===t.key&&(n.datasource=t.children.map(function(t){return Dn({},t,{checked:t.value.indexOf(e.props.tool)>-1})})),a.a.createElement(bn.a,Mn({},n,{key:"menu-"+t.label}))})));var e,t,n,o,r}}])&&Pn(n.prototype,o),r&&Pn(n,r),t}();_n(zn,"contextTypes",{dispatch:ge.a.func});n(125);function In(){return(In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Ln(e){return(Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Nn(e){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vn(e,t){return(Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bn=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Nn(t).call(this,e))||"object"!==Ln(r)&&"function"!=typeof r?Rn(o):r).onButtonClick=n.onButtonClick.bind(Rn(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}(t,i["Component"]),n=t,(o=[{key:"onButtonClick",value:function(e){this.context.dispatch.apply(null,e.target.dataset.uiCmd.split(" "))}},{key:"render",value:function(){return a.a.createElement("div",{className:"tc-command-bar"},(t=[],n=(e=this).props,o=n.gridVisible,n.datasource.map(function(n,r){if("string"!=typeof n){var i={key:r,className:"command-"+(n.icon?"icon":"text")+"-button"+(n.disabled?"-disabled":""),title:n.title,onClick:n.disabled?null:e.onButtonClick},c={className:n.icon?"tc-icon "+n.icon:""};i.className+=function(e,t){var n=t.props,o=n.view,r=n.tool,i=e.split(" ");return"changeView"===i[0]&&i[1]===o||"changeTool"===i[0]&&i[1]===r||e===r}(n.value,e)?" checked-item":"","toggleHelper"===n.value&&(c.className=o?"tc-icon tc-icon-visible":"tc-icon tc-icon-invisible"),t.push(a.a.createElement("div",In({},i,{"data-ui-cmd":n.value}),a.a.createElement("span",In({},c,{"data-ui-cmd":n.value}),n.label)))}else t.push(a.a.createElement("div",{key:r,className:"command-label"},n))}),t));var e,t,n,o}}])&&Tn(n.prototype,o),r&&Tn(n,r),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Bn,"contextTypes",{dispatch:ge.a.func});n(126);function Fn(e){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Gn(e,t){return!t||"object"!==Fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Un(e){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wn(e,t){return(Wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Gn(this,Un(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wn(e,t)}(t,i["Component"]),n=t,(o=[{key:"render",value:function(){var e=this.props.mouse3d;return a.a.createElement("div",{className:"tc-information-bar"},a.a.createElement("span",{className:"axis-label"},"x: ",e.x.toFixed(2)),a.a.createElement("span",{className:"axis-label"},"y: ",e.y.toFixed(2)),a.a.createElement("span",{className:"axis-label"},"z: ",e.z.toFixed(2)))}}])&&Hn(n.prototype,o),r&&Hn(n,r),t}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Jn,"propTypes",{mouse3d:ge.a.object.isRequired});var qn=n(18),Yn=n.n(qn),Xn={},Kn=0,Zn=!1;function Qn(){0!==Kn?(requestAnimationFrame(Qn),Object.keys(Xn).map(function(e){Xn[e]()})):Zn=!1}var $n={add:function(e,t){Kn+=Xn.hasOwnProperty(e)?0:1,Xn[e]=t,Zn||Kn&&Qn()},remove:function(e){Kn--,delete Xn[e]}},eo={font:[20,0,0,0,.5,0,30,30,0],back:[-20,0,0,0,-.5,0,30,30,0],top:[0,20,0,-.5,0,0,30,30,0],bottom:[0,-20,0,.5,0,0,30,30,0],left:[0,0,20,0,0,0,30,30,0],right:[0,0,-20,0,-1,0,30,30,0],font_left_top:[17.5,17.5,17.5,0,0,0,5,5,5],font_right_top:[17.5,17.5,-17.5,0,0,0,5,5,5],left_top_back:[-17.5,17.5,17.5,0,0,0,5,5,5],back_top_right:[-17.5,17.5,-17.5,0,0,0,5,5,5],left_font_bottom:[17.5,-17.5,17.5,0,0,0,5,5,5],font_right_bottom:[17.5,-17.5,-17.5,0,0,0,5,5,5],left_back_bottom:[-17.5,-17.5,17.5,0,0,0,5,5,5],right_back_bottom:[-17.5,-17.5,-17.5,0,0,0,5,5,5],left_top:[0,17.5,17.5,0,0,0,30,5,5],left_bottom:[0,-17.5,17.5,0,0,0,30,5,5],top_right:[0,17.5,-17.5,0,0,0,30,5,5],bottom_right:[0,-17.5,-17.5,0,0,0,30,5,5],top_font:[17.5,17.5,0,0,0,0,5,5,30],bottom_font:[17.5,-17.5,0,0,0,0,5,5,30],back_bottom:[-17.5,-17.5,0,0,0,0,5,5,30],top_back:[-17.5,17.5,0,0,0,0,5,5,30],font_left:[17.5,0,17.5,0,0,0,5,30,5],font_right:[17.5,0,-17.5,0,0,0,5,30,5],back_right:[-17.5,0,-17.5,0,0,0,5,30,5],back_left:[-17.5,0,17.5,0,0,0,5,30,5]},to={font_left_top:[45,45],left_top_back:[45,135],back_top_right:[45,225],font_right_top:[45,315],left_font_bottom:[-45,45],left_back_bottom:[-45,135],right_back_bottom:[-45,225],font_right_bottom:[-45,315],left_top:[45,90],left_bottom:[-45,90],top_right:[45,270],bottom_right:[-45,270],top_font:[45,0],bottom_font:[-45,0],top_back:[45,180],back_bottom:[-45,180],font_left:[0,45],font_right:[0,315],back_right:[0,225],back_left:[0,135],left:[0,90],right:[0,270],font:[0,0],back:[0,180],top:[89,null],bottom:[-89,null]};n(127);function no(e){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ro(e){return(ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function io(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ao(e,t){return(ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function co(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function so(e,t){var n=t=t||e.props,o=n.cameraAngleA,r=n.cameraAngleB,i=n.cameraRadius;e.camera.position.set(i*Math.cos(Math.PI*o/180)*Math.cos(Math.PI*r/180),i*Math.sin(Math.PI*o/180),i*Math.cos(Math.PI*o/180)*Math.sin(Math.PI*r/180))}var lo=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=ro(t).call(this,e))||"object"!==no(r)&&"function"!=typeof r?io(o):r).onMouseMove=n.onMouseMove.bind(io(n)),n.onMouseDown=n.onMouseDown.bind(io(n)),n.onMouseUp=n.onMouseUp.bind(io(n)),n.onMouseOut=n.onMouseOut.bind(io(n)),n.onWindowMouseMove=n.onWindowMouseMove.bind(io(n)),n.onWindowMouseUp=n.onWindowMouseUp.bind(io(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ao(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){var e,t=this;this.camera=new f.PerspectiveCamera(60,1,1,1e4),this.scene=new f.Scene,this.renderer=new f.WebGLRenderer({alpha:!0}),this.raycaster=new f.Raycaster,this.container.appendChild(this.renderer.domElement),this.scene.add(new f.AmbientLight(16777215)),this.renderer.setSize(120,120),this.intersected=null,so(this,this.props),$n.add("cameraController",(e=this,function(){e.camera.lookAt(0,0,0),e.renderer.render(e.scene,e.camera)}));var n=new f.TextureLoader;Object.keys(eo).map(function(e){var o=eo[e];n.load("resource/textures/"+(e.indexOf("_")<0?e+"_en.png":"background.png"),function(n){var r=e.indexOf("_")<0?new f.PlaneGeometry(o[6],o[7]):new f.BoxGeometry(o[6],o[7],o[8]),i=new f.Mesh(r,new f.MeshLambertMaterial({map:n,color:t.props.textureColor}));i.position.set(o[0],o[1],o[2]),i.rotation.set(Math.PI*o[3],Math.PI*o[4],Math.PI*o[5]),i.tid=e,t.scene.add(i)})})}},{key:"componentDidUpdate",value:function(e){var t,n;t=this.props,n=e,(t.cameraRadius!==n.cameraRadius||t.cameraAngleA!==n.cameraAngleA||t.cameraAngleB!==n.cameraAngleB)&&so(this,this.props)}},{key:"componentWillUnmount",value:function(){this.intersected=null,$n.remove("cameraController")}},{key:"onMouseMove",value:function(e){var t=e.nativeEvent.offsetX,n=e.nativeEvent.offsetY,o=this.container.offsetWidth,r=this.container.offsetHeight,i=new f.Vector3(t/o*2-1,-n/r*2+1,1);i.unproject(this.camera),this.raycaster.ray.set(this.camera.position,i.sub(this.camera.position).normalize());var a=this.raycaster.intersectObjects(this.scene.children);a.length>0?this.intersected!==a[0].object&&(this.intersected&&this.intersected.material.setValues({color:this.props.textureColor}),this.intersected=a[0].object,this.intersected.material.setValues({color:this.props.hoverColor})):this.intersected&&(this.intersected.material.setValues({color:this.props.textureColor}),this.intersected=null)}},{key:"onMouseDown",value:function(e){this.mousedown=!0,this.props.parentStage.isCameraRotating=!0,this.mousePos=[e.clientX,e.clientY],window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}},{key:"onWindowMouseMove",value:function(e){var t=e.clientY-this.mousePos[1],n=e.clientX-this.mousePos[0],o=this.props.cameraAngleA,r=this.props.cameraAngleB;0===t&&0===n||(this.mousePos=[e.clientX,e.clientY],t=this.props.cameraMoveSpeed*t*90/Math.PI/window.screen.availHeight,t=o<90&&o+t>90?0:t,o+=t=o>-90&&o+t<-90?0:t,r=(r=(r+=this.props.cameraMoveSpeed*n*90/Math.PI/window.screen.availWidth)>360?r-360:r)<0?r+360:r,this.props.parentStage.isCameraRotating=!0,this.context.dispatch("changeCamera3D",{cameraAngleA:o,cameraAngleB:r}))}},{key:"onWindowMouseUp",value:function(){this.mousedown=!1,this.props.parentStage.isCameraRotating=!1,window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp)}},{key:"onMouseUp",value:function(){if(this.mousedown=!1,this.props.parentStage.isCameraRotating=!1,null!=this.intersected){var e=to[this.intersected.tid];this.context.dispatch("changeCamera3D",{cameraAngleA:null!=e[0]?e[0]:this.props.cameraAngleA,cameraAngleB:null!=e[1]?e[1]:this.props.cameraAngleB})}}},{key:"onMouseOut",value:function(){this.intersected&&this.intersected.material.setValues({color:this.props.textureColor}),this.intersected=null}},{key:"render",value:function(){var e=this,t={className:"tc-camera-controller",ref:function(t){e.container=t},onMouseMove:this.onMouseMove,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseOut:this.onMouseOut};return a.a.createElement("div",t)}}])&&oo(n.prototype,o),r&&oo(n,r),t}();function uo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function po(e){e.anchors.map(function(t){t.added&&(t.added=!1,e.scene.remove(t))})}co(lo,"contextTypes",{dispatch:ge.a.func.isRequired}),co(lo,"propTypes",{cameraRadius:ge.a.number,cameraAngleA:ge.a.number,cameraAngleB:ge.a.number,cameraMoveSpeed:ge.a.number,textureColor:ge.a.number,hoverColor:ge.a.number,parentStage:ge.a.object.isRequired}),co(lo,"defaultProps",{cameraRadius:90,cameraAngleA:40,cameraAngleB:45,cameraMoveSpeed:2,textureColor:16777215,hoverColor:14252309});var ho=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t,{mesh:null,vector:null,anchors:[],controller:new Yn.a(t.camera,t.renderer.domElement)}),this.controller.addEventListener("objectChange",function(){if(this.vector&&this.mesh){var e=this.vector,t=this.mesh,n=this.anchorSize,o=this.renderer,r=this.camera,i=o.domElement.offsetWidth,a=O(e.position.x,e.position.y,e.position.z,t),c=t.tc.vectorLinkHash&&t.tc.vectorLinkHash[e.index]?[e.index].concat(t.tc.vectorLinkHash[e.index]):[e.index],s=t.geometry.vertices;c.map(function(e){s[e].x=a[0],s[e].y=a[1],s[e].z=a[2]}),t.geometry.verticesNeedUpdate=!0,e.scale.x=e.scale.y=e.scale.z=1500*r.position.distanceTo(e.position)/n/i}}.bind(this))}var t,n,o;return t=e,(n=[{key:"attach",value:function(e){if(e){this.mesh=e,this.vector=null,po(this);var t=this.camera.position,n=w(e),o=e.geometry.vertices,r=this.anchors,i=this.scene,a=this.anchorSize,c=this.anchorColor,s=this.renderer.domElement.offsetWidth,l=[];o.map(function(o,u){var p=x(o.x,o.y,o.z,n,e),h=new f.Vector3(p[0],p[1],p[2]),m=null;if(u===r.length){var d=new f.SpriteMaterial({map:(new f.TextureLoader).load("resource/textures/sprites/disc.png"),color:c});(m=new f.Sprite(d)).tc={materialColor:m.material.color.getHex(),index:u},r.push(m)}else m=r[u];m.index=u,m.position.x=p[0],m.position.y=p[1],m.position.z=p[2],m.scale.x=m.scale.y=m.scale.z=(36-s/80)*h.distanceTo(t)/a,l.indexOf(u)>-1||(m.added=!0,i.add(m),l=[].concat(l,[u],e.tc.vectorLinkHash[u]))})}}},{key:"detach",value:function(){this.mesh=null,this.vector=null,po(this)}},{key:"attachAnchor",value:function(e){this.controller.attach(e),this.vector=e}},{key:"detachAnchor",value:function(){this.controller.detach(),this.vector=null}},{key:"updateAnchors",value:function(){var e=this.camera.position,t=this.anchorSize,n=this.renderer.domElement.offsetWidth;this.anchors.map(function(o){o.added&&(o.scale.x=o.scale.y=(36-n/100)*e.distanceTo(o.position)/t)})}},{key:"setAnchorColor",value:function(e){this.anchors.map(function(t){t.tc.materialColor=e,t.material.setValues({color:e})})}},{key:"setAnchorSize",value:function(e){e=Math.min(e,1e3),e=Math.max(e,500),this.anchorSize=e,this.updateAnchors()}}])&&uo(t.prototype,n),o&&uo(t,o),e}();function fo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mo(e){var t=e.anchors,n=e.scene;Object.keys(t).map(function(e){n.remove(t[e])})}var yo=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t,{controller:new Yn.a(t.camera,t.renderer.domElement),anchors:{},anchorArray:[]}),this.controller.addEventListener("objectChange",function(e){var t=e.target.object,n=this.lights[t.tc.lightKey];n&&n.position.set(t.position.x,t.position.y,t.position.z)}.bind(this))}var t,n,o;return t=e,(n=[{key:"attach",value:function(e){var t=this,n=this.scene,o=this.anchors,r=this.camera,i=[];this.lights=e||this.lights,mo(this),Object.keys(this.lights).map(function(e){var a=t.lights[e],c=o[a.uuid]?o[a.uuid]:new f.Mesh(new f.SphereGeometry(20,20,20),new f.MeshBasicMaterial({color:16755200}));o[e]=c,c.material.color.setHex(a.color.getHex()),c.position.set(a.position.x,a.position.y,a.position.z),c.scale.x=c.scale.y=c.scale.z=a.position.distanceTo(r.position)/2e3,c.tc={materialColor:a.color.getHex(),lightKey:e},n.add(c),i.push(c)}),this.anchorArray=i}},{key:"update",value:function(){var e=this.camera,t=this.anchors;Object.keys(t).map(function(n){var o=t[n];o.scale.x=o.scale.y=o.scale.z=o.position.distanceTo(e.position)/2e3})}},{key:"detach",value:function(){mo(this),this.anchorArray=[]}}])&&fo(t.prototype,n),o&&fo(t,o),e}();function bo(e,t,n,o){var r=n.refs.container.offsetWidth,i=n.refs.container.offsetHeight;n.raycaster.setFromCamera(new f.Vector3(e/r*2-1,-t/i*2+1,0),n.camera);var a=n.raycaster.intersectObjects([o]);return a.length>0?a[0].point.clone():new f.Vector3}function go(e,t){var n=t=t||e.props,o=n.cameraAngleA,r=n.cameraAngleB,i=n.cameraRadius,a=n.cameraLookAt,c=e.coordinateContainer,s=e.grid,l=e.camera,u=i*Math.sin(Math.PI*o/180),p=i*Math.cos(Math.PI*o/180)*Math.cos(Math.PI*r/180),h=i*Math.cos(Math.PI*o/180)*Math.sin(Math.PI*r/180);Math.abs(o)<2?(c.rotation.z=s.rotation.z=.5*Math.PI-Math.PI*r/180,c.rotation.x=s.rotation.x=1.5*Math.PI):(c.rotation.z=s.rotation.z=0,c.rotation.x=s.rotation.x=0),l.position.set(p+a.x,u+a.y,h+a.z)}function vo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ko(e,t){var n=t.props;if(n.mesh3d!==e.mesh3d){var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){vo(e,t,n[t])})}return e}({},e.mesh3d);Object.keys(n.mesh3d).map(function(e){var r=n.mesh3d[e];delete o[r.uuid],r.tc.add||(r.tc.add=!0,t.scene.add(r))}),Object.keys(o).map(function(e){t.scene.remove(o[e])})}}function wo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oo(e,t){var n=t.props;if(n.lights!==e.lights){t.lightHelper.lights=n.lights;var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){wo(e,t,n[t])})}return e}({},e.lights);t.lightArray=[],Object.keys(n.lights).map(function(e){var r=n.lights[e];t.lightArray.push(r),delete o[e],r.tc.add||(r.tc.add=!0,t.scene.add(r))}),Object.keys(o).map(function(e){var n=o[e];t.scene.remove(n);var r=null;t.lightHelper.anchorArray.map(function(t){t.tc.lightKey===e&&(r=t)}),r&&t.scene.remove(r)})}}n(128);function xo(e){return(xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Co(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mo(e){return(Mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Do(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jo(e,t){return(jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Po(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var So=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Mo(t).call(this,e))||"object"!==xo(r)&&"function"!=typeof r?Do(o):r).onResize=n.onResize.bind(Do(n)),n.onMouseWheel=n.onMouseWheel.bind(Do(n)),n.onMouseMove=n.onMouseMove.bind(Do(n)),n.onMouseDown=n.onMouseDown.bind(Do(n)),n.onMouseUp=n.onMouseUp.bind(Do(n)),n.onContextMenu=n.onContextMenu.bind(Do(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jo(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){var e=this;function t(){e.isDragging=!0,e.props.selectedMesh&&e.props.selectedMesh.tc&&(e.props.selectedMesh.tc.needUpdate="all"===e.props.view?4:1,e.context.dispatch("updateTimer"))}this.mousedown=!1,this.mouseCurrent2D={x:0,y:0},this.mouseCurrent3D={x:0,y:0,z:0},this.raycaster=new f.Raycaster,this.grid=new f.GridHelper(this.props.gridSize,this.props.gridStep,this.props.colorGrid,this.props.colorGrid),this.axis=new f.AxesHelper(200),this.coordinate=new f.Mesh(new f.PlaneGeometry(1e4,1e4,1,1),new f.MeshBasicMaterial({visible:!1,side:f.DoubleSide})),this.coordinateContainer=new f.Object3D,this.camera=new f.PerspectiveCamera(60,this.refs.container.offsetWidth/this.refs.container.offsetHeight,1,2e4),this.scene=new f.Scene,this.renderer=new f.WebGLRenderer({antialias:!0}),this.transformer=new Yn.a(this.camera,this.renderer.domElement),this.lightHelper=new yo({scene:this.scene,camera:this.camera,renderer:this.renderer,lights:this.props.lights}),this.morpher=new ho({camera:this.camera,scene:this.scene,renderer:this.renderer,anchorColor:this.props.morpher3Dinfo.anchorColor,anchorSize:this.props.morpher3Dinfo.anchorSize}),this.scene.add(this.grid),this.scene.add(this.axis),this.scene.add(this.transformer),this.scene.add(this.morpher.controller),this.scene.add(this.lightHelper.controller),this.scene.add(this.coordinateContainer),this.grid.visible=this.props.gridVisible,this.axis.visible=this.props.gridVisible,this.coordinate.rotation.x=.5*Math.PI,this.coordinateContainer.add(this.coordinate),this.renderer.setClearColor(this.props.colorStage),this.renderer.setSize(this.refs.container.offsetWidth-1,this.refs.container.offsetHeight),this.transformer.setSpace(this.props.transformer3Dinfo.space),this.transformer.setMode(this.props.transformer3Dinfo.mode),this.transformer.setSize(this.props.transformer3Dinfo.size),this.refs.container.appendChild(this.renderer.domElement),go(this,this.props),window.addEventListener("resize",this.onResize),this.refs.container.addEventListener("mousewheel",this.onMouseWheel),this.transformer.addEventListener("objectChange",t),this.morpher.controller.addEventListener("objectChange",t),this.lightHelper.controller.addEventListener("objectChange",t),$n.add("stage3d",function(e){return function(){var t=e.props.cameraLookAt,n=t.x,o=t.y,r=t.z;e.camera.lookAt(n,o,r),e.renderer.render(e.scene,e.camera),"pickLight"===e.props.tool&&e.lightHelper.update(),"pickLight"===e.props.tool&&e.props.selectedLight&&e.lightHelper.controller.update(),"pickMesh"===e.props.tool&&e.props.selectedMesh&&e.transformer.update(),"pickJoint"===e.props.tool&&e.props.selectedVector&&e.morpher.controller.update()}}(this)),function(e){Object.keys(e.props.lights).map(function(t){e.scene.add(e.props.lights[t])}),Object.keys(e.props.mesh3d).map(function(t){e.scene.add(e.props.mesh3d[t])})}(this),function(e){"pickMesh"===e.props.tool&&e.transformer[e.props.selectedMesh?"attach":"detach"](e.props.selectedMesh),"pickJoint"===e.props.tool&&(e.morpher[e.props.selectedMesh?"attach":"detach"](e.props.selectedMesh),e.props.selectedMesh&&e.props.selectedVector?e.morpher.attachAnchor(e.morpher.anchors[e.props.selectedVector.tc.index]):e.props.selectedMesh&&e.props.selectedVectorIndex>-1&&e.morpher.anchors[e.props.selectedVectorIndex]&&e.morpher.anchors[e.props.selectedVectorIndex].added?e.context.dispatch("pickJointAnchor",e.morpher.anchors[e.props.selectedVectorIndex]):e.morpher.detachAnchor()),"pickLight"===e.props.tool&&(e.lightHelper.attach(),e.props.selectedLight?e.lightHelper.controller.attach(e.lightHelper.anchors[e.props.selectedLight.tc.lightKey]):e.lightHelper.controller.detach())}(this),setTimeout(this.onResize,300)}},{key:"componentDidUpdate",value:function(e){!function(e,t){var n=t.props;n.cameraRadius===e.cameraRadius&&n.cameraAngleA===e.cameraAngleA&&n.cameraAngleB===e.cameraAngleB&&n.cameraLookAt===e.cameraLookAt||(go(t,n),"pickJoint"===n.tool&&n.selectedMesh&&t.morpher.updateAnchors())}(e,this),function(e,t){var n=t.props;n.gridSize===e.gridSize&&n.gridStep===e.gridStep||(t.scene.remove(t.grid),t.grid=new f.GridHelper(n.gridSize,n.gridStep,n.colorGrid,n.colorGrid),t.grid.visible=n.gridVisible,t.scene.add(t.grid)),n.gridVisible!==e.gridVisible&&(t.grid.visible=n.gridVisible,t.axis.visible=n.gridVisible)}(e,this),ko(e,this),Oo(e,this),function(e,t){var n=t.props;("pickMesh"===n.tool&&"pickMesh"!==e.tool||n.selectedMesh!==e.selectedMesh&&"pickMesh"===n.tool)&&t.transformer[n.selectedMesh?"attach":"detach"](n.selectedMesh),"pickMesh"!==n.tool&&"pickMesh"===e.tool&&t.transformer.detach(),n.transformer3Dinfo!==e.transformer3Dinfo&&(t.transformer.setSpace("rotate"===n.transformer3Dinfo.mode?"local":n.transformer3Dinfo.space),t.transformer.setMode(n.transformer3Dinfo.mode),t.transformer.setSize(n.transformer3Dinfo.size))}(e,this),function(e,t){var n=t.props;"pickJoint"===n.tool&&"pickJoint"===e.tool&&n.selectedMesh&&n.selectedMesh===e.selectedMesh&&n.selectedMesh.tc.needUpdate&&(t.morpher.attach(n.selectedMesh),n.selectedVector&&t.morpher.attachAnchor(n.selectedVector)),("pickJoint"===n.tool&&"pickJoint"!==e.tool||n.selectedMesh!==e.selectedMesh&&"pickJoint"===n.tool)&&(t.morpher[n.selectedMesh?"attach":"detach"](n.selectedMesh),t.morpher.detachAnchor()),n.selectedVector!==e.selectedVector&&"pickJoint"===n.tool&&t.morpher[n.selectedVector?"attachAnchor":"detachAnchor"](n.selectedVector),"pickJoint"!==n.tool&&"pickJoint"===e.tool&&(t.morpher.detach(),t.morpher.detachAnchor()),"pickJoint"===n.tool&&n.selectedVectorIndex!==e.selectedVectorIndex&&t.morpher.mesh&&t.morpher.anchors[n.selectedVectorIndex]&&t.morpher.anchors[n.selectedVectorIndex].added&&(!n.selectedVector||n.selectedVector&&n.selectedVector.tc.index!==n.selectedVectorIndex)&&t.context.dispatch("pickJointAnchor",t.morpher.anchors[n.selectedVectorIndex]),n.morpher3Dinfo!==e.morpher3Dinfo&&(t.morpher.setAnchorColor(n.morpher3Dinfo.anchorColor),t.morpher.setAnchorSize(n.morpher3Dinfo.anchorSize))}(e,this),function(e,t){var n,o=t.props;if("pickLight"===o.tool&&"pickLight"!==e.tool&&t.lightHelper.attach(),"string"==typeof o.selectedLight)return n=null,t.lightHelper.anchorArray.map(function(e){e.tc.lightKey===o.selectedLight&&(n=e)}),void(n&&t.context.dispatch("selectLight",null,n));"pickLight"!==o.tool&&"pickLight"===e.tool&&(t.lightHelper.detach(),t.lightHelper.controller.detach()),o.selectedLight!==e.selectedLight&&"pickLight"===o.tool&&t.lightHelper.controller[o.selectedLight?"attach":"detach"](o.selectedLight)}(e,this),this.props.selectedMesh&&this.props.selectedMesh.tc.needUpdate&&this.props.selectedMesh.tc.needUpdate--;var t=this.refs.container;!t||t.offsetWidth===this.offsetWidth&&t.offsetHeight===this.offsetHeight||this.onResize()}},{key:"componentWillUnmount",value:function(){$n.remove("stage3d"),window.removeEventListener("resize",this.onResize),this.refs.container.removeEventListener("mousewheel",this.onMouseWheel)}},{key:"onMouseWheel",value:function(e){var t=this.props.cameraRadius-.2*this.props.cameraRadius*e.wheelDelta*this.props.cameraMoveSpeed/this.refs.container.offsetWidth;return t=Math.max(t,50),t=Math.min(t,5e3),this.context.dispatch("changeCamera3D",{cameraRadius:t}),e.stopPropagation(),!1}},{key:"onResize",value:function(){this.offsetWidth=this.refs.container.offsetWidth,this.offsetHeight=this.refs.container.offsetHeight,this.camera.aspect=this.refs.container.offsetWidth/this.refs.container.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.refs.container.offsetWidth-1,this.refs.container.offsetHeight)}},{key:"onMouseMove",value:function(e){var t={x:e.clientX,y:e.clientY},n=bo(e.nativeEvent.offsetX,e.nativeEvent.offsetY,this,this.coordinate),o={x:t.x-this.mouseCurrent2D.x,y:t.y-this.mouseCurrent2D.y},r={x:n.x-this.mouseCurrent3D.x,y:n.y-this.mouseCurrent3D.y,z:n.z-this.mouseCurrent3D.z};this.mouseCurrent2D=t,this.mouseCurrent3D=n,this.context.dispatch("changeMouse3D",n);var i={event:e,cameraInfo:{radius:this.props.cameraRadius,angleA:this.props.cameraAngleA,angleB:this.props.cameraAngleB,lookAt:this.props.cameraLookAt},stage3D:this,mouseDown2D:this.mouseDown2D,mouseDown3D:this.mouseDown3D,mouseCurrent2D:t,mouseCurrent3D:n,mouseDelta2D:o,mouseDelta3D:r};this.props.tool&&this.mousedown&&!this.isCameraRotating?this.context.dispatch(this.props.tool,i,!0):this.props.tool&&!this.isCameraRotating&&this.context.dispatch(this.props.tool,i,!1)}},{key:"onMouseDown",value:function(e){this.mousedown=0===e.nativeEvent.button,this.mouseDown2D={x:e.clientX,y:e.clientY},this.mouseDown3D=bo(e.nativeEvent.offsetX,e.nativeEvent.offsetY,this,this.coordinate),this.mouseCurrent2D={x:e.clientX,y:e.clientY},this.mouseCurrent3D=this.mouseDown3D.clone()}},{key:"onMouseUp",value:function(){if(this.mousedown=!1,this.mouseDown2D={x:0,y:0},this.mouseDown3D={x:0,y:0,z:0},this.mouseCurrent2D={x:0,y:0},this.mouseCurrent3D={x:0,y:0,z:0},!this.isDragging)return this.tempMesh&&!this.isCameraRotating?(this.context.dispatch("addMesh",this.tempMesh),void(this.tempMesh=null)):void("string"==typeof this.props.tool&&this.context.dispatch(this.props.tool,"mouseup"));this.isDragging=!1}},{key:"onContextMenu",value:function(e){this.context.dispatch("clearSelected"),e.stopPropagation(),e.preventDefault()}},{key:"render",value:function(){var e={className:"tc-stage-3d",ref:"container",onMouseMove:this.onMouseMove,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onContextMenu},t={parentStage:this,cameraAngleA:this.props.cameraAngleA,cameraAngleB:this.props.cameraAngleB};return a.a.createElement("div",e,a.a.createElement(lo,t))}}])&&Co(n.prototype,o),r&&Co(n,r),t}();Po(So,"contextTypes",{dispatch:ge.a.func}),Po(So,"propTypes",{tool:ge.a.string.isRequired,lights:ge.a.object.isRequired,morpher3Dinfo:ge.a.object.isRequired,transformer3Dinfo:ge.a.object.isRequired,cameraRadius:ge.a.number,cameraMoveSpeed:ge.a.number,cameraAngleA:ge.a.number,cameraAngleB:ge.a.number,cameraLookAt:ge.a.object,gridSize:ge.a.number,gridStep:ge.a.number,colorGrid:ge.a.number,colorStage:ge.a.number,gridVisible:ge.a.bool,selectedMesh:ge.a.object}),Po(So,"defaultProps",{selectedMesh:null,cameraRadius:1e3,cameraAngleA:40,cameraAngleB:45,cameraLookAt:{x:0,y:0,z:0},cameraMoveSpeed:4,gridVisible:!0,gridSize:2500,gridStep:50,colorStage:16777215,colorGrid:16777215});var Eo=n(64),Ao=n.n(Eo),_o=function(e,t){var n=t.container.offsetWidth,o=t.container.offsetHeight,r=t.axis,i={v:r.join("o"),a:t.cameraAngleA,b:(t.cameraAngleB%360+360)%360},a=[t.cameraLookAt[r[0]],t.cameraLookAt[r[1]]],c="xoz"===i.v?i.b-90:0,s=t.cameraRadius/1e3;return function(t,r){return M[e](t,r,n,o,a,s,c,i)}};function zo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Io={x:"#FF1600",y:"#10FF00",z:"#0013FF"};function Lo(e,t,n,o,r,i,a){e.beginPath(),e.lineWidth=i,e.strokeStyle=a,e.moveTo(t,n),e.lineTo(o,r),e.stroke()}var To=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t)}var t,n,o;return t=e,(n=[{key:"getMouse3D",value:function(e,t){return _o("screen2axis",this)(e,t)}},{key:"render",value:function(){var e,t,n,o,r,i,a,c,s,l,u=this.lineColor,p=this.container.offsetWidth,h=this.container.offsetHeight,f=this.canvas.getContext("2d"),m=_o("screen2axis",this),d=_o("axis2screen",this);for(e=m(0,0),t=m(p,0),n=m(p,h),o=m(0,h),r=Math.min(e[0],t[0],n[0],o[0]),i=Math.max(e[0],t[0],n[0],o[0]),a=Math.min(e[1],t[1],n[1],o[1]),c=Math.max(e[1],t[1],n[1],o[1]),r=50*(parseInt(r/50,10)+(r>0?2:-2)),i=50*(parseInt(i/50,10)+(i>0?2:-2)),a=50*(parseInt(a/50,10)+(a>0?2:-2)),c=50*(parseInt(c/50,10)+(c>0?2:-2)),s=[r],l=[a];r+50<=i;)s.push(r+=50);for(;a+50<=c;)l.push(a+=50);this.canvas.width=p,this.canvas.height=h,f.clearRect(0,0,p,h),s.map(function(n){e=d(n,l[0]),t=d(n,l[l.length-1]),Lo(f,e[0],e[1],t[0],t[1],1,u)}),l.map(function(n){e=d(s[0],n),t=d(s[s.length-1],n),Lo(f,e[0],e[1],t[0],t[1],1,u)}),e=d(0,0),t=d(200,0),n=d(0,200),Lo(f,e[0],e[1],t[0],t[1],2,Io[this.axis[0]]),Lo(f,e[0],e[1],n[0],n[1],2,Io[this.axis[1]])}}])&&zo(t.prototype,n),o&&zo(t,o),e}(),No=function(e){return{x:e[0],y:e[1],z:e[2]}};function Ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Vo=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t),this.update()}var t,n,o;return t=e,(n=[{key:"update",value:function(){var e=this.mesh3d,t=w(e);this.vertices=e.geometry.vertices.map(function(n){return No(x(n.x,n.y,n.z,t,e))})}}])&&Ro(t.prototype,n),o&&Ro(t,o),e}();function Bo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Fo(e,t,n,o,r){var i=Math.sqrt((e-n)*(e-n)+(t-o)*(t-o)),a=(n-e)/i,c=(o-t)/i;r.moveTo(e+1*c,t-1*a),r.lineTo(n+1*c,o-1*a),r.lineTo(n-1*c,o+1*a),r.lineTo(e-1*c,t+1*a),r.lineTo(e+1*c,t-1*a)}var Ho=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t)}var t,n,o;return t=e,(n=[{key:"render",value:function(e,t){var n=this,o=this.container.offsetWidth,r=this.container.offsetHeight,i=this.axis,a=_o("axis2screen",this),c=this.canvas.getContext("2d");if(this.canvas.width=o,this.canvas.height=r,c.clearRect(0,0,o,r),0!==Object.keys(this.mesh3d).length){var s,l;this.mesh2d=(s=this.mesh3d,l=(l=this.mesh2d)||{},Object.keys(s).map(function(e){l[e]||(l[e]=new Vo({mesh3d:s[e]}))}),Object.keys(l).map(function(e){s[e]||delete l[e]}),l);var u=null;return Object.keys(this.mesh2d).map(function(o){var r=n.mesh2d[o],s=r.mesh3d;if(s.visible){for(var l=r.vertices,p=s.material.color.getHex().toString(16);p.length<6;)p="0"+p;c.beginPath(),c.lineStyle=2,c.fillStyle="#"+p,s.geometry.faces.map(function(e){var t=i[0],n=i[1],o=a(l[e.a][t],l[e.a][n]),r=a(l[e.b][t],l[e.b][n]),s=a(l[e.c][t],l[e.c][n]);Fo(o[0],o[1],r[0],r[1],c),Fo(r[0],r[1],s[0],s[1],c),Fo(s[0],s[1],o[0],o[1],c)}),u=isNaN(e)||isNaN(t)||!c.isPointInPath(e,t)?u:s,c.fill()}}),u}}},{key:"getObject2dByMouse2D",value:function(e,t){return e-=this.container.offsetLeft,t-=this.container.offsetTop,this.render(e,t)}}])&&Bo(t.prototype,n),o&&Bo(t,o),e}(),Go=function(e){return function(t,n,o){var r=M.getRotateMatrix(e.mesh),i=M.local2world(t,n,o,r,e.mesh);return No(i)}},Uo={x:"#FF0000",y:"#00FF00",z:"#0000FF",xz:"rgba(255,0,0,0.3)",xy:"rgba(255,255,0,0.3)",zy:"rgba(0,255,0,0.3)",xoz:"rgba(0,255,0,0.8)",xoy:"rgba(0,0,255,0.8)",yoz:"rgba(255,0,0,0.8)"};function Wo(e,t,n){var o=t.o[0],r=t.o[1],i=t[e][0],a=t[e][1],c=t["sin"+e],s=t["cos"+e],l=100*n;return[["M",o+2*s,r-2*c],["L",(i=l*c+o)+2*s,(a=l*s+r)-2*c],["L",i+6*s,a-6*c],["L",(6+l)*c+o,(6+l)*s+r],["L",i-6*s,a+6*c],["L",i-2*s,a+2*c],["L",o-2*s,r+2*c],["L",o+2*s,r-2*c],["M",o+2*s,r-2*c]]}function Jo(e,t,n,o){n=n||"a",o=o||"b";var r=e.o[0],i=e.o[1],a=(e[n][0],e[n][1],e[o][0],e[o][1],e["sin"+n]),c=e["cos"+n],s=e["sin"+o],l=e["cos"+o],u=50*t,p=50*t;return[["M",r,i],["L",u*a+r,u*c+i],["L",u*a+p*s+r,u*c+p*l+i],["L",p*s+r,p*l+i],["M",r,i]]}function qo(e,t,n){e.map(function(e){e.attr("cursor",t).mouseover(function(){this["___"+n+"___"]=this.attr(n),this.attr(n,"#FFFF00")}).mouseout(function(){this.attr(n,this["___"+n+"___"])})})}function Yo(e,t){return function(){t.command=e}}function Xo(e){var t,n,o=e.axis,r=_o("axis2screen",e),i=Go(e),a=[],c=[],s=[],l=100*e.size*e.cameraRadius/1e3;for(n=0;n<360;n+=10)t=i(l*Math.cos(.01744*n),l*Math.sin(.01744*n),0),c.push(r(t[o[0]],t[o[1]])),t=i(l*Math.cos(.01744*n),0,l*Math.sin(.01744*n)),a.push(r(t[o[0]],t[o[1]])),t=i(0,l*Math.cos(.01744*n),l*Math.sin(.01744*n)),s.push(r(t[o[0]],t[o[1]]));e.helpInfo={faces:[[a,Uo.xoz,"y"],[c,Uo.xoy,"z"],[s,Uo.yoz,"x"]],axis2screen:r,local2world:i,screen2axis:_o("screen2axis",e)},e.helpers=function(e,t){var n={"stroke-width":3};return e.faces.map(function(e){return t.svg.path((o=e[0],[].concat(o,[o[0]]).map(function(e,t){return[0===t?"M":"L",e[0],e[1]]}))).attr(n).attr({stroke:e[1]}).mousedown(Yo(e[2],t));var o})}(e.helpInfo,e),qo(e.helpers,"e-resize","stroke")}var Ko={translate:{world:function(e){var t=e.axis,n=_o("axis2screen",e),o=Go(e),r=o(0,0,0),i={x:r.x,y:r.y,z:r.z};i[t[0]]+=100,i=n(i[t[0]],i[t[1]]);var a={x:r.x,y:r.y,z:r.z};a[t[1]]+=100,a=n(a[t[0]],a[t[1]]),r=n(r[t[0]],r[t[1]]);var c=Math.sqrt((r[0]-i[0])*(r[0]-i[0])+(r[1]-i[1])*(r[1]-i[1])),s=Math.sqrt((r[0]-a[0])*(r[0]-a[0])+(r[1]-a[1])*(r[1]-a[1]));e.helpInfo={o:r,a:i,b:a,sina:(i[0]-r[0])/c,cosa:(i[1]-r[1])/c,sinb:(a[0]-r[0])/s,cosb:(a[1]-r[1])/s,axis2screen:n,local2world:o,screen2axis:_o("screen2axis",e)},e.helpers=function(e,t){var n=t.axis;return[t.svg.path(Jo(e,t.size)).attr({fill:Uo[n.join("")]}).mousedown(Yo("o",t)),t.svg.path(Wo("a",e,t.size)).attr({fill:Uo[n[0]]}).mousedown(Yo(n[0],t)),t.svg.path(Wo("b",e,t.size)).attr({fill:Uo[n[1]]}).mousedown(Yo(n[1],t))]}(e.helpInfo,e),qo(e.helpers,"pointer","fill")},local:function(e){var t=e.axis,n=_o("axis2screen",e),o=Go(e),r=o(0,0,0);r=n(r[t[0]],r[t[1]]);var i=o(100,0,0);i=n(i[t[0]],i[t[1]]);var a=o(0,100,0);a=n(a[t[0]],a[t[1]]);var c=o(0,0,100);c=n(c[t[0]],c[t[1]]);var s=Math.sqrt((r[0]-i[0])*(r[0]-i[0])+(r[1]-i[1])*(r[1]-i[1])),l=Math.sqrt((r[0]-a[0])*(r[0]-a[0])+(r[1]-a[1])*(r[1]-a[1])),u=Math.sqrt((r[0]-c[0])*(r[0]-c[0])+(r[1]-c[1])*(r[1]-c[1]));e.helpInfo={o:r,a:i,b:a,c:c,sina:(i[0]-r[0])/s,cosa:(i[1]-r[1])/s,sinb:(a[0]-r[0])/l,cosb:(a[1]-r[1])/l,sinc:(c[0]-r[0])/u,cosc:(c[1]-r[1])/u,axis2screen:n,local2world:o,screen2axis:_o("screen2axis",e)},e.helpers=function(e,t){var n=Wo("a",e,t.size),o=Wo("b",e,t.size),r=Wo("c",e,t.size),i=[];return a(n)&&i.push(t.svg.path(n).attr({fill:Uo.x}).mousedown(Yo("a",t))),a(o)&&i.push(t.svg.path(o).attr({fill:Uo.y}).mousedown(Yo("b",t))),a(r)&&i.push(t.svg.path(r).attr({fill:Uo.z}).mousedown(Yo("c",t))),i;function a(e){var t=JSON.stringify(e).toLowerCase();return t.indexOf("null")<0&&t.indexOf("nan")<0}}(e.helpInfo,e),qo(e.helpers,"pointer","fill")}},rotate:{local:Xo,world:Xo}};function Zo(e,t,n){var o=n.mesh,r=Math.sqrt(e*e+t*t);o["rotate"+n.command.toUpperCase()]((e>0?1:-1)*r*.01744),"function"==typeof n.onChange&&n.onChange()}var Qo={translate:{world:function(e,t,n){var o=n.mesh,r=n.helpInfo,i=(r.cosb*e-r.sinb*t)/(r.sina*r.cosb-r.sinb*r.cosa),a=(r.cosa*e-r.sina*t)/(r.cosa*r.sinb-r.cosb*r.sina);i=n.command===n.axis[1]?0:i,a=n.command===n.axis[0]?0:a,e=i*r.sina+a*r.sinb,t=i*r.cosa+a*r.cosb;var c=r.screen2axis(r.o[0],r.o[1]),s=r.screen2axis(r.o[0]+e,r.o[1]+t),l={x:0,y:0,z:0};l[n.axis[0]]=s[0]-c[0],l[n.axis[1]]=s[1]-c[1],o.position.set(o.position.x+l.x,o.position.y+l.y,o.position.z+l.z),"function"==typeof n.onChange&&n.onChange()},local:function(e,t,n){var o,r,i,a=n.mesh,c=n.helpInfo,s=Math.sqrt(e*e+t*t)*n.cameraRadius/1e3,l=n.command,u=(o=n.command,r=c,i="",["a","b","c"].map(function(e){e===o||isNaN(r["sin"+e])||isNaN(r["cos"+e])||(i=e)}),i),p=(c["cos"+u]*e-c["sin"+u]*t)/(c["sin"+l]*c["cos"+u]-c["sin"+u]*c["cos"+l]),h=(c["cos"+l]*e-c["sin"+l]*t)/(c["cos"+l]*c["sin"+u]-c["cos"+u]*c["sin"+l]);if(p=n.command===l?p:0,h=n.command===u?h:0,p=0===p?0:p/Math.abs(p)*s,h=0===h?0:p/Math.abs(h)*s,!isNaN(p)&&!isNaN(h)){var f={a:0,b:0,c:0};f[l]+=p,f[u]+=h,f=c.local2world(f.a,f.b,f.c),a.position.set(f.x,f.y,f.z),"function"==typeof n.onChange&&n.onChange()}}},rotate:{local:Zo,world:Zo}};function $o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function er(e){this.mesh&&this.command&&(this.container.addEventListener("mouseup",this.containerMouseUpHandler),this.container.addEventListener("mousemove",this.containerMouseMoveHandler),this.mouseX=e.clientX,this.mouseY=e.clientY)}function tr(e){if(this.mesh&&this.command&&Qo[this.mode]&&Qo[this.mode][this.space]){var t=e.clientX-this.mouseX,n=e.clientY-this.mouseY;this.mouseX=e.clientX,this.mouseY=e.clientY,Qo[this.mode][this.space](t,n,this)}}function nr(){this.command="",this.container.removeEventListener("mouseup",this.containerMouseUpHandler),this.container.removeEventListener("mousemove",this.containerMouseMoveHandler)}var or=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t,{mesh:null,helpers:[],containerMouseDownHandler:er.bind(this),containerMouseUpHandler:nr.bind(this),containerMouseMoveHandler:tr.bind(this)}),this.container.addEventListener("mousedown",this.containerMouseDownHandler)}var t,n,o;return t=e,(n=[{key:"attach",value:function(e){for(;this.helpers.length;)this.helpers.pop().remove();this.mesh=e,e&&Ko[this.mode]&&Ko[this.mode][this.space]&&Ko[this.mode][this.space](this)}},{key:"detach",value:function(){for(;this.helpers.length;)this.helpers.pop().remove();this.mesh=null}}])&&$o(t.prototype,n),o&&$o(t,o),e}();function rr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ir={x:"#FF0000",y:"#00FF00",z:"#0000FF",xz:"rgba(255,0,0,0.3)",xy:"rgba(255,255,0,0.3)",zy:"rgba(0,255,0,0.3)",xoz:"rgba(0,255,0,0.8)",xoy:"rgba(0,0,255,0.8)",yoz:"rgba(255,0,0,0.8)"};function ar(e,t,n){var o=t.o[0],r=t.o[1],i=t[e][0],a=t[e][1],c=t["sin"+e],s=t["cos"+e],l=100*n;return[["M",o+2*s,r-2*c],["L",(i=l*c+o)+2*s,(a=l*s+r)-2*c],["L",i+6*s,a-6*c],["L",(6+l)*c+o,(6+l)*s+r],["L",i-6*s,a+6*c],["L",i-2*s,a+2*c],["L",o-2*s,r+2*c],["L",o+2*s,r-2*c],["M",o+2*s,r-2*c]]}function cr(e){this.mesh&&(this.mouseX=e.clientX,this.mouseY=e.clientY)}function sr(){!this.isDragging&&null!=this.hoverIndex&&"function"==typeof this.onAnchorClick&&this.onAnchorClick(this.hoverIndex),this.command="",this.isDragging=!1,this.hoverIndex=null}function lr(e){if(this.hoverIndex=this.updateAnchors(e.layerX,e.layerY),this.mesh&&this.command&&this.anchor){var t=e.clientX-this.mouseX,n=e.clientY-this.mouseY;this.mouseX=e.clientX,this.mouseY=e.clientY;var o=this.helpInfo,r=this.anchor,i=(o.cosb*t-o.sinb*n)/(o.sina*o.cosb-o.sinb*o.cosa),a=(o.cosa*t-o.sina*n)/(o.cosa*o.sinb-o.cosb*o.sina);i=this.command===this.axis[1]?0:i,a=this.command===this.axis[0]?0:a,t=i*o.sina+a*o.sinb,n=i*o.cosa+a*o.cosb;var c=o.screen2axis(o.o[0],o.o[1]),s=o.screen2axis(o.o[0]+t,o.o[1]+n),l={x:0,y:0,z:0};l[this.axis[0]]=s[0]-c[0],l[this.axis[1]]=s[1]-c[1];var u=O(r.x+l.x,r.y+l.y,r.z+l.z,this.mesh),p=this.mesh.geometry.vertices,h=this.anchor.i;(this.mesh.tc.vectorLinkHash&&this.mesh.tc.vectorLinkHash[h]?[h].concat(this.mesh.tc.vectorLinkHash[h]):[h]).map(function(e){p[e].x=u[0],p[e].y=u[1],p[e].z=u[2]}),this.mesh.geometry.verticesNeedUpdate=!0,this.isDragging=!0,"function"==typeof this.onObjectChange&&this.onObjectChange()}}function ur(e,t){return function(){e.command=t}}var pr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t,{mesh:null,anchor:null,index:null,hoverIndex:null,helpers:[],points:[],mouseX:-999,mouseY:-999,isDragging:!1,containerMouseDownHandler:cr.bind(this),containerMouseUpHandler:sr.bind(this),containerMouseMoveHandler:lr.bind(this)})}var t,n,o;return t=e,(n=[{key:"attach",value:function(e){e?(this.mesh=e,this.updateAnchors(),this.container.addEventListener("mousemove",this.containerMouseMoveHandler),this.container.addEventListener("mousedown",this.containerMouseDownHandler),this.container.addEventListener("mouseup",this.containerMouseUpHandler)):this.detach()}},{key:"detach",value:function(){if(this.mesh){for(;this.helpers.length;)this.helpers.pop().remove();this.mesh=null,this.anchor=null,this.hoverIndex=null,this.index=null;var e=this.container.offsetWidth,t=this.container.offsetHeight,n=this.canvas.getContext("2d");this.canvas.width=e,this.canvas.height=t,n.clearRect(0,0,e,t),this.container.removeEventListener("mousemove",this.containerMouseMoveHandler),this.container.removeEventListener("mousedown",this.containerMouseDownHandler),this.container.removeEventListener("mouseup",this.containerMouseUpHandler)}}},{key:"attachAnchor",value:function(e){var t=this;this.index=e,this.anchor=null,this.points.map(function(n){t.anchor=n.i===e?n:t.anchor}),this.updateSelectedAnchor()}},{key:"updateAnchors",value:function(e,t){for(var n=Go(this),o=_o("axis2screen",this),r=this.axis,i=4e3/this.size,a=function(e){var t=e.axis.join("o"),n=e.cameraAngleA,o=(e.cameraAngleB%360+360)%360,r="x",i=1;switch(t){case"xoz":r="y",i=n>=0?1:-1;break;case"xoy":r="z",i=o<=180?1:-1;break;case"zoy":r="x",i=o<=90||o>=315?1:-1}return function(e){return i*e[r]}}(this),c=[],s=this.color.toString(16);s.length<6;)s="0"+s;s="#"+s;var l=null;this.mesh.geometry.vertices.map(function(e,t){c[t]=n(e.x,e.y,e.z),c[t].d=a(c[t]),c[t].i=t,c[t].o=o(c[t][r[0]],c[t][r[1]])}),c.sort(function(e,t){return e.d-t.d});var u=this.container.offsetWidth,p=this.container.offsetHeight,h=this.canvas.getContext("2d");return this.canvas.width=u,this.canvas.height=p,h.clearRect(0,0,u,p),c.map(function(n){h.beginPath(),h.arc(n.o[0],n.o[1],i,0,2*Math.PI,!1);var o=void 0!==e&&void 0!==t&&h.isPointInPath(e,t);h.fillStyle=o?"yellow":s,h.strokeStyle="#000",l=o?n.i:l,h.fill(),h.stroke()}),this.points=c,l}},{key:"updateSelectedAnchor",value:function(){if(this.mesh){for(;this.helpers.length;)this.helpers.pop().remove();if(this.anchor){var e=this.anchor,t=this.axis,n=1e3/this.size,o=_o("axis2screen",this),r={x:e.x,y:e.y,z:e.z},i={x:r.x,y:r.y,z:r.z};i[t[0]]+=100,i=o(i[t[0]],i[t[1]]);var a={x:r.x,y:r.y,z:r.z};a[t[1]]+=100,a=o(a[t[0]],a[t[1]]),r=o(r[t[0]],r[t[1]]);var c=Math.sqrt((r[0]-i[0])*(r[0]-i[0])+(r[1]-i[1])*(r[1]-i[1])),s=Math.sqrt((r[0]-a[0])*(r[0]-a[0])+(r[1]-a[1])*(r[1]-a[1])),l={o:r,a:i,b:a,sina:(i[0]-r[0])/c,cosa:(i[1]-r[1])/c,sinb:(a[0]-r[0])/s,cosb:(a[1]-r[1])/s,screen2axis:_o("screen2axis",this)};this.helpers[0]=this.svg.path(function(e,t,n,o){n=n||"a",o=o||"b";var r=e.o[0],i=e.o[1],a=(e[n][0],e[n][1],e[o][0],e[o][1],e["sin"+n]),c=e["cos"+n],s=e["sin"+o],l=e["cos"+o],u=50*t,p=50*t;return[["M",r,i],["L",u*a+r,u*c+i],["L",u*a+p*s+r,u*c+p*l+i],["L",p*s+r,p*l+i],["M",r,i]]}(l,n)).attr("fill",ir[t.join("")]).mousedown(ur(this,"o")),this.helpers[1]=this.svg.path(ar("a",l,n)).attr("fill",ir[t[0]]).mousedown(ur(this,t[0])),this.helpers[2]=this.svg.path(ar("b",l,n)).attr("fill",ir[t[1]]).mousedown(ur(this,t[1])),this.helpInfo=l,this.helpers.map(function(e){e.attr("cursor","pointer").mouseover(function(){this.fill=this.attr("fill"),this.attr("fill","#FFFF00")}).mouseout(function(){this.attr("fill",this.fill)})})}}}}])&&rr(t.prototype,n),o&&rr(t,o),e}();function hr(e){return(hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mr(e){return(mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yr(e,t){return(yr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function br(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=mr(t).call(this,e))||"object"!==hr(r)&&"function"!=typeof r?dr(o):r).onMouseWheel=n.onMouseWheel.bind(dr(n)),n.onResize=n.onResize.bind(dr(n)),n.onMouseMove=n.onMouseMove.bind(dr(n)),n.onMouseDown=n.onMouseDown.bind(dr(n)),n.onMouseUp=n.onMouseUp.bind(dr(n)),n.onContextMenu=n.onContextMenu.bind(dr(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yr(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){var e=this,t=this.refs,n=t.container,o=t.grid,r=t.svg,i=t.renderer,a=t.morpher,c=this.props,s=c.tool,l=c.axis,u=c.gridColor,p=c.mesh3d,h=c.selectedMesh,f=c.selectedVector,m=c.selectedVectorIndex,d=c.cameraLookAt,y=c.cameraAngleA,g=c.cameraAngleB,v=c.morpher3Dinfo,k=c.transformer3Dinfo,w=this.props.cameraRadius/b;this.mousedown=!1,this.mouseCurrent2D={x:0,y:0},this.mouseCurrent3D={x:0,y:0,z:0},this.svgRenderer=Ao()(r,n.offsetWidth,n.offsetHeight),this.grid2D=new To({axis:l,cameraRadius:w,cameraLookAt:d,cameraAngleA:y,cameraAngleB:g,container:n,canvas:o,lineColor:u}),this.renderer2D=new Ho({axis:l,cameraRadius:w,cameraLookAt:d,cameraAngleA:y,cameraAngleB:g,mesh3d:p,container:n,canvas:i}),this.morpher2D=new pr({axis:l,cameraRadius:w,cameraLookAt:d,cameraAngleA:y,cameraAngleB:g,container:n,svg:this.svgRenderer,canvas:a,size:v.anchorSize,color:v.anchorColor,selectedVector:f,onAnchorClick:function(t){e.context.dispatch("pickJointAnchor",t)},onObjectChange:function(){e.props.selectedMesh&&e.props.selectedMesh.tc&&(e.isDragging=!0,e.props.selectedMesh.tc.needUpdate="all"===e.props.view?4:1,e.context.dispatch("updateTimer"))}}),this.transformer2D=new or({axis:l,cameraRadius:w,cameraLookAt:d,cameraAngleA:y,cameraAngleB:g,container:n,svg:this.svgRenderer,mode:k.mode,size:k.size,space:k.space,onChange:function(){e.props.selectedMesh&&e.props.selectedMesh.tc&&(e.props.selectedMesh.tc.needUpdate="all"===e.props.view?4:1,e.isDragging=!0,e.context.dispatch("updateTimer"))}}),this.grid2D.render(),this.renderer2D.render(),"pickMesh"===s&&h&&this.transformer2D.attach(h),"pickJoint"===s&&h&&(this.morpher2D.attach(h),this.morpher2D.attachAnchor(m)),n.addEventListener("mousewheel",this.onMouseWheel),window.addEventListener("resize",this.onResize),setTimeout(this.onResize,300)}},{key:"componentDidUpdate",value:function(e){!function(e,t){var n=t.props;function o(e){e.axis=n.axis,e.cameraRadius=n.cameraRadius/b,e.cameraLookAt=t.grid2D.cameraLookAt=n.cameraLookAt,e.cameraAngleA=n.cameraAngleA,e.cameraAngleB=n.cameraAngleB}n.axis.join("")===e.axis.join("")&&n.cameraRadius===e.cameraRadius&&n.cameraLookAt===e.cameraLookAt&&n.cameraAngleA===e.cameraAngleA&&n.cameraAngleB===e.cameraAngleB||(o(t.renderer2D),o(t.grid2D),o(t.transformer2D),o(t.morpher2D),t.grid2D.render(),t.renderer2D.render(),t.transformer2D.attach(t.transformer2D.mesh),t.morpher2D.attach(t.morpher2D.mesh),t.morpher2D.attachAnchor(t.morpher2D.index))}(e,this),function(e,t){var n=t.props,o=!1;Object.keys(n.mesh3d).join(";")!==Object.keys(e.mesh3d).join(";")&&(t.renderer2D.mesh3d=n.mesh3d,o=!0),n.timer!==e.timer&&(o=!0),n.selectedMesh&&n.selectedMesh.tc&&n.selectedMesh.tc.needUpdate&&t.renderer2D.mesh2d[n.selectedMesh.uuid]&&(t.renderer2D.mesh2d[n.selectedMesh.uuid].update(),o=!0),n.selectedMesh!==e.selectedMesh&&(o=!0),o&&t.renderer2D.render()}(e,this),function(e,t){var n=t.props;"pickMesh"!==n.tool&&"pickMesh"===e.tool&&t.transformer2D.detach(),"pickMesh"===n.tool&&"pickMesh"!==e.tool&&n.selectedMesh&&t.transformer2D.attach(n.selectedMesh),"pickMesh"===n.tool&&n.selectedMesh!==e.selectedMesh&&t.transformer2D.attach(n.selectedMesh),"pickMesh"===n.tool&&n.timer!==e.timer&&t.transformer2D.mesh&&t.transformer2D.attach(t.transformer2D.mesh),n.transformer3Dinfo!==e.transformer3Dinfo&&(t.transformer2D.size=n.transformer3Dinfo.size,t.transformer2D.mode=n.transformer3Dinfo.mode,t.transformer2D.space=n.transformer3Dinfo.space,t.transformer2D.mesh&&t.transformer2D.attach(t.transformer2D.mesh))}(e,this),function(e,t){var n=t.props;t.morpher2D.selectedVector=n.selectedVector,"pickJoint"!==n.tool&&"pickJoint"===e.tool&&t.morpher2D.detach(),"pickJoint"===n.tool&&"pickJoint"!==e.tool&&n.selectedMesh&&t.morpher2D.attach(n.selectedMesh),"pickJoint"===n.tool&&n.selectedMesh!==e.selectedMesh&&(t.morpher2D.attach(n.selectedMesh),t.morpher2D.attachAnchor(null)),"pickJoint"===n.tool&&n.selectedVectorIndex!==e.selectedVectorIndex&&t.morpher2D.attachAnchor(n.selectedVectorIndex),"pickJoint"===n.tool&&n.timer!==e.timer&&t.morpher2D.mesh&&(t.morpher2D.attach(t.morpher2D.mesh),null!=t.morpher2D.index&&t.morpher2D.attachAnchor(t.morpher2D.index)),n.morpher3Dinfo!==e.morpher3Dinfo&&(t.morpher2D.color=n.morpher3Dinfo.anchorColor,t.morpher2D.size=n.morpher3Dinfo.anchorSize,t.morpher2D.mesh&&t.morpher2D.attach(t.morpher2D.mesh))}(e,this),this.props.selectedMesh&&this.props.selectedMesh.tc.needUpdate&&this.props.selectedMesh.tc.needUpdate--;var t=this.refs.container;!t||t.offsetWidth===this.offsetWidth&&t.offsetHeight===this.offsetHeight||this.onResize()}},{key:"componentWillUnmount",value:function(){this.refs.container.removeEventListener("mousewheel",this.onMouseWheel),window.removeEventListener("resize",this.onResize)}},{key:"onMouseWheel",value:function(e){var t=this.props.cameraRadius-.2*this.props.cameraRadius*e.wheelDelta*this.props.cameraMoveSpeed/this.refs.container.offsetWidth;return t=Math.max(t,50),t=Math.min(t,5e3),this.context.dispatch("changeCamera3D",{cameraRadius:t}),e.stopPropagation(),!1}},{key:"onResize",value:function(){this.offsetWidth=this.refs.container.offsetWidth,this.offsetHeight=this.refs.container.offsetHeight,this.grid2D.render(),this.renderer2D.render(),this.svgRenderer.setSize(this.refs.container.offsetWidth,this.refs.container.offsetHeight)}},{key:"onMouseMove",value:function(e){var t={x:e.clientX,y:e.clientY},n={x:0,y:0,z:0},o=this.grid2D.getMouse3D(e.nativeEvent.offsetX,e.nativeEvent.offsetY);n[this.props.axis[0]]=o[0],n[this.props.axis[1]]=o[1];var r={x:t.x-this.mouseCurrent2D.x,y:t.y-this.mouseCurrent2D.y},i={x:n.x-this.mouseCurrent3D.x,y:n.y-this.mouseCurrent3D.y,z:n.z-this.mouseCurrent3D.z};this.mouseCurrent2D=t,this.mouseCurrent3D=n,this.context.dispatch("changeMouse3D",n);var a={event:e,cameraInfo:{radius:this.props.cameraRadius,angleA:this.props.cameraAngleA,angleB:this.props.cameraAngleB,lookAt:this.props.cameraLookAt},stage2D:this,mouseDown2D:this.mouseDown2D,mouseDown3D:this.mouseDown3D,mouseCurrent2D:t,mouseCurrent3D:n,mouseDelta2D:r,mouseDelta3D:i};this.props.tool&&this.mousedown&&!this.isCameraRotating?this.context.dispatch(this.props.tool+"2D",a,!0):this.props.tool&&!this.isCameraRotating&&this.context.dispatch(this.props.tool+"2D",a,!1)}},{key:"onMouseDown",value:function(e){var t=this.grid2D.getMouse3D(e.nativeEvent.offsetX,e.nativeEvent.offsetY);this.mousedown=!0,this.mouseDown2D={x:e.clientX,y:e.clientY},this.mouseDown3D={x:0,y:0,z:0},this.mouseDown3D[this.props.axis[0]]=t[0],this.mouseDown3D[this.props.axis[1]]=t[1],this.mouseCurrent2D={x:e.clientX,y:e.clientY},this.mouseCurrent3D=JSON.parse(JSON.stringify(this.mouseDown3D))}},{key:"onMouseUp",value:function(){this.mousedown=!1,this.mouseDown2D={x:0,y:0},this.mouseDown3D={x:0,y:0,z:0},this.mouseCurrent2D={x:0,y:0},this.mouseCurrent3D={x:0,y:0,z:0},this.isDragging?this.isDragging=!1:"string"==typeof this.props.tool&&this.context.dispatch(this.props.tool+"2D","mouseup",this)}},{key:"onContextMenu",value:function(e){this.context.dispatch("clearSelected"),e.stopPropagation(),e.preventDefault()}},{key:"render",value:function(){var e={className:"tc-stage-".concat(this.props.axis.join("o")),ref:"container",onMouseMove:this.onMouseMove,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onContextMenu},t={ref:"grid",className:"fixed-canvas",style:this.props.gridVisible?void 0:{display:"none"}};return a.a.createElement("div",e,a.a.createElement("canvas",{ref:"renderer",className:"fixed-canvas"}),a.a.createElement("canvas",t),a.a.createElement("canvas",{ref:"morpher",className:"fixed-canvas"}),a.a.createElement("div",{ref:"svg",className:"fixed-canvas"}))}}])&&fr(n.prototype,o),r&&fr(n,r),t}();br(gr,"contextTypes",{dispatch:ge.a.func}),br(gr,"propTypes",{view:ge.a.string.isRequired,tool:ge.a.string.isRequired,mesh3d:ge.a.object.isRequired,morpher3Dinfo:ge.a.object.isRequired,transformer3Dinfo:ge.a.object.isRequired,axis:ge.a.array,gridColor:ge.a.string,gridVisible:ge.a.bool,selectedMesh:ge.a.object,selectedVector:ge.a.object,selectedVectorIndex:ge.a.number,cameraLookAt:ge.a.object,cameraAngleA:ge.a.number,cameraAngleB:ge.a.number,cameraRadius:ge.a.number,cameraMoveSpeed:ge.a.number}),br(gr,"defaultProps",{axis:["x","z"],cameraRadius:1e3,cameraAngleA:40,cameraAngleB:45,cameraLookAt:{x:0,y:0,z:0},cameraMoveSpeed:4,gridColor:"#8F908A",gridVisible:!0,selectedMesh:null,selectedVector:null,selectedVectorIndex:null});n(130);function vr(){return(vr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function kr(e){return(kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Or(e){return(Or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cr(e,t){return(Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Dr={pickMesh:function(e,t){return e.map(function(e){var n=e.value.split(" ").pop();return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Mr(e,t,n[t])})}return e}({},e,{checked:"space"!==n?n===t.mode:"world"===t.space})})}},jr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Or(t).call(this,e))||"object"!==kr(r)&&"function"!=typeof r?xr(o):r).onButtonClick=n.onButtonClick.bind(xr(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(t,i["Component"]),n=t,(o=[{key:"onButtonClick",value:function(e){this.context.dispatch.apply(null,e.target.dataset.uiCmd.split(" "))}},{key:"render",value:function(){var e="function"==typeof Dr[this.props.tool]?Dr[this.props.tool](this.props.datasource,this.props.controls):this.props.datasource;return a.a.createElement("div",{className:"tc-tools-bar"},function(e,t){return e.map(function(e,n){var o={"data-ui-cmd":e.value,title:e.title,className:"tc-icon "+e.icon+(e.checked?" selected":""),onClick:t.onButtonClick,style:e.hasOwnProperty("color")?{color:e.color}:null};return a.a.createElement("div",vr({},o,{key:n}))})}(e,this))}}])&&wr(n.prototype,o),r&&wr(n,r),t}();function Pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e,t){var n=[],o={};return e.map(function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Pr(e,t,n[t])})}return e}({},e,{locked:!0,visible:!1,children:[]});n.push(t),o[e.label]=t}),Object.keys(t).map(function(e){var n=t[e],r=o[n.tc.group]?n.tc.group:"default group",i=o[r];i.children.push(n),i.locked=i.locked&&n.tc.locked,i.visible=i.visible||n.visible}),n.map(function(e){0===e.children.length&&(e.locked=!1,e.visible=!0)}),n}function Er(){return(Er=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Ar(e,t){var n=[];return e.map(function(e){var o="default group"===e.label||e.locked?" tc-icon-disabled":"",r={"data-id":e.label,"data-level":"group",className:"folder-container"+(e.label===t.props.activeGroup?" active":""),onDragStart:t.onDragStart,onDragOver:t.onDragOver},i={className:"folder-icon tc-icon "+(e.expend?"tc-icon-open-folder":"tc-icon-folder"),onClick:t.onFolderIconClick},c={className:"visible-icon tc-icon "+(e.visible?"tc-icon-visible":"tc-icon-invisible"),onClick:t.onVisibleIconClick},s={className:"tc-icon "+(e.locked?"tc-icon-lock":"tc-icon-unlock"),onClick:t.onLockIconClick},l={onMouseEnter:t.onDragIconEnter,onMouseLeave:t.onDragIconLeave,className:"tc-icon tc-icon-drag"},u={className:"tc-icon tc-icon-edit"+o,onClick:o?void 0:t.onEditIconClick},p={className:"tc-icon tc-icon-delete"+o,onClick:o?void 0:t.onDelIconClick},h={className:"main-label",onClick:t.onLabelClick};n.push(a.a.createElement("div",Er({},r,{key:"group-contianer-"+e.label}),a.a.createElement("span",p),a.a.createElement("span",l),a.a.createElement("span",u),a.a.createElement("span",{className:"border-left"}," "),a.a.createElement("span",i),a.a.createElement("span",c),a.a.createElement("span",s),a.a.createElement("div",h,e.label))),e.expend&&e.children.map(function(e){return function(e,t,n){var o=e.tc,r=o.name||e.geometry.type.replace("Geometry"," ")+o.birth.format("DD/MM hh:mm:ss"),i={key:e.uuid,className:"mesh-container"+(n.props.selectedMesh&&n.props.selectedMesh.uuid===e.uuid?" mesh-selected":""),"data-id":e.uuid,"data-level":"mesh",onDragStart:n.onDragStart,onDragOver:n.onDragOver},c={className:"visible-icon tc-icon "+(e.visible?"tc-icon-visible":"tc-icon-invisible"),onClick:n.onVisibleIconClick},s={onMouseEnter:n.onDragIconEnter,onMouseLeave:n.onDragIconLeave,className:"tc-icon tc-icon-drag"},l={className:"tc-icon tc-icon-delete",onClick:n.onDelIconClick},u={className:"tc-icon "+(o.locked?"tc-icon-lock":"tc-icon-unlock"),onClick:n.onLockIconClick},p={className:"main-label",onClick:n.onLabelClick};t.push(a.a.createElement("div",i,a.a.createElement("span",l),a.a.createElement("span",s),a.a.createElement("span",c),a.a.createElement("span",u),a.a.createElement("div",p,r)))}(e,n,t)})}),n}Mr(jr,"contextTypes",{dispatch:ge.a.func}),Mr(jr,"propTypes",{tool:ge.a.string.isRequired,datasource:ge.a.array.isRequired,controls:ge.a.object}),Mr(jr,"defaultProps",{controls:{}});n(131);function _r(e){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ir(e){return(Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rr(e){for(;!e.dataset.level&&e.parentNode;)e=e.parentNode;return e.dataset.level?e:null}var Vr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Ir(t).call(this,e))||"object"!==_r(r)&&"function"!=typeof r?Lr(o):r).onPanelCloseIconClick=n.onPanelCloseIconClick.bind(Lr(n)),n.onPanelToggleIconClick=n.onPanelToggleIconClick.bind(Lr(n)),n.onAddGroupIconClick=n.onAddGroupIconClick.bind(Lr(n)),n.onFolderIconClick=n.onFolderIconClick.bind(Lr(n)),n.onEditIconClick=n.onEditIconClick.bind(Lr(n)),n.onDelIconClick=n.onDelIconClick.bind(Lr(n)),n.onLockIconClick=n.onLockIconClick.bind(Lr(n)),n.onLabelClick=n.onLabelClick.bind(Lr(n)),n.onVisibleIconClick=n.onVisibleIconClick.bind(Lr(n)),n.onDragIconEnter=n.onDragIconEnter.bind(Lr(n)),n.onDragIconLeave=n.onDragIconLeave.bind(Lr(n)),n.onDragStart=n.onDragStart.bind(Lr(n)),n.onDragOver=n.onDragOver.bind(Lr(n)),n.onDragEnd=n.onDragEnd.bind(Lr(n)),n.dragingTarget=null,n.dragingOver=null,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidMount",value:function(){this.dragingTarget=null,this.dragingOver=null}},{key:"onPanelCloseIconClick",value:function(){this.context.dispatch("closePanel",this.props.type)}},{key:"onPanelToggleIconClick",value:function(){this.context.dispatch("togglePanel",this.props.type)}},{key:"onAddGroupIconClick",value:function(){var e=this;R.a.pop({contentProps:{group:this.props.group,initialName:"",onEnter:function(t){e.context.dispatch("addGroup",t)}},content:Ae,title:"Create New Mesh Group"})}},{key:"onFolderIconClick",value:function(e){this.context.dispatch("toggleGroup",Rr(e.target).dataset.id)}},{key:"onEditIconClick",value:function(e){var t=this,n=Rr(e.target);R.a.pop({contentProps:{group:this.props.group,initialName:n.dataset.id,onEnter:function(e){t.context.dispatch("renameGroup",n.dataset.id,e)}},content:Ae,title:"Rename Mesh Group"})}},{key:"onDelIconClick",value:function(e){var t=Rr(e.target),n=this.context.dispatch;"mesh"===t.dataset.level?n("deleteMesh",t.dataset.id):R.a.confirm({title:"Please Confirm",message:"<h4>Are you sure to remove the group's meshes after droping it?</h4>If you press 'Yes', the locked meshes will be moved to default group.<br>If you press 'No', all meshes will be moved to default group.<br>Press close button to cancel.",appSkin:"oneux3",labels:{enter:"Yes",cancel:"No"},onEnter:function(){n("deleteGroup",t.dataset.id,!0)},onCancel:function(){n("deleteGroup",t.dataset.id,!1)}})}},{key:"onLockIconClick",value:function(e){var t=Rr(e.target);"mesh"===t.dataset.level?this.context.dispatch("lockMesh",t.dataset.id):this.context.dispatch("lockGroup",t.dataset.id,e.target.className.indexOf("tc-icon-unlock")>-1)}},{key:"onLabelClick",value:function(e){var t=Rr(e.target);"mesh"===t.dataset.level?this.context.dispatch("selectMesh",t.dataset.id):this.context.dispatch("changeActiveGroup",t.dataset.id)}},{key:"onVisibleIconClick",value:function(e){var t=Rr(e.target),n=t.dataset.id;"mesh"===t.dataset.level?this.context.dispatch("toggleMeshVisibility",n):this.context.dispatch("toggleGroupVisibility",n,e.target.className.indexOf("tc-icon-invisible")>-1)}},{key:"onDragIconEnter",value:function(e){e.target.parentNode.draggable=!0}},{key:"onDragIconLeave",value:function(e){e.target.parentNode.draggable=!1}},{key:"onDragStart",value:function(e){e.dataTransfer&&e.dataTransfer.setData&&e.dataTransfer.setData("text",""),e.stopPropagation();var t=Rr(e.target);t&&(this.dragingTarget={isMesh:"mesh"===t.dataset.level,id:t.dataset.id})}},{key:"onDragOver",value:function(e){e.stopPropagation();var t=Rr(e.target);t&&(this.dragingOver={isMesh:"mesh"===t.dataset.level,id:t.dataset.id})}},{key:"onDragEnd",value:function(){if(this.dragingTarget&&this.dragingOver&&this.dragingTarget.id!==this.dragingOver.id){var e=(this.dragingTarget.isMesh?"1":"0")+(this.dragingOver.isMesh?"1":"0"),t=this.dragingTarget.id,n=this.dragingOver.id;switch(this.dragingTarget=null,this.dragingOver=null,e){case"00":this.context.dispatch("moveGroup",t,n);break;case"01":var o=this.props.mesh[n];if(t===(n=o.tc.group?o.tc.group:"default group"))return;this.context.dispatch("moveGroup",t,n);break;case"10":this.context.dispatch("changeMeshGroup",t,n);break;case"11":var r=this.props.mesh[t],i=this.props.mesh[n];if(n=i.tc.group?i.tc.group:"default group",r.tc.group===n)return;this.context.dispatch("changeMeshGroup",t,n)}}}},{key:"render",value:function(){var e=this.props.expend?"tc-icon-down":"tc-icon-right",t=Sr(this.props.group,this.props.mesh);return a.a.createElement("div",{className:"tc-meshlist",onDragEnd:this.onDragEnd},a.a.createElement("div",{className:"tc-panel-title-bar"},a.a.createElement("span",{className:"tc-icon tc-icon-close",onClick:this.onPanelCloseIconClick}),a.a.createElement("span",{className:"tc-icon tc-icon-create-folder",onClick:this.onAddGroupIconClick}),a.a.createElement("span",{className:"tc-icon "+e,onClick:this.onPanelToggleIconClick}),"Mesh List"),a.a.createElement("div",{className:"tc-panel-content-container"},this.props.expend?Ar(t,this):null))}}])&&zr(n.prototype,o),r&&zr(n,r),t}();function Br(){return(Br=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Fr(e){return(Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Gr(e){return(Gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ur(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wr(e,t){return(Wr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qr(e){for(;!e.dataset.level&&e.parentNode;)e=e.parentNode;return e.dataset.level?e:null}Nr(Vr,"contextTypes",{dispatch:ge.a.func}),Nr(Vr,"propTypes",{type:ge.a.string.isRequired,group:ge.a.array.isRequired,mesh:ge.a.object.isRequired,expend:ge.a.bool.isRequired});var Yr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=Gr(t).call(this,e))||"object"!==Fr(r)&&"function"!=typeof r?Ur(o):r).onPanelCloseIconClick=n.onPanelCloseIconClick.bind(Ur(n)),n.onPanelToggleIconClick=n.onPanelToggleIconClick.bind(Ur(n)),n.onDelIconClick=n.onDelIconClick.bind(Ur(n)),n.onVisibleIconClick=n.onVisibleIconClick.bind(Ur(n)),n.onLockIconClick=n.onLockIconClick.bind(Ur(n)),n.onLabelClick=n.onLabelClick.bind(Ur(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wr(e,t)}(t,i["Component"]),n=t,(o=[{key:"onPanelCloseIconClick",value:function(){this.context.dispatch("closePanel",this.props.type)}},{key:"onPanelToggleIconClick",value:function(){this.context.dispatch("togglePanel",this.props.type)}},{key:"onVisibleIconClick",value:function(e){this.context.dispatch("toggleLightVisibility",qr(e.target).dataset.key)}},{key:"onLockIconClick",value:function(e){this.context.dispatch("lockLight",qr(e.target).dataset.key)}},{key:"onDelIconClick",value:function(e){this.context.dispatch("deleteLight",qr(e.target).dataset.key)}},{key:"onLabelClick",value:function(e){this.context.dispatch("selectLight",qr(e.target).dataset.key)}},{key:"render",value:function(){var e=this.props.expend?"tc-icon-down":"tc-icon-right";return a.a.createElement("div",{className:"tc-meshlist"},a.a.createElement("div",{className:"tc-panel-title-bar"},a.a.createElement("span",{className:"tc-icon tc-icon-close",onClick:this.onPanelCloseIconClick}),a.a.createElement("span",{className:"tc-icon "+e,onClick:this.onPanelToggleIconClick}),"Light List"),a.a.createElement("div",{className:"tc-panel-content-container"},this.props.expend?function(e){var t=e.props.selectedLight;t&&t.tc&&(t=t.tc.lightKey);return Object.keys(e.props.lights).map(function(n){var o=e.props.lights[n],r=o.tc,i=r.name||o.type.replace("Light"," ")+r.birth.format("DD/MM hh:mm:ss"),c={className:"mesh-container"+(n===t?" mesh-selected":""),"data-id":o.uuid,"data-key":n,"data-level":"light"},s={className:"main-label",onClick:e.onLabelClick},l={className:"tc-icon tc-icon-delete",onClick:e.onDelIconClick},u={className:"tc-icon "+(r.locked?"tc-icon-lock":"tc-icon-unlock"),onClick:e.onLockIconClick},p={className:"visible-icon tc-icon "+(o.visible?"tc-icon-visible":"tc-icon-invisible"),onClick:e.onVisibleIconClick};return a.a.createElement("div",Br({},c,{key:n}),a.a.createElement("span",l),a.a.createElement("span",p),a.a.createElement("span",u),a.a.createElement("div",s,i))})}(this):null))}}])&&Hr(n.prototype,o),r&&Hr(n,r),t}();Jr(Yr,"contextTypes",{dispatch:ge.a.func}),Jr(Yr,"propTypes",{type:ge.a.string.isRequired,expend:ge.a.bool.isRequired});var Xr=function(e){var t=e.mesh,n={posx:0,posy:0,posz:0,scalex:1,scaley:1,scalez:1,vectorx:0,vectory:0,vectorz:0};if(e.selectedVectorIndex>-1&&t.geometry.vertices[e.selectedVectorIndex]){var o=M.getRotateMatrix(t),r=t.geometry.vertices[e.selectedVectorIndex],i=M.local2world(r.x,r.y,r.z,o,t);n.vectorx=parseInt(i[0],10),n.vectory=parseInt(i[1],10),n.vectorz=parseInt(i[2],10)}return n.posx=t.position.x,n.posy=t.position.y,n.posz=t.position.z,n.scalex=t.scale.x,n.scaley=t.scale.y,n.scalez=t.scale.z,n},Kr=n(5);function Zr(e){return e+="",!isNaN(e)&&""!==e&&"0"!==e&&"."!==e.charAt(e.length-1)&&!((e*=1)<=0)}function Qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $r(e,t){var n=e.props.mesh;return function(o){if(e.setState(Qr({},"pos"+t,o.target.value)),!isNaN(o.target.value)&&""!==o.target.value){var r={x:n.position.x,y:n.position.y,z:n.position.z};r[t]=+o.target.value,n.position.set(r.x,r.y,r.z),n.tc.needUpdate="all"===e.props.view?4:1,e.context.dispatch("updateTimer")}}}function ei(e,t){var n=e.props.mesh;return function(o){e.setState(Qr({},"scale"+t,o.target.value)),Zr(o.target.value)&&(n.scale[t]=+o.target.value,n.tc.needUpdate="all"===e.props.view?4:1,e.context.dispatch("updateTimer"))}}function ti(e,t){var n=e.props.mesh,o=e.props.selectedVectorIndex;return function(r){if(e.setState(Qr({},"vector"+t,r.target.value)),!isNaN(r.target.value)&&""!==r.target.value){var i={x:e.state.vectorx,y:e.state.vectory,z:e.state.vectorz};i[t]=+r.target.value;var a=M.world2local(i.x,i.y,i.z,n);n.geometry.vertices[o].x=a[0],n.geometry.vertices[o].y=a[1],n.geometry.vertices[o].z=a[2],n.geometry.verticesNeedUpdate=!0,n.tc.needUpdate="all"===e.props.view?4:1,e.context.dispatch("updateTimer")}}}var ni={type:"int",width:60,step:1},oi={type:"float",width:60,step:.01,fixed:2};function ri(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ii(e,t,n[t])})}return e}function ii(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ai(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ci(e,t,n[t])})}return e}function ci(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function si(e){var t=e.props.mesh,n=t.geometry,o={value:"string"==typeof t.tc.name?t.tc.name:t.geometry.type.replace("Geometry"," ")+t.tc.birth.format("DD/MM hh:mm:ss"),onChange:e.onNameChange},r=ai({},ni,{value:e.state.posx,onChange:$r(e,"x")}),i=ai({},ni,{value:e.state.posy,onChange:$r(e,"y")}),c=ai({},ni,{value:e.state.posz,onChange:$r(e,"z")}),s={onMouseDown:e.onRotationMouseDown,onMouseUp:e.onRotationMouseUp,onMouseMove:e.onRotationMouseUp},l={className:isNaN(e.state.step)||""===e.state.step?"tcui-numberbox-reject":"",width:65,type:"float",fixed:2,value:e.state.step,onChange:e.onStepChange},u=ai({},oi,{className:Zr(e.state.scalex)?"":"tcui-numberbox-reject",value:e.state.scalex,onChange:ei(e,"x")}),p=ai({},oi,{className:Zr(e.state.scaley)?"":"tcui-numberbox-reject",value:e.state.scaley,onChange:ei(e,"y")}),h=ai({},oi,{className:Zr(e.state.scalez)?"":"tcui-numberbox-reject",value:e.state.scalez,onChange:ei(e,"z")});return a.a.createElement("table",{className:"tc-geometry-editor"},a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("td",null,"type:"),a.a.createElement("td",null,n.type)),a.a.createElement("tr",null,a.a.createElement("td",null,"name:"),a.a.createElement("td",null,a.a.createElement(ve.a,o))),a.a.createElement("tr",{style:{marginTop:5}},a.a.createElement("td",null,"position:"),a.a.createElement("td",{style:{lineHeight:"30px"}},"x ",a.a.createElement(Kr.a,r),a.a.createElement("br",null),"y ",a.a.createElement(Kr.a,i),a.a.createElement("br",null),"z ",a.a.createElement(Kr.a,c))),a.a.createElement("tr",null,a.a.createElement("td",null,"scale:"),a.a.createElement("td",{style:{lineHeight:"30px"}},"x ",a.a.createElement(Kr.a,u),a.a.createElement("br",null),"y ",a.a.createElement(Kr.a,p),a.a.createElement("br",null),"z ",a.a.createElement(Kr.a,h))),a.a.createElement("tr",null,a.a.createElement("td",null,"rotation:"),a.a.createElement("td",{style:{lineHeight:"30px"}},a.a.createElement("span",{style:{float:"right"}},"step: ",a.a.createElement(Kr.a,l)," "),a.a.createElement("div",s,a.a.createElement("span",{"data-type":"X","data-value":"-1",className:"tc-icon tc-icon-left"}),"x",a.a.createElement("span",{"data-type":"X","data-value":"1",className:"tc-icon tc-icon-right"}),a.a.createElement("br",null),a.a.createElement("span",{"data-type":"Y","data-value":"-1",className:"tc-icon tc-icon-left"}),"y",a.a.createElement("span",{"data-type":"Y","data-value":"1",className:"tc-icon tc-icon-right"}),a.a.createElement("br",null),a.a.createElement("span",{"data-type":"Z","data-value":"-1",className:"tc-icon tc-icon-left"}),"z",a.a.createElement("span",{"data-type":"Z","data-value":"1",className:"tc-icon tc-icon-right"})))),e.props.selectedVectorIndex>-1?function(e){var t=ri({},ni,{value:e.state.vectorx,onChange:ti(e,"x")}),n=ri({},ni,{value:e.state.vectory,onChange:ti(e,"y")}),o=ri({},ni,{value:e.state.vectorz,onChange:ti(e,"z")});return a.a.createElement("tr",{style:{marginTop:5}},a.a.createElement("td",null,"Vector:"),a.a.createElement("td",{style:{lineHeight:"30px"}},a.a.createElement(Kr.a,t)," x",a.a.createElement("br",null),a.a.createElement(Kr.a,n)," y",a.a.createElement("br",null),a.a.createElement(Kr.a,o)," z"))}(e):null))}n(132);function li(e){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ui(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function pi(e){return(pi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fi(e,t){return(fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var di=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=pi(t).call(this,e))||"object"!==li(r)&&"function"!=typeof r?hi(o):r).timer=null,n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){mi(e,t,n[t])})}return e}({step:1},Xr(n.props)),n.onPanelCloseIconClick=n.onPanelCloseIconClick.bind(hi(n)),n.onPanelToggleIconClick=n.onPanelToggleIconClick.bind(hi(n)),n.onNameChange=n.onNameChange.bind(hi(n)),n.onStepChange=n.onStepChange.bind(hi(n)),n.onRotationMouseDown=n.onRotationMouseDown.bind(hi(n)),n.onRotationMouseUp=n.onRotationMouseUp.bind(hi(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fi(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidUpdate",value:function(e){var t,n;t=e,n=this.props,!t.mesh||t.timer===n.timer&&t.mesh===n.mesh&&t.selectedVectorIndex===n.selectedVectorIndex||this.setState(Xr(this.props))}},{key:"onPanelCloseIconClick",value:function(){this.context.dispatch("closePanel",this.props.type)}},{key:"onPanelToggleIconClick",value:function(){this.context.dispatch("togglePanel",this.props.type)}},{key:"onNameChange",value:function(e){this.props.mesh.tc.name=e.target.value,this.context.dispatch("updateTimer")}},{key:"onStepChange",value:function(e){this.setState({step:e.target.value})}},{key:"onRotationMouseDown",value:function(e){var t=e.target.dataset.type,n=+e.target.dataset.value,o=this.props,r=o.mesh,i=o.view,a=this.context.dispatch,c=this.state.step;function s(){r["rotate"+t](c),r.tc.needUpdate="all"===i?4:1,a("updateTimer")}t&&r&&!isNaN(c)&&""!==c&&(c*=n/57.3,s(),clearInterval(this.timer),this.timer=setInterval(s,100))}},{key:"onRotationMouseUp",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e=this.props.expend?"tc-icon-down":"tc-icon-right";return a.a.createElement("div",{className:"tc-meshlist"},a.a.createElement("div",{className:"tc-panel-title-bar"},a.a.createElement("span",{className:"tc-icon tc-icon-close",onClick:this.onPanelCloseIconClick}),a.a.createElement("span",{className:"tc-icon "+e,onClick:this.onPanelToggleIconClick}),"Geometry Properties"),a.a.createElement("div",{className:"tc-panel-content-container"},this.props.expend?si(this):null))}}])&&ui(n.prototype,o),r&&ui(n,r),t}();mi(di,"contextTypes",{dispatch:ge.a.func}),mi(di,"propTypes",{type:ge.a.string.isRequired,view:ge.a.string.isRequired,expend:ge.a.bool.isRequired,mesh:ge.a.object}),mi(di,"defaultProps",{mesh:{}});var yi=n(65),bi=n(66);function gi(e){return parseInt(255*e,10)}function vi(e){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ki(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function wi(e){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xi(e,t){return(xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ci(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mi(e){var t=e.mesh,n={opacity:1};return t?(n.opacity=1*parseFloat(t.tc.materialOpacity).toFixed(2),n):n}var Di=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(r=wi(t).call(this,e))||"object"!==vi(r)&&"function"!=typeof r?Oi(o):r).onPanelCloseIconClick=n.onPanelCloseIconClick.bind(Oi(n)),n.onPanelToggleIconClick=n.onPanelToggleIconClick.bind(Oi(n)),n.onColorClick=n.onColorClick.bind(Oi(n)),n.onEmissiveChange=n.onEmissiveChange.bind(Oi(n)),n.onWireframeChange=n.onWireframeChange.bind(Oi(n)),n.onOpacityChange=n.onOpacityChange.bind(Oi(n)),n.onSideChange=n.onSideChange.bind(Oi(n)),n.onTextureChange=n.onTextureChange.bind(Oi(n)),n.onTextureClear=n.onTextureClear.bind(Oi(n)),n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Ci(e,t,n[t])})}return e}({},Mi(e)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xi(e,t)}(t,i["Component"]),n=t,(o=[{key:"componentDidUpdate",value:function(e){var t,n;t=e,n=this.props,!t.mesh||t.timer===n.timer&&t.mesh===n.mesh||this.setState(Mi(this.props))}},{key:"onPanelCloseIconClick",value:function(){this.context.dispatch("closePanel",this.props.type)}},{key:"onPanelToggleIconClick",value:function(){this.context.dispatch("togglePanel",this.props.type)}},{key:"onColorClick",value:function(){var e=this,t=this.props.mesh;R.a.pop({contentProps:{value:t.tc.materialColor,onChange:function(n){t.tc.materialColor=n,t.material.color.setHex(n),e.context.dispatch("updateTimer")}},content:nn,title:"Please Choose Material Color"})}},{key:"onEmissiveChange",value:function(){var e=this,t=this.props.mesh;R.a.pop({contentProps:{value:t.tc.materialEmissive,onChange:function(n){t.tc.materialEmissive=n,t.material.emissive.setHex(n),e.context.dispatch("updateTimer")}},content:nn,title:"Please Choose Material Emissive"})}},{key:"onWireframeChange",value:function(e){this.props.mesh.material.wireframe=e.target.checked,this.context.dispatch("updateTimer")}},{key:"onOpacityChange",value:function(e){var t=e.target.value,n=this.props.mesh;this.setState({opacity:t}),isNaN(t)||""===t||(t=parseFloat(t),n.tc.materialOpacity=t,n.material.setValues({opacity:parseFloat(t),transparent:t<1}))}},{key:"onSideChange",value:function(e){this.props.mesh.material.setValues({side:~~e.target.value}),this.context.dispatch("updateTimer")}},{key:"onTextureChange",value:function(e){var t=this;e.target.blur();var n=this.props.mesh;ee(e.target).then(function(e){n.material.map?n.material.map.image=e:n.material.map=new f.Texture(e),n.material.map.needsUpdate=!0,n.material.needsUpdate=!0,t.context.dispatch("updateTimer")})}},{key:"onTextureClear",value:function(){var e=this.props.mesh;e.material.map=null,e.material.needsUpdate=!0}},{key:"render",value:function(){var e,t,n,o,r,i,c,s,l,u=this.props.expend?"tc-icon-down":"tc-icon-right";return a.a.createElement("div",{className:"tc-meshlist"},a.a.createElement("div",{className:"tc-panel-title-bar"},a.a.createElement("span",{className:"tc-icon tc-icon-close",onClick:this.onPanelCloseIconClick}),a.a.createElement("span",{className:"tc-icon "+u,onClick:this.onPanelToggleIconClick}),"Material Properties"),a.a.createElement("div",{className:"tc-panel-content-container"},this.props.expend?(t=(e=this).props.mesh,n=t.material,o=new f.Color(t.tc.materialColor),r=new f.Color(t.tc.materialEmissive),i={checked:n.wireframe,onChange:e.onWireframeChange},c={value:e.state.opacity,type:"float",fixed:2,step:.1,min:0,max:1,onChange:e.onOpacityChange},s={value:n.side,onChange:e.onSideChange,datasource:[{label:"Front Side",value:f.FrontSide},{label:"Back Side",value:f.BackSide},{label:"Double Side",value:f.DoubleSide}]},l={label:"Clear",skin:"trans",style:{position:"relative",height:28,top:1},onClick:e.onTextureClear},a.a.createElement("table",{className:"tc-geometry-editor"},a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("td",null,"type:"),a.a.createElement("td",null,n.type)),a.a.createElement("tr",null,a.a.createElement("td",null,"color:"),a.a.createElement("td",null,a.a.createElement("span",{className:"color-picker",onClick:e.onColorClick},"R:"+gi(o.r)+" G:"+gi(o.g)+" B:"+gi(o.b)))),a.a.createElement("tr",null,a.a.createElement("td",null,"emissive:"),a.a.createElement("td",null,a.a.createElement("span",{className:"color-picker",onClick:e.onEmissiveChange},"R:"+gi(r.r)+" G:"+gi(r.g)+" B:"+gi(r.b)))),a.a.createElement("tr",null,a.a.createElement("td",null,"texture:"),a.a.createElement("td",null,a.a.createElement("div",{className:"file-selector-container"},a.a.createElement("span",{className:"file-selector-placeholder"},"Browse"),a.a.createElement("input",{type:"file",value:"",className:"file-selector",onChange:e.onTextureChange})),a.a.createElement(we.a,l))),a.a.createElement("tr",null,a.a.createElement("td",null,"wireframe:"),a.a.createElement("td",null,a.a.createElement(bi.a,i))),a.a.createElement("tr",null,a.a.createElement("td",null,"opacity:"),a.a.createElement("td",null,a.a.createElement(Kr.a,c))),a.a.createElement("tr",null,a.a.createElement("td",null,"side:"),a.a.createElement("td",null,a.a.createElement(yi.a,s)))))):null))}}])&&ki(n.prototype,o),r&&ki(n,r),t}();Ci(Di,"contextTypes",{dispatch:ge.a.func}),Ci(Di,"propTypes",{type:ge.a.string.isRequired,expend:ge.a.bool.isRequired,mesh:ge.a.object}),Ci(Di,"defaultProps",{mesh:{}});n(135);function ji(){return(ji=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Pi(){return(Pi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Si(e){return(Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ei(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ai(e,t){return!t||"object"!==Si(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _i(e){return(_i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zi(e,t){return(zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ii(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Li=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ai(this,_i(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zi(e,t)}(t,i["Component"]),n=t,(o=[{key:"getChildContext",value:function(){return{dispatch:this.props.dispatch}}},{key:"render",value:function(){var e=this.props,t=e.mouse3d,n=e.panel,o=e.view,r=e.tool,i=e.stage.gridVisible,c=e.menu,s=e.command,l=function(e){var t=e.props,n=t.view,o=t.mesh3d,r=t.group,i=t.lights,c=t.activeGroup,s=t.timer,l=t.selectedMesh,u=t.selectedLight,p=t.selectedVectorIndex,h={meshPanel:Vr,lightPanel:Yr,geoEditor:l?di:null,mtlEditor:l?Di:null},f={meshPanel:{mesh:o,group:r,activeGroup:c,selectedMesh:l},lightPanel:{lights:i,selectedLight:u},geoEditor:{mesh:l,view:n,selectedVectorIndex:p,timer:s},mtlEditor:{mesh:l,timer:s}},m=e.props.panel.map(function(e){var t=e.type,n={key:t,type:t,expend:e.expend},o=h[t],r=f[t];return o?a.a.createElement(o,ji({},n,r)):null}).filter(function(e){return!!e});return m.length?a.a.createElement("div",{className:"tc-panel-container"},m):null}(this),u=!!l,p={mouse3d:t,hasPanelBar:u},h={datasource:s,view:o,tool:r,gridVisible:i,hasPanelBar:u},f={panel:n,menu:c,tool:r,hasPanelBar:u},m=function(e){var t=JSON.parse(JSON.stringify(e.transformer3DTools)),n=JSON.parse(JSON.stringify(e.morpher3DTools));"rotate"===e.transformer3Dinfo.mode&&t.pop();for(var o=e.morpher3Dinfo.anchorColor.toString(16);o.length<6;)o="0"+o;return n[0].color="#"+o,{pickMesh:{tool:e.tool,datasource:t,controls:e.transformer3Dinfo},pickJoint:{tool:e.tool,datasource:n}}}(this.props),d="tc-root-container ".concat(u?"has-panel-bar":""),y="tc-stage-container tc-stage-view-".concat(o);return a.a.createElement("div",{className:d},a.a.createElement("div",{className:y},function(e){var t=e.props,n=t.stage,o=t.timer,r=t.view,i=t.tool,c=t.mesh3d,s=t.lights,l=t.selectedMesh,u=t.selectedVector,p=t.selectedVectorIndex,h=t.selectedLight,f=t.transformer3Dinfo,m=t.morpher3Dinfo,d=n.camera3D,y=n.colorGrid,b=n.colorStage,g=n.gridVisible,v=n.gridSize3D,k=n.gridStep3D,w=d.cameraRadius,O=d.cameraAngleA,x=d.cameraAngleB,C=d.lookAt,M={timer:o,cameraRadius:w,cameraAngleA:O,cameraAngleB:x,cameraLookAt:C,gridColor:y[0],gridVisible:g,view:r,tool:i,mesh3d:c,selectedMesh:l,selectedVector:u,selectedVectorIndex:p,transformer3Dinfo:f,morpher3Dinfo:m},D={cameraRadius:w,cameraAngleA:O,cameraAngleB:x,cameraLookAt:C,gridVisible:g,gridSize:v,gridStep:k,colorStage:b[1],colorGrid:y[1],view:r,tool:i,mesh3d:c,lights:s,selectedMesh:l,selectedVector:u,selectedVectorIndex:p,selectedLight:h,transformer3Dinfo:f,morpher3Dinfo:m};return"3d"===r?a.a.createElement(So,D):"all"===r?[a.a.createElement(So,Pi({},D,{key:"3d"})),a.a.createElement(gr,Pi({},M,{axis:["x","y"],key:"xy"})),a.a.createElement(gr,Pi({},M,{axis:["x","z"],key:"xz"})),a.a.createElement(gr,Pi({},M,{axis:["z","y"],key:"zy"}))]:a.a.createElement(gr,Pi({},M,{axis:r.split("o")}))}(this)),a.a.createElement(zn,f),a.a.createElement(Bn,h),a.a.createElement(Jn,p),l,m[r]?a.a.createElement(jr,m[r]):null)}}])&&Ei(n.prototype,o),r&&Ei(n,r),t}();Ii(Li,"childContextTypes",{dispatch:ge.a.func}),Ii(Li,"propTypes",{dispatch:ge.a.func.isRequired,mouse3d:ge.a.object.isRequired,panel:ge.a.array.isRequired,view:ge.a.string.isRequired,tool:ge.a.string.isRequired,stage:ge.a.object.isRequired,menu:ge.a.array.isRequired,command:ge.a.array.isRequired});n(136);function Ti(e){e.path.length&&(document.title=v.editorTitle+" "+e.path.split("/").pop());var t=Object.assign({},e,{dispatch:Ni});r.a.render(a.a.createElement(Li,t),document.getElementById("main"))}function Ni(){if(0!==arguments.length){var e=[].slice.apply(arguments),t=e.shift();return"string"!=typeof t&&(e.unshift(t),t="string"==typeof t.type?t.type:""),"function"==typeof yn[t]?yn[t].apply(h,e):void 0}}h.fill(v),h.fill(g),h.onChange=function(e){return Ti(e)},function(e,t){function n(t,n){var o=JSON.parse(JSON.stringify(e.store.stage));o.camera3D[t]+=n,"cameraAngleA"===t&&(o.camera3D[t]=Math.min(o.camera3D[t],89),o.camera3D[t]=Math.max(o.camera3D[t],-89)),e.set("stage",o)}F.on("escape",function(){var t=e.store.selectedMesh;t&&t.material.setValues({color:t.tc.materialColor}),e.fill({selectedMesh:null,selectedVector:null,selectedVectorIndex:-1})}),F.on("delete",function(){e.store.selectedMesh&&t.deleteMesh.apply(e,[e.store.selectedMesh.uuid])}),F.on("f1,ctrl + h",function(){t.popHotkeyInfo.apply(e)}),F.on("arrowdown",function(){n("cameraAngleA",-1)}),F.on("arrowup",function(){n("cameraAngleA",1)}),F.on("arrowright",function(){n("cameraAngleB",1)}),F.on("arrowleft",function(){n("cameraAngleB",-1)}),F.on("ctrl + o",function(){t.openFile.apply(e)}),F.on("ctrl + s",function(){t.saveFile.apply(e)}),F.on("ctrl + shift + s",function(){t.saveFileAs.apply(e)}),F.on("ctrl + shift + i",function(){t.importFile.apply(e)}),F.on("ctrl + shift + o",function(){t.exportFile.apply(e)}),F.on("alt + digit1",function(){t.changeView.apply(e,["3d"])}),F.on("alt + digit2",function(){t.changeView.apply(e,["xoz"])}),F.on("alt + digit3",function(){t.changeView.apply(e,["xoy"])}),F.on("alt + digit4",function(){t.changeView.apply(e,["zoy"])}),F.on("alt + digit5",function(){t.changeView.apply(e,["all"])}),F.on("ctrl + d",function(){t.pickMesh.apply(e)}),F.on("ctrl + f",function(){t.pickJoint.apply(e)}),F.on("ctrl + g",function(){t.pickLight.apply(e)}),F.on("ctrl + e",function(){t.moveCamera.apply(e)}),F.on("alt + q",function(){var n="translate"===e.store.transformer3Dinfo.mode?"rotate":"translate";t.setTransformerMode.apply(e,[n])})}(h,yn),Ti(h.store)},83:function(e,t){},85:function(e,t){}});