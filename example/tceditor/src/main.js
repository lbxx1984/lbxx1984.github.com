define("extend",["require"],function(require){return Array.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t])},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);if(t>-1)this.splice(t,1)},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"D+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"c+":this.getMilliseconds()};if(/(Y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var r in t)if(new RegExp("("+r+")").test(e))e=e.replace(RegExp.$1,1===RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length));return e},{}}),define("component/mousePositionBar.jsx",["require"],function(require){return React.createClass({getInitialState:function(){return{x:0,y:0,z:0}},render:function(){return React.createElement("div",{className:"mouse-position-bar"},React.createElement("div",{className:"position-label label-x"},"x:"),React.createElement("div",{className:"position-item item-x"},this.state.x),React.createElement("div",{className:"position-label label-y"},"y:"),React.createElement("div",{className:"position-item item-y"},this.state.y),React.createElement("div",{className:"position-label label-z"},"z:"),React.createElement("div",{className:"position-item item-z"},this.state.z))}})}),define("ui/component/mousePositionBar.jsx",["component/mousePositionBar.jsx"],function(e){return e}),define("config/editorDefaultConf",["require"],function(require){return{defaultLight:{type:"PointLight",name:"default light",matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,900,0,1],color:16777215,intensity:1,distance:0,decay:1},grid:{size:2e3,visible:!0},controlBar:{cameraview:"3d",systemtool:"cameramove",transformer:"move",ransformerspace:"world",enablebar:""},transformer:{mode:"move",space:"world",size:1}}}),define("config/menu",["require"],function(require){return[{label:"File",cmd:"show-file",children:[{label:"Open",cmd:"pop-open",hotKey:"ctrl + o"},{label:"Save",cmd:"pop-save",hotKey:"ctrl + s"},{label:"Save As",cmd:"pop-saveas",hotKey:"ctrl + shift + s"},{label:"Import",cmd:"pop-import"},{label:"Export",cmd:"pop-export"}]},{label:"Geometry",cmd:"show-geometry",children:[{label:"Plane",cmd:"create-plane"}]}]}),define("config/controlBar",["require"],function(require){return[{label:"VIEWS",enable:"always",children:[{label:"3D","class":"",cmd:"view-3d",title:"3D view (1)",type:"radio",group:"cameraview",value:"3d"},{label:"XOZ","class":"",cmd:"view-xoz",title:"XOZ view (2)",type:"radio",group:"cameraview",value:"xoz"},{label:"XOY","class":"",cmd:"view-xoy",title:"XOY view (3)",type:"radio",group:"cameraview",value:"xoy"},{label:"ZOY","class":"",cmd:"view-zoy",title:"ZOY view (4)",type:"radio",group:"cameraview",value:"zoy"}]},{label:"TOOLS",enable:"always",children:[{label:"","class":" icon icon-yidong",cmd:"mouse-pickgeo",type:"radio",group:"systemtool",value:"pickgeo",title:"pick up geometry (D)"},{label:"","class":" icon icon-shuxingxuanze",cmd:"mouse-pickjoint",type:"radio",group:"systemtool",value:"pickjoint",title:"pick up joints of geometry (F)"},{label:"","class":" icon icon-bulb",cmd:"mouse-picklight",type:"radio",group:"systemtool",value:"picklight",title:"pick up light source (L)",disable:{cameraview:"xoy;xoz;zoy;"}}]},{label:"CAMERA",enable:"always",children:[{label:"","class":" icon icon-yidong1",cmd:"mouse-cameramove",type:"radio",group:"systemtool",value:"cameramove",title:"move camera (W)"},{label:"","class":" icon icon-fangda",cmd:"tool-camerazoomin",type:"button",title:"zoom in (MOUSE WHEEL UP)"},{label:"","class":" icon icon-suoxiao",cmd:"tool-camerazoomout",type:"button",title:"zoom out (MOUSE WHEEL DOWN)"}]},{label:"GRID",enable:"always",children:[{label:"","class":" icon icon-pingmufangda",cmd:"tool-gridenlarge",type:"button",title:"enlarge grid",disable:{cameraview:"xoy;xoz;zoy;"}},{label:"","class":" icon icon-pingmusuoxiao",cmd:"tool-gridnarrow",type:"button",titel:"narrow grid",disable:{cameraview:"xoy;xoz;zoy;"}},{label:"","class":" icon",cmd:"tool-gridtoggle",type:"checkbox",title:"hide/show grid",value:0,styles:[" icon-kejian"," icon-bukejian"]}]},{label:"TRANSFORMER",enable:"transformer",children:[{label:"","class":" icon icon-move",cmd:"trans-move",type:"radio",group:"transformer",value:"move",title:"move (E)"},{label:"","class":" icon icon-llfilterrotate",cmd:"trans-rotate",type:"radio",group:"transformer",value:"rotate",title:"rotate (R)",disable:{cameraview:"xoy;xoz;zoy;"}},{label:"","class":" icon icon-icicfangdatubiao",cmd:"trans-scale",type:"radio",group:"transformer",value:"scale",title:"scale (T)",disable:{cameraview:"xoy;xoz;zoy;"}},{label:"","class":" icon icon-jiafangda",cmd:"trans-enlarge",type:"button",titel:"enlarge transformer (=)"},{label:"","class":" icon icon-jiansuoxiao",cmd:"trans-narrow",type:"button",titel:"narrow transformer (-)"},{label:"","class":" icon icon-world",cmd:"trans-coordinatetoggle",type:"radio",group:"transformerspace",value:"world",title:"toggle world/local coordinate (G)",disable:{transformer:"scale;",cameraview:"xoy;xoz;zoy;"}}]}]}),define("config",["require","./config/editorDefaultConf","./config/menu","./config/controlBar"],function(require){return window.editorKey="__tceditor__",{editorDefaultConf:require("./config/editorDefaultConf"),defaultCommandState:{cameraview:"3d",systemtool:"cameramove",transformer:"move",transformerspace:"world",enablebar:""},menu:require("./config/menu"),controlBar:require("./config/controlBar"),meshGroup:[{name:"default group",uuid:"default group",close:!1,visible:!0,locked:!1}]}}),define("component/meshTree.jsx",["require","config"],function(require){var e=require("config");return React.createClass({getInitialState:function(){return{meshes:{},selected:"",group:e.meshGroup}},updateGroupProps:function(){for(var e=this.state.group,t=0;t<e.length;t++){var r=e[t],i=this.getMeshesByGroup(r.uuid);if(0!==i.length)r.visible=!1,r.locked=!0,i.each(function(e){r.locked=r.locked&&e.locked,r.visible=r.visible||e.visible});else;}this.setState({group:e})},getMeshesByGroup:function(e){var t=[];for(var r in this.state.meshes){var i=this.state.meshes[r].group;if(i===e||"default group"===e&&"string"!=typeof i)t.push(this.state.meshes[r])}return t},setGroupProp:function(e,t,r){for(var i=0;i<this.state.group.length;i++)if(this.state.group[i].uuid===e){this.state.group[i][t]=r;break}this.setState({group:this.state.group})},getGroupProp:function(e,t){for(var r=null,i=0;i<this.state.group.length;i++)if(this.state.group[i].uuid===e){r=this.state.group[i][t];break}return r},meshOperateHandler:function(e){var t=e.target.dataset.uuid||e.target.parentNode.dataset.uuid,r=e.target.dataset.cmd||"select";if(t&&"todo"!==r&&"group"!==r)this.props.commandRouting("modify-"+r,[t]),this.updateGroupProps()},groupOperateHandler:function(e){var t=e.target.dataset.uuid||e.target.parentNode.dataset.uuid,r=e.target.dataset.cmd||"close";if(t&&r)switch(r){case"delete":if("default group"===t)break;for(var i=[],n=0;n<this.state.group.length;n++){var a=this.state.group[n];if(a.uuid!==t)i.push(a);else;}this.setState({group:i});break;case"close":this.setGroupProp(t,"close",!this.getGroupProp(t,"close"));break;case"visible":var o=!this.getGroupProp(t,"visible"),s=this.getMeshesByGroup(t);if(this.setGroupProp(t,"visible",o),s.length>0)this.props.commandRouting("modify-visible",s,o);break;case"lock":var l=!this.getGroupProp(t,"locked"),s=this.getMeshesByGroup(t);if(this.setGroupProp(t,"locked",l),s.length>0)this.props.commandRouting("modify-lock",s,l);break;case"up":for(var i=this.state.group,n=0;n<i.length;n++){var a=i[n];if(a.uuid===t){if(0===n)break;i[n]=i[n-1],i[n-1]=a;break}else;}this.setState({group:i})}},changeGroupHandler:function(e){var t=e.target.parentNode.dataset.uuid,r=e.target.dataset.uuid;this.props.commandRouting("modify-group",t,r),this.updateGroupProps()},addGroupHandler:function(e){var t=this.refs.addGroup.getDOMNode();t.style.display="inline-block",t.value="",t.focus()},inputKeyHandler:function(e){var t=e.target.value.trim();if(0!==t.length&&13===e.keyCode){for(var r=0;r<this.state.group.length;r++)if(this.state.group[r].name===t)return;var i=this.state.group;i.push({name:t,uuid:THREE.Math.generateUUID(),close:!1,visible:!0,locked:!1}),this.setState({group:i}),this.refs.addGroup.getDOMNode().style.display="none"}},render:function(){function e(e){function t(e){if(e.uuid===i.group||"default group"===e.uuid&&"string"!=typeof i.group)return React.createElement("div",{style:{display:"none"}});else return React.createElement("div",{"data-uuid":e.uuid,"data-cmd":"group"},e.name)}var i=r.state.meshes[e],n=r.state.selected.indexOf(e+";")>-1?"mesh-item mesh-select":"mesh-item",a=i.visible?"iconfont icon-kejian":"iconfont icon-bukejian",o=i.locked?"iconfont icon-suo1":"iconfont icon-suo",s=i.name||i.geometry.type.replace("Geometry","")+" "+new Date(i.birth).format("MM/DD hh:mm:ss"),l="iconfont icon-shanchu",c="iconfont icon-wenjianxiangguanyemiantubiao02";return React.createElement("div",{className:n,"data-uuid":e,onClick:r.meshOperateHandler},React.createElement("div",{className:l,"data-cmd":"delete"}),React.createElement("div",{className:c,"data-cmd":"todo",style:{display:r.state.group.length>1?"inline-block":"none"}},React.createElement("div",{className:"mesh-group-list","data-uuid":e,onClick:r.changeGroupHandler},r.state.group.map(t))),React.createElement("div",{className:a,"data-cmd":"visible"}),React.createElement("div",{className:o,"data-cmd":"lock"}),React.createElement("div",{className:"label"},s))}function t(t,i){var n=t.visible?"iconfont icon-kejian":"iconfont icon-bukejian",a=t.locked?"iconfont icon-suo1":"iconfont icon-suo",o=t.close?"iconfont icon-wenjianjia":"iconfont icon-iconfont90",s="default group"!==t.uuid?"iconfont icon-shanchu":"iconfont icon-shanchu disable",l=0===i?"":"iconfont icon-wodedingdan35",c=t.children.length>0&&!t.close?"block":"none";return React.createElement("div",null,React.createElement("div",{className:"mesh-group","data-uuid":t.uuid,onClick:r.groupOperateHandler},React.createElement("div",{className:s,"data-cmd":"delete"}),React.createElement("div",{className:l,"data-cmd":"up"}),React.createElement("div",{className:n,"data-cmd":"visible"}),React.createElement("div",{className:a,"data-cmd":"lock"}),React.createElement("div",{className:o,"data-cmd":"close"}),React.createElement("div",{className:"label"},t.name)),React.createElement("div",{className:"mesh-list",style:{display:c}},t.children.map(e)))}for(var r=this,i={},n=0;n<r.state.group.length;n++){var a=r.state.group[n];a.children=[],i[a.uuid]=a}for(var o in r.state.meshes){var s=r.state.meshes[o];if(i.hasOwnProperty(s.group))i[s.group].children.push(o);else delete s.group,i["default group"].children.push(o)}return React.createElement("div",{className:"mesh-tree"},React.createElement("div",{className:"iconfont icon-xinjianwenjianjia",onClick:this.addGroupHandler}),React.createElement("input",{type:"text",ref:"addGroup",style:{display:"none"},onKeyUp:this.inputKeyHandler}),this.state.group.map(t))}})}),define("ui/component/meshTree.jsx",["component/meshTree.jsx"],function(e){return e}),define("component/lightList.jsx",["require"],function(require){return React.createClass({getInitialState:function(){return{light:{},selected:""}},clickHandler:function(e){var t=e.target.dataset.cmd||"select",r=e.target.dataset.light||e.target.parentNode.dataset.light,t="tool-light"+t.replace(/(\w)/,function(e){return e.toUpperCase()});this.props.commandRouting(t,r)},render:function(){function e(e){var t="iconfont icon-"+(e.visible?"kejian":"bukejian"),i="iconfont icon-"+(e.locked?"suo1":"suo"),n=e.name||e.type.replace("Light","")+" "+new Date(e.birth).format("MM/DD hh:mm:ss"),a={className:"mesh-item"+(r.state.selected.indexOf(e.uuid+";")>-1?" selected":""),"data-light":e.uuid,onClick:r.clickHandler};return React.createElement("div",React.__spread({},a),React.createElement("div",{"data-cmd":"delete",className:"iconfont icon-shanchu"}),React.createElement("div",{"data-cmd":"visible",className:t}),React.createElement("div",{"data-cmd":"lock",className:i}),React.createElement("div",{className:"label"},n))}var t=[],r=this;for(var i in this.state.light)if(this.state.light.hasOwnProperty(i))t.push(this.state.light[i]);else;var n={className:"mesh-tree light-list",style:{display:t.length?"block":"none"}};return React.createElement("div",React.__spread({},n),t.map(e))}})}),define("ui/component/lightList.jsx",["component/lightList.jsx"],function(e){return e}),define("layout/VerticalList.jsx",["require","component/meshTree.jsx","component/lightList.jsx"],function(require){var e=require("component/meshTree.jsx"),t=require("component/lightList.jsx");return React.createClass({getInitialState:function(){return{meshVisible:!0,lightVisible:!0}},foldingHandler:function(e){var t=e.target.dataset.cmd,r={};r[t]=!this.state[t],this.setState(r)},render:function(){var r="iconfont icon-"+(this.state.meshVisible?"xiashixinjiantou":"youshixinjiantou"),i="iconfont icon-"+(this.state.lightVisible?"xiashixinjiantou":"youshixinjiantou");return React.createElement("div",{className:"vertical-list"},React.createElement("div",{className:"label-l1"},React.createElement("div",{className:r,"data-cmd":"meshVisible",onClick:this.foldingHandler}),"Mesh"),React.createElement("div",{style:{display:this.state.meshVisible?"block":"none"}},React.createElement(e,{ref:"meshBox",commandRouting:this.props.commandRouting})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:i,"data-cmd":"lightVisible",onClick:this.foldingHandler}),"Light"),React.createElement("div",{style:{display:this.state.lightVisible?"block":"none"}},React.createElement(t,{ref:"lightBox",commandRouting:this.props.commandRouting})))}})}),define("ui/layout/VerticalList.jsx",["layout/VerticalList.jsx"],function(e){return e}),define("layout/containerRight.jsx",["require","component/mousePositionBar.jsx","./VerticalList.jsx"],function(require){var e=require("component/mousePositionBar.jsx"),t=require("./VerticalList.jsx");return React.createClass({getInitialState:function(){return{}},render:function(){var r=this.props,i={commandRouting:r.commandRouting};return React.createElement("div",{className:"container-right"},React.createElement(t,React.__spread({},i,{ref:"verticallist"})),React.createElement(e,{ref:"mousepositionbar"}))}})}),define("ui/layout/containerRight.jsx",["layout/containerRight.jsx"],function(e){return e}),define("widget/menu.jsx",["require"],function(require){return React.createClass({render:function(){function e(e){return React.createElement("div",{className:"menu-item","data-ui-cmd":e.cmd,onClick:r},React.createElement("span",{"data-ui-cmd":e.cmd},e.label),React.createElement("div",{className:"menu-item-hotkey","data-ui-cmd":e.cmd},e.hotKey))}function t(t){if(t.children instanceof Array&&t.children.length>0)return React.createElement("div",{className:"menu-button"},React.createElement("div",{"data-ui-cmd":t.cmd,onClick:r},t.label),React.createElement("div",{className:"menu-list"},t.children.map(e)));else return React.createElement("div",{className:"menu-button"},React.createElement("div",{"data-ui-cmd":t.cmd,onClick:r},t.label))}var r=this.props.clickHandler;return React.createElement("div",{className:"menu"},this.props.datasource.map(t))}})}),define("ui/widget/menu.jsx",["widget/menu.jsx"],function(e){return e}),define("component/controlBar.jsx",["require","config"],function(require){var e=require("config");return React.createClass({getInitialState:function(){return e.defaultCommandState},buttonClickHandler:function(e){var t=e.target,r=t.dataset;if(!(t.className.indexOf("disable")>-1))switch(r.uiType){case"checkbox":var i=~~r.uiValue,n=r.uiStyle.split("|"),a=t.className;a=a.replace(n[i],""),i=0===i?1:0,a+=n[i],t.className=a,t.dataset.uiValue=i,this.props.clickHandler(r.uiCmd,i);break;case"button":this.props.clickHandler(r.uiCmd);break;case"radio":var o={};o[r.uiGroup]=r.uiValue,this.setState(o),this.props.clickHandler(r.uiCmd)}},render:function(){function e(e){var t={className:"control-bar-button iconfont"+e["class"],"data-ui-cmd":e.cmd,"data-ui-type":e.type,title:e.title,onClick:r.buttonClickHandler};if("checkbox"===e.type)t["data-ui-value"]=e.value,t.className+=e.styles[~~e.value],t["data-ui-style"]=e.styles.join("|");else if("radio"===e.type)t["data-ui-group"]=e.group,t["data-ui-value"]=e.value,t.className+=e.value===r.state[e.group]?" active":"";if(e.disable){var i=!1;for(var n in e.disable)if(e.disable[n].indexOf(r.state[n])>-1){i=!0;break}t.className+=i?" disable":""}return React.createElement("div",React.__spread({},t),e.label)}function t(t){var i="always"===t.enable?"control-bar-item-inline":"control-bar-item-nextline";if("always"!==t.enable&&r.state.enablebar.indexOf(t.enable+"|")<0)i+=" disable";if("always"===t.enable)return React.createElement("div",{className:i},React.createElement("div",{className:"control-bar-label"},t.label),t.children.map(e));else return React.createElement("div",{className:i},t.children.map(e))}var r=this;return React.createElement("div",{className:"control-bar"},this.props.datasource.map(t))}})}),define("ui/component/controlBar.jsx",["component/controlBar.jsx"],function(e){return e}),define("widget/colorPicker.jsx",["require"],function(require){function e(e,t,r){return e=e.toString(16),t=t.toString(16),r=r.toString(16),e=1===e.length?"0"+e:e,t=1===t.length?"0"+t:t,r=1===r.length?"0"+r:r,"#"+e+t+r}function t(e){e=e.replace("#","");var t=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16);return[t,r,i]}function r(e,t,r){function i(e,t,r){if(0>r)r+=1;if(r>1)r-=1;if(1/6>r)return e+6*(t-e)*r;if(.5>r)return t;if(2/3>r)return e+(t-e)*(2/3-r)*6;else return e}var n,a,o;if(0===t)n=a=o=r;else{var s=.5>r?r*(1+t):r+t-r*t,l=2*r-s;n=i(l,s,e+1/3),a=i(l,s,e),o=i(l,s,e-1/3)}return[Math.round(255*n),Math.round(255*a),Math.round(255*o)]}function i(e,t,r){e/=255,t/=255,r/=255;var i,n,a=Math.max(e,t,r),o=Math.min(e,t,r),s=(a+o)/2;if(a===o)i=n=0;else{var l=a-o;switch(n=s>.5?l/(2-a-o):l/(a+o),a){case e:i=(t-r)/l+(r>t?6:0);break;case t:i=(r-e)/l+2;break;case r:i=(e-t)/l+4}i/=6}return[i,n,s]}return React.createClass({getDefaultProps:function(){return{width:140,height:15}},getInitialState:function(){return{value:"#FF0000",rgb:[0,0,0],hsl:[0,0,0]}},componentDidMount:function(){for(var t=this.refs.canvas1.getDOMNode(),i=t.getContext("2d"),n=i.createLinearGradient(0,1,t.width,1),a=0;256>a;a++){var o=r(a/255,1,.5);n.addColorStop(a/255,e(o[0],o[1],o[2]))}i.fillStyle=n,i.fillRect(0,0,t.width,t.height),i.stroke(),this.renderColor(this.state.value)},renderColor:function(e){var t=this.refs.canvas2.getDOMNode(),r=t.getContext("2d"),i=r.createLinearGradient(0,1,t.width,1);i.addColorStop(.1,"#FFF"),i.addColorStop(.5,e),i.addColorStop(.9,"#000"),r.fillStyle=i,r.fillRect(0,0,t.width,t.height),r.stroke()},updateColor:function(n,a,o,s,l){var c={};if("css"===n)c.value=a,c.rgb=t(a),c.hsl=i(c.rgb[0],c.rgb[1],c.rgb[2]);else if("rgb"===n)c.rgb=a,c.value=e(c.rgb[0],c.rgb[1],c.rgb[2]),c.hsl=i(c.rgb[0],c.rgb[1],c.rgb[2]);else if("hsl"===n)c.hsl=a,c.rgb=r(c.hsl[0],c.hsl[1],c.hsl[2]),c.value=e(c.rgb[0],c.rgb[1],c.rgb[2]);if(!l)this.setState(c);if(o&&"function"==typeof this.props.onChange)this.props.onChange({target:this,value:c});if(s)this.renderColor(c.value);return c},clickHandler:function(e){var t=e.nativeEvent.offsetX,r=e.nativeEvent.offsetY,i=e.target.getContext("2d").getImageData(t,r,1,1).data;this.updateColor("rgb",i,!0,"canvas1"===e.target.dataset.cmd)},inputChangeHandler:function(e){var t=e.target.dataset.cmd,r=~~e.target.dataset.index,i=Number(e.target.value);i=Math.min(e.target.max,i),i=Math.max(e.target.min,i);var n="rgb"===t?this.state.rgb:this.state.hsl;n[r]=i,this.updateColor(t,n,!0,!0)},render:function(){function e(e,t,i,n,a){function o(o){var s=r.state[e][o].toFixed(t),l={type:"number",step:a,min:i,max:n,value:s,"data-cmd":e,"data-index":o,onChange:r.inputChangeHandler};return React.createElement("input",React.__spread({},l))}var s=[0,1,2];return e=e.toLowerCase(),React.createElement("div",{className:"color-input-content"},e,s.map(o))}var r=this,n={width:this.props.width-6,height:this.props.height,onClick:this.clickHandler},a=t(this.state.value);return this.state.rgb=a,this.state.hsl=i(a[0],a[1],a[2]),React.createElement("div",{className:"color-picker"},React.createElement("div",{className:"color-label",style:{backgroundColor:this.state.value}}),React.createElement("div",{className:"color-select"},React.createElement("div",{className:"color-input-box"},e("RGB",0,0,255,1),e("HSL",2,0,1,.01)),React.createElement("canvas",React.__spread({ref:"canvas2","data-cmd":"canvas2"},n)),React.createElement("canvas",React.__spread({ref:"canvas1","data-cmd":"canvas1"},n))))}})}),define("ui/widget/colorPicker.jsx",["widget/colorPicker.jsx"],function(e){return e}),define("math",["require"],function(require){function e(e,t,r){r=-r;var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),n=-t.x/i,a=-t.y/i,o=-t.z/i,s=Math.cos(r),l=Math.sin(r),c=1-s,h=e.x*(n*n*c+s)+e.y*(n*a*c-o*l)+e.z*(n*o*c+a*l),u=e.x*(n*a*c+o*l)+e.y*(a*a*c+s)+e.z*(a*o*c-n*l),d=e.x*(n*o*c-a*l)+e.y*(a*o*c+n*l)+e.z*(o*o*c+s);return{x:h,y:u,z:d}}function t(e,t,r,i){var n=i[0][0]*e+i[0][1]*t+i[0][2]*r,a=i[1][0]*e+i[1][1]*t+i[1][2]*r,o=i[2][0]*e+i[2][1]*t+i[2][2]*r;return[n,a,o]}function r(e,t,r,i){return[e+i.x,t+i.y,r+i.z]}function i(e,t,r,i){return[e*i.x,t*i.y,r*i.z]}var n={};return n.world2local=function(e,t,r,i){var n=e-i.position.x,a=t-i.position.y,o=r-i.position.z,s=this.getRotateMatrix(i),l=s[0][0],c=s[0][1],h=s[0][2],u=s[1][0],d=s[1][1],f=s[1][2],m=s[2][0],p=s[2][1],g=s[2][2],v=l*d*g+c*f*m+h*u*p-h*d*m-c*u*g-l*f*p,y=n*d*g+c*f*o+h*a*p-h*d*o-c*a*g-n*f*p,b=l*a*g+n*f*m+h*u*o-h*a*m-n*u*g-l*f*o,w=l*d*o+c*a*m+n*u*p-n*d*m-c*u*o-l*a*p,_=y/v,x=b/v,k=w/v;return _/=i.scale.x,x/=i.scale.y,k/=i.scale.z,[_,x,k]},n.local2world=function(e,n,a,o,s){var l=i(e,n,a,s.scale);return l=t(l[0],l[1],l[2],o),l=r(l[0],l[1],l[2],s.position)},n.getRotateMatrix=function(t){var r={x:1,y:0,z:0},i={x:0,y:1,z:0},n={x:0,y:0,z:1};return i=e(i,r,t.rotation.x),n=e(n,r,t.rotation.x),r=e(r,i,t.rotation.y),n=e(n,i,t.rotation.y),r=e(r,n,t.rotation.z),i=e(i,n,t.rotation.z),[[r.x,i.x,n.x],[r.y,i.y,n.y],[r.z,i.z,n.z]]},n}),define("component/geometryPropertyBar.jsx",["require","widget/colorPicker.jsx","math"],function(require){var e=require("widget/colorPicker.jsx"),t=require("math");return React.createClass({componentDidUpdate:function(){var e=this.props.mesh,t=e.hasOwnProperty(window.editorKey)?e[window.editorKey].color:"000000";if(!isNaN(t))t=t.toString(16);for(;t.length<6;)t="0"+t;if(t="#"+t,t!==this.refs.materialcolor.state.value)this.refs.materialcolor.setState({value:t})},nameChangeHandler:function(e){this.props.commandRouting("modify-name",this.props.mesh,e.target.value)},colorChangeHandler:function(e){this.props.commandRouting("modify-color",this.props.mesh,parseInt(e.value.value.slice(1,7),16))},frameChangeHandler:function(e){this.props.commandRouting("modify-wireframe",this.props.mesh,e.target.checked)},vectorChangeHandler:function(e){var t=e.target.dataset;this.props.commandRouting("modify-vector",this.props.mesh,t.joint,t.direction,e.target.value)},matrixChangeHandler:function(e){var t=e.target.dataset.cmdType,r=e.target.dataset.cmdDirection;this.props.commandRouting("modify-"+t,r,e.target.value)},render:function(){function r(e,t,r){return("rotation"===t?180*e/Math.PI:e).toFixed(r)}function i(e,t,i){var n={type:"number","data-cmd-type":e,"data-cmd-direction":t,value:r(o[e][t],e,i),step:"position"===e?5:1,onChange:c.matrixChangeHandler};if("scale"===e)n.min=.05,n.step=.01;return React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l3"},t,":"),React.createElement("input",React.__spread({},n)))}function n(e){var i=["x","y","z"],n=c.props.mesh,a=n.geometry.vertices;if(null==c.props.joint||c.props.joint>a.length-1)return React.createElement("div",null);var o=a[c.props.joint],s=t.getRotateMatrix(n),l=t.local2world(o.x,o.y,o.z,s,n),h={type:"number",step:1,"data-joint":c.props.joint,"data-direction":e,value:r(l[e]),onChange:c.vectorChangeHandler};return React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l3"},i[e],":"),React.createElement("input",React.__spread({},h)))}var a={className:"geometry-property-bar",style:{display:this.props.display}},o=this.props.mesh,s=o.geometry.type.replace("Geometry",""),l=o.name||s+" "+new Date(o.birth).format("MM/DD hh:mm:ss"),c=this;return React.createElement("div",React.__spread({},a),React.createElement("table",null,React.createElement("tr",null,React.createElement("td",{style:{width:"230px"}},React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"type:"),s),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"name:"),React.createElement("input",{type:"text",value:l,onChange:this.nameChangeHandler})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"color:"),React.createElement(e,{ref:"materialcolor",onChange:this.colorChangeHandler,width:"140"})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"wireframe:"),React.createElement("input",{type:"checkbox",checked:o.material.wireframe,onChange:this.frameChangeHandler}))),React.createElement("td",null,React.createElement("div",{className:"label-l1"},"position"),i("position","x",0),i("position","y",0),i("position","z",0)),React.createElement("td",null,React.createElement("div",{className:"label-l1"},"rotation"),i("rotation","x",0),i("rotation","y",0),i("rotation","z",0)),React.createElement("td",null,React.createElement("div",{className:"label-l1"},"scale"),i("scale","x",2),i("scale","y",2),i("scale","z",2)),React.createElement("td",{style:{display:null==this.props.joint?"none":"block"}},React.createElement("div",{className:"label-l1"},"Vector"),[0,1,2].map(n)))))}})}),define("ui/component/geometryPropertyBar.jsx",["component/geometryPropertyBar.jsx"],function(e){return e}),define("component/materialPropertyBar.jsx",["require","widget/colorPicker.jsx","math"],function(require){var e=require("widget/colorPicker.jsx");require("math");return React.createClass({componentDidUpdate:function(){var e=this.props.mesh,t=e.hasOwnProperty(window.editorKey)?e[window.editorKey].color:"000000",r=e.hasOwnProperty(window.editorKey)?e[window.editorKey].emissive:"000000";if(!isNaN(t))t=t.toString(16);if(!isNaN(r))r=r.toString(16);for(;t.length<6;)t="0"+t;for(;r.length<6;)r="0"+r;if(t="#"+t,r="#"+r,t!==this.refs.materialcolor.state.value)this.refs.materialcolor.setState({value:t});if(r!==this.refs.materialemissive.state.value)this.refs.materialemissive.setState({value:r})},colorChangeHandler:function(e){this.props.commandRouting("modify-color",this.props.mesh,parseInt(e.value.value.slice(1,7),16))},emissiveChangeHandler:function(e){this.props.commandRouting("modify-emissive",this.props.mesh,parseInt(e.value.value.slice(1,7),16))},frameChangeHandler:function(e){this.props.commandRouting("modify-wireframe",this.props.mesh,e.target.checked)},opacityChangeHandler:function(e){this.props.commandRouting("modify-opacity",this.props.mesh,parseFloat(e.target.value))},sideChangeHandler:function(e){this.props.commandRouting("modify-side",this.props.mesh,e.target.value)},textureChangeHandler:function(e){this.props.commandRouting("modify-texture",this.props.mesh,e.target),e.target.blur()},render:function(){var t={className:"geometry-property-bar",style:{display:this.props.display}},r=this.props.mesh,i=r.material.type.replace("Material","");return React.createElement("div",React.__spread({},t),React.createElement("table",null,React.createElement("tr",null,React.createElement("td",{style:{width:"230px"}},React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"type:"),i),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"color:"),React.createElement(e,{ref:"materialcolor",onChange:this.colorChangeHandler,width:"140"})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"emissive:"),React.createElement(e,{ref:"materialemissive",onChange:this.emissiveChangeHandler,width:"140"})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"wireframe:"),React.createElement("input",{type:"checkbox",checked:r.material.wireframe,onChange:this.frameChangeHandler}))),React.createElement("td",{style:{width:"260px"}},React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"texture:"),React.createElement("input",{type:"file",value:"",onChange:this.textureChangeHandler})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"opacity:"),React.createElement("input",{type:"range",step:"0.01",max:"1",min:"0",value:r.material.opacity,onChange:this.opacityChangeHandler})),React.createElement("div",{className:"label-l1"},React.createElement("div",{className:"label-l2"},"side:"),React.createElement("select",{value:r.material.side,onChange:this.sideChangeHandler},React.createElement("option",{value:THREE.FrontSide},"FrontSide"),React.createElement("option",{value:THREE.BackSide},"BackSide"),React.createElement("option",{value:THREE.DoubleSide},"DoubleSide")))))))}})}),define("ui/component/materialPropertyBar.jsx",["component/materialPropertyBar.jsx"],function(e){return e}),define("layout/containerProperty.jsx",["require","component/geometryPropertyBar.jsx","component/materialPropertyBar.jsx"],function(require){var e=require("component/geometryPropertyBar.jsx"),t=require("component/materialPropertyBar.jsx");return React.createClass({getInitialState:function(){return{currentTab:"geometry",tabItems:["geometry","material",""],defaultMesh:new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),new THREE.MeshLambertMaterial({color:15132390}))}},componentDidMount:function(){for(var e=this.getDOMNode(),t=e.getElementsByTagName("*"),r=0;r<t.length;r++)t[r].dataset.isPropertyBar=!0;e.dataset.isPropertyBar=!0},tabChangeHandler:function(e){this.setState({currentTab:e.target.dataset.tabItem})},render:function(){function r(e){var t={className:"tab-item"+(i.state.currentTab===e?" active":""),"data-tab-item":e,onClick:i.tabChangeHandler};return React.createElement("div",React.__spread({},t),e)}var i=this,n={className:"container-property",style:{display:this.props.mesh?"block":"none"}},a={mesh:this.props.mesh||this.state.defaultMesh,joint:this.props.joint,display:"geometry"===this.state.currentTab?"block":"none",commandRouting:this.props.commandRouting},o={mesh:this.props.mesh||this.state.defaultMesh,display:"material"===this.state.currentTab?"block":"none",commandRouting:this.props.commandRouting};return React.createElement("div",React.__spread({},n),React.createElement("div",{className:"tab-bar","data-is-property-bar":"true"},this.state.tabItems.map(r)),React.createElement(e,React.__spread({},a)),React.createElement(t,React.__spread({},o)))}})}),define("ui/layout/containerProperty.jsx",["layout/containerProperty.jsx"],function(e){return e}),define("layout/containerStage.jsx",["require","./containerProperty.jsx"],function(require){var e=require("./containerProperty.jsx");return React.createClass({getInitialState:function(){return{activeMesh:null,activeJoint:null}},render:function(){var t={mesh:this.state.activeMesh,joint:this.state.activeJoint,commandRouting:this.props.commandRouting};return React.createElement("div",{className:"container-stage"},React.createElement("div",{className:"stage3d",ref:"stage3d"}),React.createElement("div",{className:"stage2d",ref:"stage2d"}),React.createElement(e,React.__spread({},t)),React.createElement("div",{
className:"camera-controller",ref:"cameracontroller"}))}})}),define("ui/layout/containerStage.jsx",["layout/containerStage.jsx"],function(e){return e}),define("layout/containerLeft.jsx",["require","config","widget/menu.jsx","component/controlBar.jsx","layout/containerStage.jsx"],function(require){var e=require("config"),t=require("widget/menu.jsx"),r=require("component/controlBar.jsx"),i=require("layout/containerStage.jsx");return React.createClass({menuClickHandler:function(e){this.props.commandRouting(e.target.dataset.uiCmd)},controlBarClickHandler:function(e,t){this.props.commandRouting(e,t)},render:function(){var n=this,a={datasource:e.menu,clickHandler:n.menuClickHandler},o={ref:"controlbar",datasource:e.controlBar,clickHandler:n.controlBarClickHandler},s={ref:"stage",commandRouting:n.props.commandRouting};return React.createElement("div",{className:"container-left"},React.createElement(i,React.__spread({},s)),React.createElement(t,React.__spread({},a)),React.createElement(r,React.__spread({},o)))}})}),define("ui/layout/containerLeft.jsx",["layout/containerLeft.jsx"],function(e){return e}),define("application.jsx",["require","layout/containerRight.jsx","layout/containerLeft.jsx"],function(require){var e=require("layout/containerRight.jsx"),t=require("layout/containerLeft.jsx");return React.createClass({render:function(){return React.createElement("div",null,React.createElement(e,React.__spread({},this.props,{ref:"containerright"})),React.createElement(t,React.__spread({},this.props,{ref:"containerleft"})),React.createElement("input",{type:"file",ref:"importdoor",style:{display:"none"}}))}})}),define("stage/Mesh2D",["require","math"],function(require){function e(e){this.mesh=e.mesh,this.param=e.stage.param,this.color=null,this.renderColor=null,this.center=[0,0],this.vertices=[],this.faces=[],this.reset()}var t=require("math");return e.prototype.reset=function(){for(this.vertices=[],this.faces=[],this.createVertices(),this.createFaces(),this.color=this.mesh[window.editorKey].color.toString(16);this.color.length<6;)this.color="0"+this.color;this.color="#"+this.color},e.prototype.render=function(e,t,r){var i=this.faces,n=this.vertices,a=!1;e.beginPath(),e.lineStyle=2,e.fillStyle=this.renderColor||this.color;for(var o=0;o<i.length;o++){var s=i[o][0],l=i[o][1],c=i[o][2];this.line(n[s][0],n[s][1],n[l][0],n[l][1],e),this.line(n[l][0],n[l][1],n[c][0],n[c][1],e),this.line(n[c][0],n[c][1],n[s][0],n[s][1],e)}return a=!isNaN(t)&&!isNaN(r)&&e.isPointInPath(t,r),e.fill(),a},e.prototype.line=function(e,t,r,i,n){var a=Math.sqrt((e-r)*(e-r)+(t-i)*(t-i)),o=1,s=(r-e)/a,l=(i-t)/a;n.moveTo(e+o*l,t-o*s),n.lineTo(e+o*l+r-e,t-o*s+i-t),n.lineTo(e-o*l+r-e,t+o*s+i-t),n.lineTo(e-o*l,t+o*s),n.lineTo(e+o*l,t-o*s)},e.prototype.createFaces=function(){for(var e=this.mesh.geometry.faces,t=0;t<e.length;t++)this.faces.push([e[t].a,e[t].b,e[t].c])},e.prototype.createVertices=function(){var e=t.getRotateMatrix(this.mesh);this.vertices=[],this.center=this.RectangularToDisplay(t.local2world(0,0,0,e,this.mesh));for(var r=this.mesh.geometry.vertices,i=0;i<r.length;i++){var n=r[i];n=t.local2world(n.x,n.y,n.z,e,this.mesh),n=this.RectangularToDisplay(n),this.vertices.push(n)}},e.prototype.RectangularToDisplay=function(e){var t=this.param,r=t.eyes,i="zoy"===r?e[2]:e[0],n="xoz"===r?e[2]:e[1];return i=.5*t.width+(i+t.cameraLookAt.x)/t.scale,n=.5*t.height-(n+t.cameraLookAt.y)/t.scale,[i,n]},e.prototype.DisplayToRectangular=function(e,t){var r=this.param,i=r.eyes;t=-t*r.scale-r.cameraLookAt.y,e=e*r.scale-r.cameraLookAt.x;var n="zoy"===i?0:e,a="xoz"===i?0:t,o="xoy"===i?0:"zoy"===i?e:t;return[n,a,o]},e}),define("stage/Stage2D",["require","./Mesh2D"],function(require){function e(e){this.stage=e.stage,this.stage3d=e.stage.$3d,this.children={},this.events={},this.param={container:e.container,width:e.width||1e3,height:e.height||800,clearColor:null==e.clearColor?"#FFF":e.clearColor,showGrid:null==e.showGrid?!1:!0,gridColor:null==e.gridColor?"#FFF":e.gridColor,gridHighLightColor:null==e.gridHighLightColor?"#858585":e.gridHighLightColor,gridStep:null==e.gridStep?50:e.gridStep,colors:{xoz:["#FF0000","#4285F4"],xoy:["#FF0000","#3E9B1C"],zoy:["#4285F4","#3E9B1C"]},meshColor:null==e.meshColor?"#F0F0F0":e.meshColor,meshActiveColor:null==e.meshActiveColor?"#D97915":e.meshActiveColor,meshHoverColor:null==e.mesnHoverColor?"yellow":e.meshHoverColor,eyes:"xoz",scale:parseInt(e.scale,10)||2,cameraLookAt:{x:0,y:0}},this.gridCanvas=document.createElement("canvas"),this.meshCanvas=document.createElement("canvas"),this.helperContainer=document.createElement("div"),this.gridRender=this.gridCanvas.getContext("2d"),this.meshRender=this.meshCanvas.getContext("2d"),this.helperRender=Raphael(this.helperContainer,this.param.width,this.param.height),this.param.container.appendChild(this.gridCanvas),this.param.container.appendChild(this.meshCanvas),this.param.container.appendChild(this.helperContainer),this.resize(this.param.width,this.param.height)}var t=require("./Mesh2D");return e.prototype.getMeshByMouse=function(e){var t=e.offsetX,r=e.offsetY,i=this.renderMesh(t,r);if(0===i.length)return null;if(1===i.length)return i[0];var n=this;return i.sort(function(e,t){var r=e.position,i=t.position,a=!0;switch(n.param.eyes){case"xoy":a=r.z<i.z;break;case"xoz":a=r.y>i.y;break;case"zoy":a=r.x>i.x;break;default:a=r.x>i.x}return a}),i[0]},e.prototype.cameraLookAt=function(e,t){var r=this.param;r.cameraLookAt.x+=e*r.scale,r.cameraLookAt.y+=-t*r.scale,this.render()},e.prototype.mousewheel=function(e){this.zoomCamera(e.wheelDelta>0)},e.prototype.getMouse3D=function(e){var t=this.param,r=(e.offsetX-.5*t.width)*t.scale-t.cameraLookAt.x,i=(.5*t.height-e.offsetY)*t.scale-t.cameraLookAt.y,n=new THREE.Vector3;switch(this.param.eyes){case"xoz":n.x=r,n.z=i;break;case"xoy":n.x=r,n.y=i;break;case"zoy":n.z=r,n.y=i}return n},e.prototype.toggleHelper=function(){var e=this.param;if(e.showGrid=!e.showGrid,e.showGrid)this.renderGrid();else{var t=this.gridRender;t.fillStyle=e.clearColor,t.fillRect(0,0,e.width,e.height)}},e.prototype.resizeGrid=function(e){console.warn("resizeGrid in stage2D is never used.")},e.prototype.zoomCamera=function(e){var t=this.param,r=t.cameraLookAt;r.x/=t.scale,r.y/=t.scale,t.scale=e?Math.max(t.scale-.1,.5):Math.min(t.scale+.1,6),r.x=r.x*t.scale,r.y=r.y*t.scale,this.render()},e.prototype.resize=function(e,t){this.param.width=e,this.param.height=t,this.gridCanvas.width=e,this.gridCanvas.height=t,this.meshCanvas.width=e,this.meshCanvas.height=t,this.helperContainer.style.width=e+"px",this.helperContainer.style.height=t+"px",this.helperRender.setSize(e,t),this.render()},e.prototype.renderGrid=function(){function e(e,r,i,n,a,o){u.beginPath(),u.lineWidth=o?2:a%5===0?1:.5,u.strokeStyle=o?o:a%5===0?t.gridHighLightColor:t.gridColor,u.moveTo(e,r),u.lineTo(i,n),u.stroke()}var t=this.param,r=t.width,i=t.height,n=t.cameraLookAt.x/t.scale+.5*r,a=.5*i-t.cameraLookAt.y/t.scale,o=t.gridStep/t.scale,s=t.colors[t.eyes][0],l=t.colors[t.eyes][1],c=0,h=0,u=this.gridRender;if(u.fillStyle=t.clearColor,u.fillRect(0,0,r,i),t.showGrid){for(c=n,h=0;r>=c;)e(c+.5,.5,c+.5,i+.5,h),c+=o,h++;for(c=n,h=0;c>=0;)e(c+.5,.5,c+.5,i+.5,h),c-=o,h++;for(c=a,h=0;i>=c;)e(.5,c+.5,r+.5,c+.5,h),c+=o,h++;for(c=a,h=0;c>=0;)e(.5,c+.5,r+.5,c+.5,h),c-=o,h++;if(n>0)e(n+.5,.5,n+.5,i+.5,4,l);if(a>0)e(.5,a+.5,r+.5,a+.5,4,s)}},e.prototype.renderMesh=function(e,t){var r=this.meshRender,i=this.param;r.clearRect(0,0,i.width,i.height);var n=[];for(var a in this.children){var o=this.children[a],s=o.mesh;if(s.visible){if(o.render(r,e,t))n.push(s)}else;}return n},e.prototype.loadMesh=function(){var e={},r=this.stage3d.children;for(var i in r)if(r.hasOwnProperty(i)){var n=new t({mesh:r[i],stage:this});if(this.children[i])n.renderColor=this.children[i].renderColor;e[i]=n}else;this.children=e},e.prototype.render=function(){this.loadMesh(),this.renderGrid(),this.renderMesh();var e=document.createEvent("HTMLEvents");e.initEvent("rendered",!1,!0),this.param.container.dispatchEvent(e)},e}),define("stage/Stage3D",["require"],function(require){function e(e){function t(){if(requestAnimationFrame(t),r.display){r.camera.lookAt(r.param.cameraLookAt),r.renderer.render(r.scene,r.camera);for(var e in r.plugin)if(r.plugin.hasOwnProperty(e)&&"function"==typeof r.plugin[e].animate)r.plugin[e].animate()}}var r=this;if(this.display=!0,this.param={cameraRadius:e.cameraRadius||2e3,cameraAngleA:e.cameraAngleA||40,cameraAngleB:e.cameraAngleB||45,cameraLookAt:e.cameraLookAt||{x:0,y:0,z:0},cameraMoveSpeed:2,width:e.width||1e3,height:e.height||800,clearColor:null==e.clearColor?16777215:e.clearColor,showGrid:null==e.showGrid?!1:!0,gridColor:null==e.gridColor?16777215:e.gridColor,gridSize:2e3,gridStep:100,gridLocked:!0,meshActiveColor:null==e.meshActiveColor?14252309:e.meshActiveColor,meshHoverColor:null==e.mesnHoverColor?16776960:e.meshHoverColor},this.helper={domElement:e.container,raycaster:new THREE.Raycaster,grid:new THREE.GridHelper(this.param.gridSize,this.param.gridStep),axis:new THREE.AxisHelper(200),plane:new THREE.Mesh(new THREE.PlaneGeometry(1e4,1e4,1,1),new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide})),planeContainer:new THREE.Object3D},this.events={},this.children={},this.plugin={},this.updateWithCamera={},this.camera=new THREE.PerspectiveCamera(60,this.param.width/this.param.height,1,2e4),this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.param.showGrid)this.scene.add(this.helper.grid),this.scene.add(this.helper.axis);this.helper.plane.rotation.x=.5*Math.PI,this.helper.planeContainer.add(this.helper.plane),this.scene.add(this.helper.planeContainer),this.helper.grid.setColors(this.param.gridColor,this.param.gridColor),this.renderer.setClearColor(this.param.clearColor),this.renderer.setSize(this.param.width,this.param.height),this.helper.domElement.appendChild(this.renderer.domElement),this.updateCameraPosition(),t()}return e.prototype.getMeshByMouse=function(e,t){var r=[];if(t instanceof Array)r=t;else for(var i in this.children)if(this.children[i].visible)r.push(this.children[i]);if(0===r.length)return null;var n=new THREE.Vector3(e.offsetX/this.param.width*2-1,2*-(e.offsetY/this.param.height)+1,0),a=this.helper.raycaster;a.setFromCamera(n,this.camera);var o=a.intersectObjects(r);if(o.length>0)return o[0].object;else return null},e.prototype.cameraLookAt=function(e,t){var r=this.param,i=r.cameraLookAt,n=this.camera.position,a=this.helper.planeContainer.position;if(e=r.cameraRadius*e*r.cameraMoveSpeed*.2/r.width,t=r.cameraRadius*t*r.cameraMoveSpeed*.2/r.height,Math.abs(r.cameraAngleA)>2)i.x-=Math.sin(Math.PI*r.cameraAngleB/180)*e,i.z+=Math.cos(Math.PI*r.cameraAngleB/180)*e,i.x-=Math.cos(Math.PI*r.cameraAngleB/180)*t*Math.abs(n.y)/n.y,i.z-=Math.sin(Math.PI*r.cameraAngleB/180)*t*Math.abs(n.y)/n.y;else i.x-=Math.sin(Math.PI*r.cameraAngleB/180)*e,i.z+=Math.cos(Math.PI*r.cameraAngleB/180)*e,i.y+=t;a.x=i.x,a.y=i.y,a.z=i.z,this.updateCameraPosition()},e.prototype.mousewheel=function(e){var t=this.param;this.zoomCamera(-.2*t.cameraRadius*e.wheelDelta*t.cameraMoveSpeed/t.width)},e.prototype.getMouse3D=function(e){var t=this,r=new THREE.Vector3(e.offsetX/t.param.width*2-1,2*-(e.offsetY/t.param.height)+1,0),i=t.helper.raycaster;i.setFromCamera(r,t.camera);var n=i.intersectObjects([t.helper.plane]),a=new THREE.Vector3;if(n.length>0){if(a=n[0].point,Math.abs(a.x)<5)a.x=0;if(Math.abs(a.y)<5)a.y=0;if(Math.abs(a.z)<5)a.z=0}return a.clone()},e.prototype.toggleHelper=function(){var e=this.param,t=this.helper;e.showGrid=t.axis.visible=t.grid.visible=!e.showGrid},e.prototype.resizeGrid=function(e){var t=this.param,r=this.helper;if(e)t.gridSize=Math.min(t.gridSize+1e3,2e4);else t.gridSize=Math.max(t.gridSize-1e3,1e3);this.scene.remove(r.grid),r.grid=new THREE.GridHelper(t.gridSize,t.gridStep),r.grid.setColors(t.gridColor,t.gridColor),r.grid.visible=t.showGrid,this.scene.add(r.grid)},e.prototype.zoomCamera=function(e){var t=0;if(e===!0)t=-360;else if(e===!1)t=360;else t=e;t+=this.param.cameraRadius,t=Math.max(t,50),t=Math.min(t,5e3),this.setCamera({r:t})},e.prototype.setCamera=function(e){if(null!=e){if(null!=e.a)this.param.cameraAngleA=e.a;if(null!=e.b)this.param.cameraAngleB=e.b;if(null!=e.r)this.param.cameraRadius=e.r;this.updateCameraPosition()}},e.prototype.resize=function(e,t){this.param.width=e,this.param.height=t,this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)},e.prototype.updateCameraPosition=function(){var e=this.param.cameraAngleA,t=this.param.cameraAngleB,r=this.param.cameraRadius,i=this.param.cameraLookAt,n=this.helper.planeContainer,a=this.helper.grid,o=r*Math.sin(Math.PI*e/180),s=r*Math.cos(Math.PI*e/180)*Math.cos(Math.PI*t/180),l=r*Math.cos(Math.PI*e/180)*Math.sin(Math.PI*t/180);if(Math.abs(e)<2)n.rotation.z=a.rotation.z=.5*Math.PI-Math.PI*t/180,n.rotation.x=a.rotation.x=1.5*Math.PI,this.param.gridLocked=!1;else n.rotation.z=a.rotation.z=0,n.rotation.x=a.rotation.x=0,this.param.gridLocked=!0;this.camera.position.set(s+i.x,o+i.y,l+i.z);var c=this.updateWithCamera;for(var h in c)if(c.hasOwnProperty(h)&&null!=c[h]&&"function"==typeof c[h].update)c[h].update()},e}),define("stage/CameraController",["require"],function(require){function e(e){function i(e,t,r,i){return function(n){var a=new THREE.Mesh(e,new THREE.MeshLambertMaterial({map:n,color:c.param.color}));a.position.set(t[0],t[1],t[2]),a.rotation.set(r[0],r[1],r[2]),a.tid=i,c.scene.add(a)}}function n(e){var t=e.offsetX,r=e.offsetY,i=new THREE.Vector3(t/c.param.width*2-1,2*-(r/c.param.height)+1,1),n=c.camera,a=c.raycaster,o=c.param;i.unproject(n),a.ray.set(n.position,i.sub(n.position).normalize());var s=a.intersectObjects(c.scene.children);if(s.length>0){if(o.intersected!=s[0].object){if(o.intersected)o.intersected.material.setValues({color:o.color});o.intersected=s[0].object,o.intersected.material.setValues({color:o.hoverColor})}}else{if(o.intersected)o.intersected.material.setValues({color:o.color});o.intersected=null}}function a(e){c.mousedown=!0,c.param.mouse[0]=e.clientX,c.param.mouse[1]=e.clientY,window.addEventListener("mousemove",s),window.addEventListener("mouseup",l)}function o(e){if(c.param.cameraRotated||!c.mousedown)return void(c.param.cameraRotated=!1);if(c.mousedown=!1,null!=c.param.intersected){var t=r[c.param.intersected.tid];if(null!=t[0])c.cameraAngleTo(t[0],"A");if(null!=t[1])c.cameraAngleTo(t[1],"B")}}function s(e){function t(e){if(0!==e){var t=c.param,r=t.cameraMoveSpeed*e*90/Math.PI/window.screen.availHeight;if(t.cameraAngleA<90&&t.cameraAngleA+r>90)r=0;if(t.cameraAngleA>-90&&t.cameraAngleA+r<-90)r=0;t.cameraAngleA+=r}}function r(e){if(0!==e){var t=c.param;if(t.cameraAngleB+=t.cameraMoveSpeed*e*90/Math.PI/window.screen.availWidth,t.cameraAngleB>360)t.cameraAngleB-=360;if(t.cameraAngleB<0)t.cameraAngleB+=360}}var i=e.clientY-c.param.mouse[1],n=e.clientX-c.param.mouse[0];if(0!==i||0!==n)t(i),r(n),c.param.mouse[0]=e.clientX,c.param.mouse[1]=e.clientY,c.param.cameraRotated=!0,c.updateCameraPosition(),c.updateStage()}function l(){c.mousedown=!1,c.param.cameraRotated=!1,window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",l)}var c=this;this.param={textureUrl:e.textureUrl||"",language:e.language||"ch",domElement:e.container,intersected:null,stages:[],animate:null==e.animate?!1:e.animate,cameraRadius:90,cameraAngleA:e.cameraAngleA||40,cameraAngleB:e.cameraAngleB||45,cameraMoveSpeed:1.5,cameraRotated:!1,cameraLookAt:{x:0,y:0,z:0},width:e.width||120,height:e.height||120,color:e.color||16777215,hoverColor:e.hoverColor||14252309,mouse:[0,0],mousedown:!1},this.camera=new THREE.PerspectiveCamera(60,this.param.width/this.param.height,1,1e4),this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.raycaster=new THREE.Raycaster;var h=new THREE.TextureLoader;for(var u in t){var d=u.indexOf("_")<0?this.param.textureUrl+u+"_"+this.param.language+".png":this.param.textureUrl+"background.png",f=u.indexOf("_")<0?new THREE.PlaneGeometry(t[u][6],t[u][7]):new THREE.BoxGeometry(t[u][6],t[u][7],t[u][8]),m=[t[u][0],t[u][1],t[u][2]],p=[Math.PI*t[u][3],Math.PI*t[u][4],Math.PI*t[u][5]];h.load(d,i(f,m,p,u))}this.param.domElement.appendChild(this.renderer.domElement),this.scene.add(new THREE.AmbientLight(16777215)),this.renderer.setSize(this.param.width,this.param.height),this.updateCameraPosition();var g=this.param.domElement;g.addEventListener("mousemove",n),g.addEventListener("mouseup",o),g.addEventListener("mousedown",a)}var t={font:[20,0,0,0,.5,0,30,30,0],back:[-20,0,0,0,-.5,0,30,30,0],top:[0,20,0,-.5,0,0,30,30,0],bottom:[0,-20,0,.5,0,0,30,30,0],left:[0,0,20,0,0,0,30,30,0],right:[0,0,-20,0,-1,0,30,30,0],font_left_top:[17.5,17.5,17.5,0,0,0,5,5,5],font_right_top:[17.5,17.5,-17.5,0,0,0,5,5,5],left_top_back:[-17.5,17.5,17.5,0,0,0,5,5,5],back_top_right:[-17.5,17.5,-17.5,0,0,0,5,5,5],left_font_bottom:[17.5,-17.5,17.5,0,0,0,5,5,5],font_right_bottom:[17.5,-17.5,-17.5,0,0,0,5,5,5],left_back_bottom:[-17.5,-17.5,17.5,0,0,0,5,5,5],right_back_bottom:[-17.5,-17.5,-17.5,0,0,0,5,5,5],left_top:[0,17.5,17.5,0,0,0,30,5,5],left_bottom:[0,-17.5,17.5,0,0,0,30,5,5],top_right:[0,17.5,-17.5,0,0,0,30,5,5],bottom_right:[0,-17.5,-17.5,0,0,0,30,5,5],top_font:[17.5,17.5,0,0,0,0,5,5,30],bottom_font:[17.5,-17.5,0,0,0,0,5,5,30],back_bottom:[-17.5,-17.5,0,0,0,0,5,5,30],top_back:[-17.5,17.5,0,0,0,0,5,5,30],font_left:[17.5,0,17.5,0,0,0,5,30,5],font_right:[17.5,0,-17.5,0,0,0,5,30,5],back_right:[-17.5,0,-17.5,0,0,0,5,30,5],back_left:[-17.5,0,17.5,0,0,0,5,30,5]},r={font_left_top:[45,45],left_top_back:[45,135],back_top_right:[45,225],font_right_top:[45,315],left_font_bottom:[-45,45],left_back_bottom:[-45,135],right_back_bottom:[-45,225],font_right_bottom:[-45,315],left_top:[45,90],left_bottom:[-45,90],top_right:[45,270],bottom_right:[-45,270],top_font:[45,0],bottom_font:[-45,0],top_back:[45,180],back_bottom:[-45,180],font_left:[0,45],font_right:[0,315],back_right:[0,225],back_left:[0,135],left:[0,90],right:[0,270],font:[0,0],back:[0,180],top:[89,null],bottom:[-89,null]};return e.prototype.updateStage=function(){var e=this.param.stages;if(0!==e.length)for(var t=0;t<e.length;t++)e[t].setCamera({a:this.param.cameraAngleA,b:this.param.cameraAngleB})},e.prototype.cameraAngleTo=function(e,t){var r=this.param,i=this,n="A"===t?"cameraAngleA":"cameraAngleB";if(!r.animate)return r[n]=e,i.updateCameraPosition(),void i.updateStage();var a=r[n],o=Math.abs(a-e)/10;if(1>o)return r[n]=e,i.updateCameraPosition(),void i.updateStage();if(a>e)o=-o;r[n]+=o,i.updateCameraPosition(),i.updateStage(),setTimeout(function(){i.cameraAngleTo(e,t)},2)},e.prototype.animate=function(){this.camera.lookAt(this.param.cameraLookAt),this.renderer.render(this.scene,this.camera)},e.prototype.updateCameraPosition=function(){var e=this.param.cameraRadius,t=this.param.cameraAngleA,r=this.param.cameraAngleB,i=e*Math.sin(Math.PI*t/180),n=e*Math.cos(Math.PI*t/180)*Math.cos(Math.PI*r/180),a=e*Math.cos(Math.PI*t/180)*Math.sin(Math.PI*r/180);this.camera.position.set(n,i,a)},e}),define("stage/main",["require","./Stage2D","./Stage3D","./CameraController"],function(require){function e(e){this.type="$3d",this.container1=e.container1,this.container2=e.container2,this.container3=e.container3,this.activeMesh={},this.hoverMesh=null,this.$3d=new r({showGrid:!0,clearColor:4013373,gridColor:9408650,container:e.container3,meshHoverColor:14252309,width:e.container3.clientWidth,height:e.container3.clientHeight}),this.$2d=new t({stage:this,showGrid:!0,clearColor:"#3D3D3D",gridColor:"#8F908A",gridStep:20,scale:2,container:e.container2,width:e.container3.clientWidth,height:e.container3.clientHeight}),this.cameraController=new i({textureUrl:"resources/textures/",container:e.container1,hoverColor:14252309,animate:!0}),this.$3d.plugin.cameraController=this.cameraController,this.cameraController.param.stages.push(this.$3d)}var t=require("./Stage2D"),r=require("./Stage3D"),i=require("./CameraController");return e.prototype.toogleMeshProp=function(e,t){var r=!this.$3d.children[e][t];this.$3d.children[e][t]=r,this.$2d.renderMesh()},e.prototype.setMeshProp=function(e,t,r){this.$3d.children[e][t]=r,this.$2d.renderMesh()},e.prototype.changeMeshColor=function(e,t){function r(e,t,r){e.material.setValues({color:t});var i=s.$2d.children[e.uuid];if(i)s.$2d.children[e.uuid].renderColor=r}function i(e,t){var i=e[window.editorKey].color,n=s.$2d.children[e.uuid],l=n?n.color:"#000";if(s.activeMesh[e.uuid]&&t)i=a.active,l=o.active;r(e,i,l)}function n(){if("$2d"===s.type)s.$2d.renderMesh()}var a={hover:this.$3d.param.meshHoverColor,active:this.$3d.param.meshActiveColor},o={active:this.$2d.param.meshActiveColor,hover:this.$2d.param.meshHoverColor},s=this;if(null==e&&"hover"===t&&null!=this.hoverMesh)return i(this.hoverMesh,!0),this.hoverMesh=null,void n();if(null!=e||"active"!==t){if(null!=e){if("hover"===t){if(null!=this.hoverMesh&&this.hoverMesh.uuid===e.uuid)return;if(null!=this.hoverMesh&&this.hoverMesh.uuid!==e.uuid)i(this.hoverMesh,!0);return this.hoverMesh=e,r(e,a.hover,o.hover),void n()}if("active"===t){if(this.activeMesh[e.uuid])return;return this.activeMesh[e.uuid]=e,r(e,a.active,o.active),void n()}}}else{var l=0;for(var c in this.activeMesh)l++,i(this.activeMesh[c]),delete this.activeMesh[c];if(l>0)n()}},e.prototype.getMeshByMouse=function(e,t){var r=null;if(r=this[this.type].getMeshByMouse(e,t),null==r||r.locked)return null;else return r},e.prototype.add=function(e){if(!e.hasOwnProperty(window.editorKey))e[window.editorKey]={};if(!e[window.editorKey].hasOwnProperty("color"))e[window.editorKey].color=e.material.color.getHex(),e[window.editorKey].emissive=e.material.emissive.getHex();this.$3d.children[e.uuid]=e,this.$3d.scene.add(e)},e.prototype.remove=function(e){this.$3d.scene.remove(this.$3d.children[e]),delete this.$3d.children[e],this.$2d.loadMesh(),this.$2d.renderMesh()},e.prototype.removeAll=function(){for(var e in this.$3d.children)this.remove(e)},e.prototype.cameraMove=function(e,t){this[this.type].cameraLookAt(e,t)},e.prototype.zoom=function(e){this[this.type].mousewheel(e)},e.prototype.getMouse3D=function(e){return this[this.type].getMouse3D(e)},e.prototype.callFunction=function(e,t){if("toggleHelper"===e)this.$2d[e](),this.$3d[e]();else return this[this.type][e](t)},e.prototype.changeView=function(e){var t={"3d":"$3d",xoz:"$2d",zoy:"$2d",xoy:"$2d"};if(!(!t.hasOwnProperty(e)||this.type===t[e]&&"$3d"===this.type||this.type===t[e]&&"$2d"===this.type&&e===this.$2d.param.eyes))if(this.type=t[e],"$3d"===this.type)this.container1.style.display="block",this.container3.style.display="block",this.container2.style.display="none",this.$3d.display=!0;else{this.container1.style.display="none",this.container3.style.display="none",this.container2.style.display="block",this.$3d.display=!1,this.$2d.param.eyes=e,this.$2d.render();for(var r in this.activeMesh)this.$2d.children[r].renderColor=this.$2d.param.meshActiveColor;this.$2d.renderMesh()}},e.prototype.resize=function(){var e=this.container3.parentNode;this.$3d.resize(e.clientWidth,e.clientHeight),this.$2d.resize(e.clientWidth,e.clientHeight)},e}),define("command/tool",["require"],function(require){function e(e,t){e.ui.refs.containerright.refs.verticallist.refs.meshBox.setState(t)}function t(e,t){e.ui.refs.containerleft.refs.stage.setState({activeMesh:t})}function r(e,t){e.ui.refs.containerright.refs.verticallist.refs.lightBox.setState(t)}function i(e,t,i){var n=e.light,a=n.children[t],o=n.anchors[t],s={light:n.children};if(a[i]=!a[i],o[i]=!o[i],"visible"===i&&a.visible)for(var l in e.stage.$3d.children)e.stage.$3d.children[l].material.needsUpdate=!0;if(n.attached&&n.attached.uuid===t&&(!a.visible||a.locked))n.detach(),s.selected="";r(e,s)}function n(r,i,n){if(r[i].mesh&&r[i].mesh.uuid===n)r.stage.changeMeshColor(null,"active"),r[i].detach(),e(r,{selected:""}),t(r,null)}return{detach:function(){if(this.transformer.attached)n(this,"transformer",this.transformer.mesh.uuid);if(0!==this.morpher.state)n(this,"morpher",this.morpher.mesh.uuid)},camerazoomin:function(){this.stage.callFunction("zoomCamera",!0)},camerazoomout:function(){this.stage.callFunction("zoomCamera",!1)},gridenlarge:function(){this.stage.callFunction("resizeGrid",!0)},gridnarrow:function(){this.stage.callFunction("resizeGrid",!1)},gridtoggle:function(){this.stage.callFunction("toggleHelper")},lightVisible:function(e,t){i(this,t,"visible")},lightLock:function(e,t){i(this,t,"locked")},lightDelete:function(e,t){this.light.remove(t),r(this,{light:this.light.children,selected:this.light.attached?this.light.attached.uuid+";":""})},lightSelect:function(e,t){var i=this.ui.refs.containerleft.refs.controlbar.state.systemtool,n=this.light.anchors[t];if("picklight"===i&&n.visible&&!n.locked)this.light.attach(n),r(this,{selected:t+";"})}}}),define("command/mouse/common",["require"],function(require){return{_down:!1,_mouse:[-1,-1],_mouse3d:[0,0,0],_lastMesh:null,_lastJoint:null,attach:function(e,t,r){var i=e.ui.refs.containerright,n=e.ui.refs.containerleft;e[t].attach(r),e.stage.changeMeshColor(null,"active"),e.stage.changeMeshColor(r,"active"),i.refs.verticallist.refs.meshBox.setState({selected:r.uuid+";"}),n.refs.stage.setState({activeMesh:r})},detach:function(e,t){var r=e.ui.refs.containerright,i=e.ui.refs.containerleft;e[t].detach(),e.stage.changeMeshColor(null,"active"),r.refs.verticallist.refs.meshBox.setState({selected:""}),i.refs.stage.setState({activeMesh:null})},updateControlBar:function(e,t,r){if(e.ui){var i=e.ui.refs.containerleft.refs.controlbar;if(i.state[t]!==r){var n={};n[t]=r,i.setState(n)}}}}}),define("command/mouse/cameramove",["require","./common"],function(require){function e(e){r._down=!0,r._mouse=[e.clientX,e.clientY]}function t(e){r._down=!1}var r=require("./common");return{mousemove:function(e){if(r._down)this.stage.cameraMove(e.clientX-r._mouse[0],e.clientY-r._mouse[1]),r._mouse=[e.clientX,e.clientY]},loaded:function(){r.updateControlBar(this,"systemtool","cameramove")},mousedown:e,mouseup:t,mouseleave:t}}),define("command/mouse/pickgeo",["require","./common"],function(require){var e=require("./common");return{loaded:function(){if(e._down=!1,e.updateControlBar(this,"enablebar","transformer|"),e._lastMesh&&this.stage.$3d.children[e._lastMesh.uuid])e.attach(this,"transformer",e._lastMesh);else e._lastMesh=null;e.updateControlBar(this,"systemtool","pickgeo")},mouseRightClick:function(t){if(e._down=!1,this.stage.changeMeshColor(null,"active"),this.transformer.attached)e.detach(this,"transformer")},mousemove:function(t){if(e._down){var r=this.stage.getMouse3D(t);this.transformer.$2d.dragging([t.clientX-e._mouse[0],t.clientY-e._mouse[1]],[r.x-e._mouse3d[0],r.y-e._mouse3d[1],r.z-e._mouse3d[2]]),e._mouse=[t.clientX,t.clientY],e._mouse3d=[r.x,r.y,r.z]}else{var i=this.stage.getMeshByMouse(t);if(null==i||null!=i&&!this.stage.activeMesh[i.uuid]&&!this.transformer.attached)this.stage.changeMeshColor(i,"hover")}},mouseup:function(t){e._down=!1,this.transformer.$2d.command=null},mousedown:function(t){if(2!==t.button){e._down=!0;var r=this.stage.getMouse3D(t);e._mouse3d=[r.x,r.y,r.z],e._mouse=[t.clientX,t.clientY];var i=this.stage.getMeshByMouse(t);if(null!=i)e.attach(this,"transformer",i)}},unload:function(){e._down=!1,e._lastMesh=this.transformer.mesh,e.detach(this,"transformer"),e.updateControlBar(this,"enablebar","")}}}),define("command/mouse/pickjoint",["require","./common"],function(require){function e(e,t){var r=e.ui.refs.containerleft;r.refs.stage.setState({activeJoint:t}),e.morpher.attachJoint(t)}function t(e){var t=e.ui.refs.containerleft;t.refs.stage.setState({activeJoint:null}),e.morpher.detachJoint()}var r=require("./common");return{loaded:function(t){if(r._down=!1,r._lastMesh&&this.stage.$3d.children[r._lastMesh.uuid])r.attach(this,"morpher",r._lastMesh);else r._lastMesh=null;if(null!=r._lastJoint)e(this,r._lastJoint);r.updateControlBar(this,"systemtool","pickjoint")},mousemove:function(e){var t=null;if(0!==this.morpher.state||r._down){if(1!==this.morpher.state||r._down){if(r._down){var i=this.stage.getMouse3D(e);this.morpher.$2d.dragging([e.clientX-r._mouse[0],e.clientY-r._mouse[1]],[i.x-r._mouse3d[0],i.y-r._mouse3d[1],i.z-r._mouse3d[2]]),r._mouse=[e.clientX,e.clientY],r._mouse3d=[i.x,i.y,i.z]}}else if(this.morpher.callFunction("hoverJoint"),t=this.morpher.getHoverJoint(e),null!=t)this.morpher.callFunction("hoverJoint",t)}else if(t=this.stage.getMeshByMouse(e),null==t||null!=t&&!this.stage.activeMesh[t.uuid])this.stage.changeMeshColor(t,"hover")},mouseup:function(e){r._down=!1,this.morpher.$2d.command=null},mousedown:function(t){if(2!==t.button){var i=null,n=this.stage.getMouse3D(t);switch(r._down=!0,r._mouse3d=[n.x,n.y,n.z],r._mouse=[t.clientX,t.clientY],this.morpher.state){case 0:if(i=this.stage.getMeshByMouse(t),null!=i)r.attach(this,"morpher",i);break;case 1:if(i=this.morpher.getHoverJoint(t),null!=i)e(this,i);else if(i=this.stage.getMeshByMouse(t))r.attach(this,"morpher",i)}}},mouseRightClick:function(e){if(r._down=!1,2===this.morpher.state)return void t(this);if(1===this.morpher.state)return void r.detach(this,"morpher");else return void 0},unload:function(){r._down=!1,r._lastMesh=this.morpher.mesh,r._lastJoint=this.morpher.joint,r.detach(this,"morpher")}}}),define("command/mouse/picklight",["require","./common"],function(require){var e=require("./common");return{loaded:function(){e._down=!1,this.light.show(),e.updateControlBar(this,"systemtool","picklight")},unload:function(){this.light.hide(),this.light.detach(),this.ui.refs.containerright.refs.verticallist.refs.lightBox.setState({selected:""})},mouseRightClick:function(t){e._down=!1,this.light.detach(),this.ui.refs.containerright.refs.verticallist.refs.lightBox.setState({selected:""})},mousemove:function(t){if(e._down);else{var r=this.stage.getMeshByMouse(t,this.light.anchorsArray);if(r)this.light.hover(r.uuid);else this.light.hover("")}},mouseup:function(t){e._down=!1;var r=this.stage.getMeshByMouse(t,this.light.anchorsArray);if(r)this.light.attach(r),this.ui.refs.containerright.refs.verticallist.refs.lightBox.setState({selected:r.uuid+";"})}}}),define("command/mouse/main",["require","./cameramove","./pickgeo","./pickjoint","./picklight"],function(require){return{cameramove:require("./cameramove"),pickgeo:require("./pickgeo"),pickjoint:require("./pickjoint"),picklight:require("./picklight")}}),define("command/create/geometry/plane",["require"],function(require){return{tempMesh:function(e){var t=5,r=Math.abs(e.mouseUp.x-e.mouseDown.x),i=Math.abs(e.mouseUp.z-e.mouseDown.z),n=new THREE.Mesh(new THREE.PlaneGeometry(r,i,t,t),e.material);return n.rotation.x=Math.PI/2,n}}}),define("command/create/geometry/main",["require","./plane"],function(require){var e=require("./plane");return{plane:e}}),define("command/create/main",["require","./geometry/main"],function(require){function e(e){var t=this.ui.refs.containerleft.refs.controlbar;t.setState({systemtool:"",cameraview:"3d"}),this.stage.changeView("3d")}function t(e){l=!0,s=!1,c=this.stage.getMouse3D(e)}function r(e){l=!1,s=!1,this.stage.$3d.scene.remove(h)}function i(e){return function(t){if(l){s=!0;var r=this.stage.getMouse3D(t);if(this.stage.$3d.scene.remove(h),h=a({type:e,mouseDown:c,mouseUp:r}),null!=h)this.stage.$3d.scene.add(h)}}}function n(e){return function(e){if(l=!1,null!=h&&s){s=!1;var t=h.clone();this.stage.$3d.scene.remove(h),this.stage.add(t),t.birth=(new Date).getTime(),this.ui.refs.containerright.refs.verticallist.refs.meshBox.setState({meshes:this.stage.$3d.children})}}}function a(e){var t=o[e.type].tempMesh({material:new THREE.MeshLambertMaterial({color:15132390,side:THREE.DoubleSide}),mouseDown:e.mouseDown,mouseUp:e.mouseUp});return t.position.set((e.mouseDown.x+e.mouseUp.x)/2,(e.mouseDown.y+e.mouseUp.y)/2,(e.mouseDown.z+e.mouseUp.z)/2),t}var o=require("./geometry/main"),exports={},s=!1,l=!1,c=null,h=null;for(var u in o){if(!o.hasOwnProperty(u))return;exports[u]={loaded:e,mousedown:t,mousemove:i(u),mouseup:n(u),mouseleave:r}}return exports}),define("command/trans",["require"],function(require){function e(e,t){var r=e.ui.refs.containerleft.refs.controlbar;
if(r.state.transformer!==t)r.setState({transformer:t})}return{move:function(){if(this.transformer.attached)this.transformer.callFunction("setMode","translate"),this.transformer.callFunction("setSpace",this.ui.refs.containerleft.refs.controlbar.state.transformerspace),e(this,"move")},rotate:function(){if(this.transformer.attached)this.transformer.callFunction("setMode","rotate"),this.transformer.callFunction("setSpace",this.ui.refs.containerleft.refs.controlbar.state.transformerspace),e(this,"rotate")},scale:function(){if(this.transformer.attached)this.transformer.callFunction("setMode","scale"),this.transformer.callFunction("setSpace","local"),e(this,"scale")},enlarge:function(){if(this.transformer.attached){var e=this.transformer.get("size");this.transformer.callFunction("setSize",1.1*e)}},narrow:function(){if(this.transformer.attached){var e=this.transformer.get("size");this.transformer.callFunction("setSize",.9*e)}},coordinatetoggle:function(){if(this.transformer.attached){var e=this.ui.refs.containerleft.refs.controlbar;if("scale"!==e.state.transformer){var t="world"===e.state.transformerspace?"local":"world";e.setState({transformerspace:t}),this.transformer.callFunction("setSpace",t)}}}}}),define("command/view",["require"],function(require){function e(e,t){var r=e.ui.refs.containerleft.refs.controlbar;if(r.state.cameraview!==t)r.setState({cameraview:t})}return{"3d":function(){this.stage.changeView("3d"),this.transformer.update("$3d"),this.morpher.update("$3d"),e(this,"3d")},xoz:function(){this.stage.changeView("xoz"),this.transformer.update("$2d"),this.morpher.update("$2d"),e(this,"xoz")},zoy:function(){this.stage.changeView("zoy"),this.transformer.update("$2d"),this.morpher.update("$2d"),e(this,"zoy")},xoy:function(){this.stage.changeView("xoy"),this.transformer.update("$2d"),this.morpher.update("$2d"),e(this,"xoy")}}}),define("command/modify",["require","math"],function(require){function e(e,t){e.ui.refs.containerright.refs.verticallist.refs.meshBox.setState(t)}function t(e,t){e.ui.refs.containerleft.refs.stage.setState({activeMesh:t})}function r(e,r){var i=e.ui.refs.containerleft.refs.controlbar.state.cameraview;if("3d"!==i)e.stage.$2d.children[r.uuid].reset(),e.stage.$2d.renderMesh();if(e.transformer.attached)e.transformer.attach(r);if(1===e.morpher.state)e.morpher.detach(),e.morpher.attach(r);else if(2===e.morpher.state){var n=e.morpher.joint;e.morpher.detach(),e.morpher.attach(r),e.morpher.attachJoint(n)}t(e,r)}function i(e,t,r){e.stage.toogleMeshProp(t,r),a(e,"transformer",t),a(e,"morpher",t)}function n(e,t,r,i){for(var n=0;n<t.length;n++){var o=t[n].uuid;e.stage.setMeshProp(o,r,i),a(e,"transformer",o),a(e,"morpher",o)}}function a(r,i,n){if(r[i].mesh&&r[i].mesh.uuid===n)r.stage.changeMeshColor(null,"active"),r[i].detach(),e(r,{selected:""}),t(r,null)}function o(r,i,n){if(r[i].mesh){if(r[i].mesh.uuid===n.uuid)return;r.stage.changeMeshColor(null,"active"),r[i].detach()}r[i].attach(n),r.stage.changeMeshColor(n,"active"),e(r,{selected:n.uuid+";"}),t(r,n)}function s(e,t,r){function i(t){if(!(t instanceof ProgressEvent))return void r(null);var i=document.createElement("img");i.src=t.target.result,i.onload=function(){e.imgCache[a]=i,i.path=l,r(i)}}var n=t.files[0];if(r="function"==typeof r?r:new Function,0!==n.type.indexOf("image/"))return void r(null);var a=n.lastModified+"."+n.size+"."+n.name,o=e.imgCache[a];if(o)return void r(o);var s="/"+window.editorKey+"/.texture",l=s+"/"+a;e.fs.md(s,function(){e.fs.write(l,{},function(t){var a=t.target;a.onwriteend=function(t){e.fs.read(l,i,{type:"readAsDataURL"})},a.onerror=function(e){r(null)},a.write(n)})})}var l=require("math");return{position:function(e,t,i){var n=this.transformer.mesh||this.morpher.mesh;if(n)n.position[t]=~~i,r(this,n)},rotation:function(e,t,i){var n=this.transformer.mesh||this.morpher.mesh;if(n)i=~~i%360,n.rotation[t]=i*Math.PI/180,r(this,n)},scale:function(e,t,i){var n=this.transformer.mesh||this.morpher.mesh;if(i=parseFloat(i),!(!n||0===i||0>i||isNaN(i)))n.scale[t]=i,r(this,n)},name:function(r,i,n){i.name=n,e(this,{meshes:this.stage.$3d.children}),t(this,i)},texture:function(e,t,r){s(this,r,function(e){if(e){if(t.material.map)t.material.map.image=e;else t.material.map=new THREE.Texture(e);t.material.map.needsUpdate=!0,t.material.needsUpdate=!0}})},color:function(e,t,i){t[window.editorKey].color=i,t.material.setValues({color:i}),r(this,t)},emissive:function(e,t,i){t[window.editorKey].emissive=i,t.material.setValues({color:t[window.editorKey].color,emissive:i}),r(this,t)},opacity:function(e,t,i){if(!isNaN(i))t.material.setValues({opacity:parseFloat(i),color:t[window.editorKey].color,transparent:1>i}),r(this,t)},wireframe:function(e,r,i){r.material.wireframe=i,r.material.setValues({emissive:i?r[window.editorKey].color:r[window.editorKey].emissive}),t(this,r)},side:function(e,t,i){t.material.setValues({side:~~i}),r(this,t)},vector:function(e,t,i,n,a){var o=t.geometry.vertices[i],s=l.getRotateMatrix(t),c=l.local2world(o.x,o.y,o.z,s,t);c[n]=a;var h=l.world2local(c[0],c[1],c[2],t);o.x=h[0],o.y=h[1],o.z=h[2],t.geometry.verticesNeedUpdate=!0,r(this,t)},group:function(t,r,i){if(r=this.stage.$3d.children[r])r.group=i,e(this,{meshes:this.stage.$3d.children})},visible:function(t,r,a){if(void 0===a&&1===r.length)i(this,r[0],"visible");else n(this,r,"visible",a);e(this,{meshes:this.stage.$3d.children})},lock:function(t,r,a){if(void 0===a&&1===r.length)i(this,r[0],"locked");else n(this,r,"locked",a);e(this,{meshes:this.stage.$3d.children})},"delete":function(t,r){r=r[0],a(this,"transformer",r),a(this,"morpher",r);this.stage.$3d.children[r];this.stage.remove(r),e(this,{meshes:this.stage.$3d.children})},select:function(e,t){var r={pickgeo:"transformer",pickjoint:"morpher"},i=r[this.ui.refs.containerleft.refs.controlbar.state.systemtool],n=this.stage.$3d.children[t];if(n&&n.visible&&!n.locked&&i)o(this,i,n)}}}),define("widget/alert.jsx",["require"],function(require){function e(e){this.container=document.createElement("div"),this.param=e||{}}var t=React.createClass({displayName:"AlertUI",getInitialState:function(){return{left:0,top:-999}},getDefaultProps:function(){return{message:"contentasdasdidfuhdifugdhfg"}},componentDidMount:function(){var e=this.getDOMNode(),t=document.documentElement;e.className="alert";var r=-e.clientHeight-5,i=5,n=r;this.setState({left:.5*(t.clientWidth-e.clientWidth),top:n});var a=-1,o=e.clientWidth/10,s=60,l=this,c=setInterval(function(){if(n=0>a?n+o:a>0?n-o:n,l.setState({top:n}),a=0>a?n>i?0:a:s>0?0:1,s=0===a&&s>0?s-1:s,r>n)clearInterval(c),l.props.onClose()},1e3/60)},render:function(){var e={style:{left:this.state.left,top:this.state.top}};return React.createElement("div",React.__spread({},e),this.props.message)}});return e.prototype.pop=function(e){e=e||{};var r=this;document.body.appendChild(this.container),e.onClose=function(){r.close()},this.ui=React.render(React.createElement(t,e),this.container)},e.prototype.close=function(){if(React.unmountComponentAtNode(this.container),document.body.removeChild(this.container),this.ui=null,"function"==typeof this.param.onClose)this.param.onClose()},e}),define("ui/widget/alert.jsx",["widget/alert.jsx"],function(e){return e}),define("command/pop",["require","widget/alert.jsx"],function(require){function e(e){var t="/"+window.editorKey+"/"+window.editorKey+"conf",r=function(){return!0};return e.io.callExporter("conf").then(function(r){return e.io.writeFile(t,new Blob([JSON.stringify(r)]))}).then(r,r)}var t=require("widget/alert.jsx");return{open:function(){var r=this,i="",n=new t;e(r).then(function(){return r.io.openExplorer("Open")}).then(function(e){return i=e,r.io.readFile(e,"readAsArrayBuffer")}).then(function(e){return r.io.callLoader(i.split(".").pop().toLowerCase(),e)}).then(function(){document.title="TcEditor "+i.split("/").pop(),r.filePath=i},function(e){if(!e)document.title="TcEditor",r.filePath=null,n.pop({message:"File Open Failed"})})},save:function(){var r=this,i=null,n=new t;e(r).then(function(){return null==r.filePath?r.io.openExplorer("Save"):r.filePath}).then(function(e){return i=e.indexOf(".tcm")===e.length-4?e:e+".tcm",r.io.callExporter("tcm")}).then(function(e){return r.io.writeFile(i,e)}).then(function(){n.pop({message:"File Saved!"}),r.filePath=i,document.title="TcEditor "+i.split("/").pop()},function(e){if(!e)n.pop({message:"File Save Failed!"})})},saveas:function(){var r=this,i=null,n=new t;e(r).then(function(){return r.io.openExplorer("Save")}).then(function(e){return i=e.indexOf(".tcm")===e.length-4?e:e+".tcm",r.io.callExporter("tcm")}).then(function(e){return r.io.writeFile(i,e)}).then(function(){n.pop({message:"File Saved!"}),r.filePath=i,document.title="TcEditor "+i.split("/").pop()},function(e){if(!e)n.pop({message:"File Save Failed!"})})},"export":function(){var e=this;e.io.callExporter("tcm").then(function(t){var r="string"==typeof e.filePath?e.filePath.split("/").pop():new Date+".tcm";e.io.download(t,r)})},"import":function(){var e=this,t=null;e.io.upload().then(function(r){var i=r.blob;return t=r.name,e.io.callLoader(t.split(".").pop().toLowerCase(),i)}).then(function(){document.title="TcEditor "+t.split("/").pop(),e.filePath=null},function(t){document.title="TcEditor",e.filePath=null,alert.pop({message:"File Import Failed"})})}}}),define("command/main",["require","./tool","./mouse/main","./create/main","./trans","./view","./modify","./pop"],function(require){function e(e){this.ui=null,this.stage=null,this.engines={tool:require("./tool"),mouse:require("./mouse/main"),create:require("./create/main"),trans:require("./trans"),view:require("./view"),modify:require("./modify"),pop:require("./pop")},this.currentEngine=null,this.currentProcessor=null,this.main(e)}return e.prototype.main=function(e){if("string"==typeof e){var t=e.split("-"),r=this.engines;if(t.length>=2&&r.hasOwnProperty(t[0])){var i=r[t[0]];if("function"==typeof i[t[1]])return void i[t[1]].apply(this,arguments);this.callEngine("unload",null),this.currentEngine=i,this.currentProcessor=t[1],this.callEngine("loaded",null)}else console.warn('No engine for command "'+e+'"')}},e.prototype.callEngine=function(e,t){var r=this.currentEngine,i=this.currentProcessor;if(null!=r&&null!=i&&r.hasOwnProperty(i)&&"function"==typeof r[i][e])r[i][e].call(this,t)},e.prototype.mouseup=function(e){if(!e.target.dataset||!e.target.dataset.isPropertyBar)this.callEngine("mouseup",e)},e.prototype.mousedown=function(e){if(!e.target.dataset||!e.target.dataset.isPropertyBar)if(!this.stage.cameraController.mousedown)this.callEngine("mousedown",e)},e.prototype.mouseleave=function(e){if(!e.target.dataset||!e.target.dataset.isPropertyBar)this.callEngine("mouseleave",e)},e.prototype.mouseRightClick=function(e){if(!e.target.dataset||!e.target.dataset.isPropertyBar)this.callEngine("mouseRightClick",e)},e.prototype.mousemove=function(e){if(!(null==this.stage||null==this.ui||this.stage.cameraController.param.cameraRotated||e.target.dataset&&e.target.dataset.isPropertyBar)){var t=this.stage.getMouse3D(e);this.ui.refs.containerright.refs.mousepositionbar.setState({x:parseInt(t.x,10),y:parseInt(t.y,10),z:parseInt(t.z,10)}),this.callEngine("mousemove",e)}},e}),define("transformer/Transformer2D",["require"],function(require){function e(e,t){for(var r=0;r<e.length;r++)t(e[r])}function t(e){this.stage=e.stage,this.svg=e.stage.helperRender,this.mode="transform",this.command=null,this.param={scale:.5,renderSize:50,floatSize:50},this.size=1,this.mesh=null,this.helper=[];var t=this;this.stage.param.container.addEventListener("rendered",function(){if(null!=t.mesh)t.attach(t.mesh)})}var r={transform:function(t,r,i){var n=t.command,a=t.stage.param.eyes,o=t.stage.children[t.mesh.uuid],s=o.mesh;r[0]="y"===n?0:r[0],r[1]="x"===n?0:r[1],e(t.helper,function(e){e.translate(r[0],r[1])});var l="xozx;xozc;xoyx;xoyc;".indexOf(a+n+";")>-1?i[0]:0,c="xoyy;xoyc;zoyy;zoyc;".indexOf(a+n+";")>-1?i[1]:0,h="zoyx;zoyc;xozy;xozc;".indexOf(a+n+";")>-1?i[2]:0;s.position.x=s.position.x+l,s.position.y=s.position.y+c,s.position.z=s.position.z+h,s.geometry.verticesNeedUpdate=!0,o.reset(),t.stage.renderMesh()}};return t.prototype.dragging=function(e,t){if(null!=this.mesh&&null!=this.command)if(r[this.mode](this,e,t),"function"==typeof this.onChange)this.onChange()},t.prototype.attach=function(e){if(e)this.mesh=e,this.clearHelper(),this.render()},t.prototype.detach=function(){this.mesh=null,this.command=null,this.clearHelper()},t.prototype.update=function(){this.clearHelper(),this.render()},t.prototype.render=function(){function e(){l.helper[0]=l.svg.path([["M",a,o+2],["L",a+s-10,o+2],["L",a+s-10,o+6],["L",a+s,o],["L",a+s-10,o-6],["L",a+s-10,o-2],["L",a,o-2],["M",a,o+2]]).attr({fill:i[0],cursor:"e-resize"}).mousedown(function(){l.command="x"}),l.helper[1]=l.svg.path([["M",a+2,o],["L",a+2,o+s-10],["L",a+6,o+s-10],["L",a,o+s],["L",a-6,o+s-10],["L",a-2,o+s-10],["L",a-2,o],["M",a+2,o]]).attr({cursor:"s-resize",fill:i[1]}).mousedown(function(){l.command="y"}),l.helper[2]=l.svg.circle(a,o,5).attr({fill:n,cursor:"move"}).mousedown(function(){l.command="c"})}if(this.mesh){var t=this.stage.children[this.mesh.uuid];if(t){var r=t.center,i=this.stage.param.colors[this.stage.param.eyes],n=this.stage.param.meshHoverColor,a=r[0],o=r[1],s=this.param.renderSize+this.param.scale*this.param.floatSize,l=this;switch(this.mode){case"transform":e()}}}},t.prototype.clearHelper=function(){for(;this.helper.length>0;)this.helper.pop().remove()},t.prototype.setMode=function(){},t.prototype.setSpace=function(){},t.prototype.setSize=function(e){this.size=e,this.param.scale=.5*this.size,this.clearHelper(),this.render()},t}),define("transformer/main",["require","./Transformer2D"],function(require){function e(e){function r(){if("function"==typeof i.onChange)i.onChange(i.mesh)}var i=this;this.type="$3d",this.$3d=new THREE.TransformControls(e.$3d.camera,e.$3d.renderer.domElement),this.$2d=new t({stage:e.$2d}),this.stage=e,this.mesh=null,this.attached=!1,this.$3d.addEventListener("objectChange",r),this.$2d.onChange=r}var t=require("./Transformer2D");return e.prototype.callFunction=function(e,t){if(this[this.type]&&"function"==typeof this[this.type][e])return this[this.type][e](t);else return console.warn(e+" is not a function!"),null},e.prototype.get=function(e){return this[this.type][e]},e.prototype.attach=function(e){this.mesh=e,this.$2d.attach(e),this.$3d.attach(e),this.stage.$3d.scene.add(this.$3d),this.stage.$3d.updateWithCamera.transformer=this.$3d,this.$3d.update(),this.attached=!0},e.prototype.detach=function(){if(this.attached)this.$3d.detach(),this.$2d.detach(),this.mesh=null,this.stage.$3d.scene.remove(this.$3d),this.stage.$3d.updateWithCamera.transformer=null,this.attached=!1},e.prototype.update=function(e){this.type=e,this.$3d.update()},e}),define("morpher/Morpher3D",["require","math"],function(require){function e(e){function r(){if(null!=i.joint&&null!=i.geo){var e=i.joint,r=i.geo,n=t.world2local(e.position.x,e.position.y,e.position.z,r);r.geometry.vertices[e.index].x=n[0],r.geometry.vertices[e.index].y=n[1],r.geometry.vertices[e.index].z=n[2],r.geometry.verticesNeedUpdate=!0;var a=i.stage.camera.position.distanceTo(e.position)/i.baseRule;if(e.scale.x=e.scale.y=e.scale.z=a,"function"==typeof i.onChange)i.onChange()}}var i=this;this.stage=e.stage,this.jointCtrler=new THREE.TransformControls(this.stage.camera,this.stage.renderer.domElement),this.helperColor=e.helperColor||14252309,this.helperHoverColor=e.helperHoverColor||16776960,this.baseRule=1e3,this.joints=[],this.geo=null,this.joint=null,this.hover=null,this.jointCtrler.addEventListener("objectChange",r)}var t=require("math");return e.prototype.updateAttachedJoint=function(){if(null!=this.joint&&null!=this.geo){var e=this.joint,r=this.geo,i=this.stage.camera.position,n=t.getRotateMatrix(r),a=r.geometry.vertices[e.index],o=t.local2world(a.x,a.y,a.z,n,r),s=new THREE.Vector3(o[0],o[1],o[2]);e.position.x=o[0],e.position.y=o[1],e.position.z=o[2],e.scale.x=e.scale.y=e.scale.z=s.distanceTo(i)/this.baseRule,this.jointCtrler.update()}},e.prototype.update=function(){for(var e=this.stage.camera.position,t=this.joints,r=0;r<t.length;r++){var i=t[r];if(!i.added)break;var n=e.distanceTo(i.position)/this.baseRule;i.scale.x=i.scale.y=i.scale.z=n}},e.prototype.hoverJoint=function(e){if(null!=this.hover)this.hover.material.setValues({color:this.helperColor});if(!isNaN(e))if(this.hover=this.joints[e],null!=this.hover)this.hover.material.setValues({color:this.helperHoverColor})},e.prototype.attach=function(e){if(e){this.clearStage();for(var r=this.stage.camera.position,i=t.getRotateMatrix(e),n=e.geometry.vertices,a=0;a<n.length;a++){var o=t.local2world(n[a].x,n[a].y,n[a].z,i,e),s=new THREE.Vector3(o[0],o[1],o[2]),l=null;if(a==this.joints.length)l=new THREE.Mesh(new THREE.BoxGeometry(10,10,10,1,1,1),new THREE.MeshBasicMaterial({color:this.helperColor,side:THREE.DoubleSide})),this.joints.push(l);else l=this.joints[a];l.index=a,l.position.x=o[0],l.position.y=o[1],l.position.z=o[2],l.scale.x=l.scale.y=l.scale.z=s.distanceTo(r)/this.baseRule,l.added=!0,this.stage.scene.add(l)}this.stage.updateWithCamera.morpher=this,this.geo=e}},e.prototype.detach=function(){this.clearStage(),this.stage.updateWithCamera.morpher=null},e.prototype.attachJoint=function(e){if(!(isNaN(e)||e>=this.joints.length)){var t=this.joints[e];this.jointCtrler.attach(t),this.stage.scene.add(this.jointCtrler),this.jointCtrler.update(),this.stage.updateWithCamera.jointMover=this.jointCtrler,this.joint=t}},e.prototype.detachJoint=function(){this.jointCtrler.detach(),this.stage.scene.remove(this.jointCtrler),this.stage.updateWithCamera.jointMover=null,this.joint=null},e.prototype.clearStage=function(){for(var e=0;e<this.joints.length;e++){var t=this.joints[e];if(!t.added)break;t.added=!1,this.stage.scene.remove(t)}},e}),define("morpher/Morpher2D",["require","math"],function(require){function e(e){var t=this;this.stage=e.stage,this.svg=e.stage.helperRender,this.helperColor=e.helperColor||"#d97915",this.helperHoverColor=e.helperHoverColor||"#ffff00",this.param={scale:.5,renderSize:50,floatSize:50},this.joints=[],this.helper=[],this.geo=null,this.hover=null,this.joint=null,this.command=null,this.stage.param.container.addEventListener("rendered",function(){if(null!=t.geo)if(t.attach(t.geo),null!=t.joint)t.attachJoint(t.joint)})}var t=require("math");return e.prototype.dragging=function(e,r){if(null!=this.geo&&null!=this.joint&&null!=this.command){e[0]="y"===this.command?0:e[0],e[1]="x"===this.command?0:e[1],this.helper[0].translate(e[0],e[1]),this.helper[1].translate(e[0],e[1]),this.helper[2].translate(e[0],e[1]),this.joints[this.joint].translate(e[0],e[1]);var i=this.geo,n=this.stage.param.eyes,a=this.command,o=i.geometry.vertices[this.joint],s=t.getRotateMatrix(i),l=t.local2world(o.x,o.y,o.z,s,i);l[0]+="xozx;xozc;xoyx;xoyc;".indexOf(n+a+";")>-1?r[0]:0,l[1]+="xoyy;xoyc;zoyy;zoyc;".indexOf(n+a+";")>-1?r[1]:0,l[2]+="zoyx;zoyc;xozy;xozc;".indexOf(n+a+";")>-1?r[2]:0;var c=t.world2local(l[0],l[1],l[2],i);if(o.x=c[0],o.y=c[1],o.z=c[2],i.geometry.verticesNeedUpdate=!0,this.stage.children[this.geo.uuid].reset(),this.stage.renderMesh(),"function"==typeof this.onChange)this.onChange()}},e.prototype.attach=function(e){this.geo=e,this.render()},e.prototype.detach=function(){this.geo=null,this.joint=null,this.clear(),this.clearTransformer()},e.prototype.attachJoint=function(e){if(this.joint=e,!(isNaN(e)||e>this.joints.length))this.renderTransformer()},e.prototype.detachJoint=function(){this.joint=null,this.clearTransformer()},e.prototype.clear=function(){for(;this.joints.length>0;)this.joints.shift().remove()},e.prototype.clearTransformer=function(){for(;this.helper.length>0;)this.helper.shift().remove()},e.prototype.render=function(){if(this.clear(),this.geo&&this.stage.children[this.geo.uuid])for(var e=this,t=this.stage.children[this.geo.uuid],r=0;r<t.vertices.length;r++){var i=t.vertices[r],n=this.svg.circle(i[0],i[1],5).attr({fill:this.helperColor}).mouseover(function(t){return function(){this.attr({fill:e.helperHoverColor}),e.hover=t}}(r)).mouseout(function(t){return function(){this.attr({fill:e.helperColor}),e.hover=null}}(r));this.joints.push(n)}},e.prototype.renderTransformer=function(){if(this.geo&&null!=this.joint&&this.stage.children[this.geo.uuid]){var e=this.stage.children[this.geo.uuid].vertices[this.joint],t=this.stage.param.colors[this.stage.param.eyes],r=this.stage.param.meshHoverColor,i=e[0],n=e[1],a=this.param.renderSize+this.param.scale*this.param.floatSize,o=this;o.clearTransformer(),o.helper[0]=o.svg.path([["M",i,n+2],["L",i+a-10,n+2],["L",i+a-10,n+6],["L",i+a,n],["L",i+a-10,n-6],["L",i+a-10,n-2],["L",i,n-2],["M",i,n+2]]).attr({fill:t[0],cursor:"e-resize"}).mousedown(function(){o.command="x"}),o.helper[1]=o.svg.path([["M",i+2,n],["L",i+2,n+a-10],["L",i+6,n+a-10],["L",i,n+a],["L",i-6,n+a-10],["L",i-2,n+a-10],["L",i-2,n],["M",i+2,n]]).attr({cursor:"s-resize",fill:t[1]}).mousedown(function(){o.command="y"}),o.helper[2]=o.svg.circle(i,n,5).attr({fill:r,cursor:"move"}).mousedown(function(){o.command="c"})}},e.prototype.hoverJoint=function(){},e}),define("morpher/main",["require","./Morpher3D","./Morpher2D"],function(require){function e(e){var i=this;this.type="$3d",this.$2d=new r({stage:e.$2d,helperColor:"#00ff00",helperHoverColor:"#ffff00"}),this.$3d=new t({stage:e.$3d,helperColor:65280,helperHoverColor:16776960}),this.stage=e,this.mesh=null,this.joint=null,this.state=0,this.$2d.onChange=this.$3d.onChange=function(){if("function"==typeof i.onChange)i.onChange(i.joint)}}var t=require("./Morpher3D"),r=require("./Morpher2D");return e.prototype.attach=function(e){this.mesh=e,this.$3d.attach(e),this.$2d.attach(e),this.state=1},e.prototype.detach=function(){if(2===this.state)this.detachJoint();this.mesh=null,this.$3d.detach(),this.$2d.detach(),this.state=0},e.prototype.getHoverJoint=function(e){if("$3d"===this.type){var t=this.stage.getMeshByMouse(e,this.$3d.joints);if(t)t=t.index;return t}return this.$2d.hover},e.prototype.attachJoint=function(e){this.$3d.attachJoint(e),this.$2d.attachJoint(e),this.state=2,this.joint=e},e.prototype.detachJoint=function(){this.$3d.detachJoint(),this.$2d.detachJoint(),this.state=1,this.joint=null},e.prototype.update=function(e){this.type=e,this.$3d.updateAttachedJoint()},e.prototype.callFunction=function(e,t){if(this[this.type]&&"function"==typeof this[this.type][e])return this[this.type][e](t);else return console.warn(e+" is not a function!"),null},e}),define("light/main",["require"],function(require){function e(e){function t(){if(null!=r.attached){var e=r.children[r.attached.uuid],t=r.attached.position;e.position.set(t.x,t.y,t.z);var i=r.stage.camera.position.distanceTo(t)/r.baseRule;r.attached.scale.x=r.attached.scale.y=r.attached.scale.z=i}}var r=this;this.stage=e.stage.$3d,this.ui=e.ui,this.hoverColor=e.hoverColor||16776960,this.helper=new THREE.TransformControls(this.stage.camera,this.stage.renderer.domElement),this.helper.addEventListener("objectChange",t),this.hoverAnchor="",this.attached=null,this.baseRule=1e3,this.children={},this.anchors={},this.anchorsArray=[]}return e.prototype.attach=function(e){this.attached=e,this.helper.attach(e),this.stage.scene.add(this.helper),this.stage.updateWithCamera.lightHelper=this.helper,this.helper.update()},e.prototype.detach=function(){this.attached=null,this.helper.detach(),this.stage.scene.remove(this.helper),this.stage.updateWithCamera.lightHelper=null},e.prototype.add=function(e){if(!e.hasOwnProperty("birth"))e.locked=!1,e.birth=(new Date).getTime();this.stage.scene.add(e);var t=new THREE.Mesh(new THREE.SphereGeometry(5,32,32),new THREE.MeshBasicMaterial({color:e.color}));if(t.uuid=e.uuid,t.locked=e.locked,t.visible=e.visible,t.position.set(e.position.x,e.position.y,e.position.z),t.added=!1,t.__normalColor__=t.material.color.getHex(),"picklight"===this.ui.refs.containerleft.refs.controlbar.state.systemtool)t.added=!0,this.stage.scene.add(t);this.children[e.uuid]=e,this.anchors[e.uuid]=t,this.update(),this.anchorsArray=[];for(var r in this.anchors)this.anchorsArray.push(this.anchors[r])},e.prototype.remove=function(e){if(this.attached&&this.attached.uuid===e)this.detach();this.stage.scene.remove(this.children[e]),this.stage.scene.remove(this.anchors[e]),delete this.children[e],delete this.anchors[e],this.anchorsArray=[];for(var t in this.anchors)this.anchorsArray.push(this.anchors[t])},e.prototype.removeAll=function(){for(var e in this.children)this.remove(e)},e.prototype.show=function(){for(var e in this.anchors){var t=this.anchors[e];t.added=!0,this.stage.scene.add(t)}this.stage.updateWithCamera.light=this,this.update()},e.prototype.hover=function(e){if(""!==this.hoverAnchor){var t=this.anchors[this.hoverAnchor];t.material.setValues({color:t.__normalColor__}),this.hoverAnchor=""}if(this.anchors[e])this.hoverAnchor=e,t=this.anchors[this.hoverAnchor],t.material.setValues({color:this.hoverColor})},e.prototype.hide=function(){for(var e in this.anchors){var t=this.anchors[e];t.added=!1,this.stage.scene.remove(t)}this.stage.updateWithCamera.light=null},e.prototype.update=function(){var e=this.stage.camera.position;for(var t in this.anchors){var r=this.anchors[t];if(r.added){var i=e.distanceTo(r.position)/this.baseRule;r.scale.x=r.scale.y=r.scale.z=i}else;}},e}),define("widget/dialog.jsx",["require"],function(require){function e(){this.container=document.createElement("div"),this.container.className="dialog"}var t=React.createClass({displayName:"DialogUI",getDefaultProps:function(){return{title:"title"}},componentDidMount:function(){if("function"==typeof this.props.content){var e=this;this.content=React.render(React.createElement(this.props.content,this.props.contentProps),this.refs.content.getDOMNode(),function(){e.resize()})}},resize:function(){var e=this.getDOMNode().parentNode,t=document.documentElement,r=.5*(t.clientWidth-e.clientWidth),i=.38*(t.clientHeight-e.clientHeight);e.style.cssText="left:"+r+"px;top:"+i+"px"},closeHandler:function(){React.unmountComponentAtNode(this.refs.content.getDOMNode()),"function"==typeof this.props.onClose&&this.props.onClose()},render:function(){return React.createElement("div",null,React.createElement("div",{className:"title-bar"},React.createElement("span",null,this.props.title),React.createElement("div",{className:"iconfont icon-guanbi",onClick:this.closeHandler})),React.createElement("div",{ref:"content",className:"content"}))}});return e.prototype.pop=function(e){document.body.appendChild(this.container);var r=this;e=e||{},this.ui=React.render(React.createElement(t,e),this.container,function(){function t(){if(r.ui)clearInterval(i),e.focus&&r.ui.content.refs[e.focus].getDOMNode().focus()}var i=setInterval(t,10)})},e.prototype.close=function(){React.unmountComponentAtNode(this.container),document.body.removeChild(this.container),this.ui=null},e}),define("ui/widget/dialog.jsx",["widget/dialog.jsx"],function(e){return e});var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,r=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in i,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},o=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),s=e.webkitRequestFileSystem,l=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},h="application/octet-stream",u=0,d=500,f=function(t){var i=function(){if("string"==typeof t)r().revokeObjectURL(t);else t.remove()};if(e.chrome)i();else setTimeout(i,d)},m=function(e,t,r){t=[].concat(t);for(var i=t.length;i--;){var n=e["on"+t[i]];if("function"==typeof n)try{n.call(e,r||e)}catch(a){c(a)}}},p=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type))return new Blob(["\ufeff",e],{type:e.type});else return e},g=function(t,c,d){if(!d)t=p(t);var g,v,y,b=this,w=t.type,_=!1,x=function(){m(b,"writestart progress write writeend".split(" "))},k=function(){if(v&&o&&"undefined"!=typeof FileReader){var i=new FileReader;return i.onloadend=function(){var e=i.result;v.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),b.readyState=b.DONE,x()},i.readAsDataURL(t),void(b.readyState=b.INIT)}if(_||!g)g=r().createObjectURL(t);if(v)v.location.href=g;else{var n=e.open(g,"_blank");if(void 0==n&&o)e.location.href=g}b.readyState=b.DONE,x(),f(g)},E=function(e){return function(){if(b.readyState!==b.DONE)return e.apply(this,arguments);else return void 0}},C={create:!0,exclusive:!1};if(b.readyState=b.INIT,!c)c="download";if(n)return g=r().createObjectURL(t),i.href=g,i.download=c,void setTimeout(function(){a(i),x(),f(g),b.readyState=b.DONE});if(e.chrome&&w&&w!==h)y=t.slice||t.webkitSlice,t=y.call(t,0,t.size,h),_=!0;if(s&&"download"!==c)c+=".download";if(w===h||s)v=e;if(!l)return void k();else return u+=t.size,void l(e.TEMPORARY,u,E(function(e){e.root.getDirectory("saved",C,E(function(e){var r=function(){e.getFile(c,C,E(function(e){e.createWriter(E(function(r){r.onwriteend=function(t){v.location.href=e.toURL(),b.readyState=b.DONE,m(b,"writeend",t),f(e)},r.onerror=function(){var e=r.error;if(e.code!==e.ABORT_ERR)k()},"writestart progress write abort".split(" ").forEach(function(e){r["on"+e]=b["on"+e]}),r.write(t),b.abort=function(){r.abort(),b.readyState=b.DONE},b.readyState=b.WRITING}),k)}),k)};e.getFile(c,{create:!1},E(function(e){e.remove(),r()}),E(function(e){if(e.code===e.NOT_FOUND_ERR)r();else k()}))}),k)}),k)},v=g.prototype,y=function(e,t,r){return new g(e,t,r)};if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)return function(e,t,r){if(!r)e=p(e);return navigator.msSaveOrOpenBlob(e,t||"download")};else return v.abort=function(){var e=this;e.readyState=e.DONE,m(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,y}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);if("undefined"!=typeof module&&module.exports)module.exports.saveAs=saveAs;else if("undefined"!=typeof define&&null!==define&&null!=define.amd)define("io/util/FileSaver",[],function(){return saveAs});define("io/util/object2three",["require"],function(require){function e(e,t){var r=new THREE.Matrix4;r.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),e.applyMatrix(r)}function t(e,t,r){function i(e){r.map=new THREE.Texture(e),r.map.needsUpdate=!0,r.needsUpdate=!0}function n(r){if(!(r instanceof FileError)){var n=document.createElement("img");n.src=r.target.result,n.path=t.image,n.onload=function(){e.imgCache[a]=this,i(this)}}}if(t){var a=t.image.split("/").pop();if(e.imgCache[a])i(e.imgCache[a]);else e.fs.read(t.image,n,{type:"readAsDataURL"})}}var r={PlaneGeometry:"var param = arguments[0];\nreturn new THREE.PlaneGeometry(param.width, param.height, param.widthSegments, param.heightSegments);"};return{light:function(t){if("function"!=typeof THREE[t.type])return null;var r=new THREE[t.type];for(var i in t)switch(i){case"matrix":e(r,t[i]);break;case"color":r.color=new THREE.Color(t[i]);break;default:r[i]=t[i]}return r},mesh:function(i,n){try{if(!r.hasOwnProperty(i.geometry.type))return null;for(var a=new Function(r[i.geometry.type])(i.geometry.parameters),o=new THREE[i.material.type],s=new THREE.Mesh(a,o),l=i.geometry.faces,c=0;c<a.faces.length;c++){var h=a.faces[c];h.a=l[3*c],h.b=l[3*c+1],h.c=l[3*c+2]}for(var u=i.geometry.vertices,c=0;c<a.vertices.length;c++)a.vertices[c].set(u[3*c],u[3*c+1],u[3*c+2]);var d={};for(var f in i.material)switch(f){case"color":d[f]=new THREE.Color(i.material[f]);break;case"emissive":d[f]=new THREE.Color(i.material[f]);break;case"map":t(n,i.material.map,o);break;default:d[f]=i.material[f]}o.setValues(d);for(var f in i)switch(f){case"material":break;case"geometry":break;case"matrix":e(s,i[f]);break;case"birth":s[f]=new Date(i[f]).getTime();break;default:s[f]=i[f]}return s}catch(m){return console.error(m.message),null}}}}),define("io/loader/confLoader",["require","../util/object2three"],function(require){
function e(e,r){var i=this,n=i.stage.$3d,a=i.ui.refs.containerleft.refs.controlbar,o=t.light(e.defaultLight);if(i.light.add(o),n.param.gridSize=e.grid.size,n.resizeGrid(!0),n.resizeGrid(!1),e.grid.visible===!1){i.stage.callFunction("toggleHelper");var s=a.getDOMNode().getElementsByClassName("icon-kejian");s[0].dataset.uiValue=1,s[0].className=s[0].className.replace("icon-kejian","icon-bukejian")}setTimeout(function(){i.main("view-"+e.controlBar.cameraview),i.main("mouse-"+e.controlBar.systemtool),r(!0)},200)}var t=require("../util/object2three");return e}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("io/util/jszip",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){return function e(t,r,i){function n(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return n(r?r:e)},c,c.exports,e,t,r,i)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,n,a,o,s,l,c="",h=0;h<e.length;)t=e.charCodeAt(h++),r=e.charCodeAt(h++),n=e.charCodeAt(h++),a=t>>2,o=(3&t)<<4|r>>4,s=(15&r)<<2|n>>6,l=63&n,isNaN(r)?s=l=64:isNaN(n)&&(l=64),c=c+i.charAt(a)+i.charAt(o)+i.charAt(s)+i.charAt(l);return c},r.decode=function(e){var t,r,n,a,o,s,l,c="",h=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<e.length;)a=i.indexOf(e.charAt(h++)),o=i.indexOf(e.charAt(h++)),s=i.indexOf(e.charAt(h++)),l=i.indexOf(e.charAt(h++)),t=a<<2|o>>4,r=(15&o)<<4|s>>2,n=(3&s)<<6|l,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(r)),64!=l&&(c+=String.fromCharCode(n));return c}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\x00\x00",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var n="string"!==r.getTypeOf(e);"undefined"==typeof t&&(t=0);var a=0,o=0,s=0;t=-1^t;for(var l=0,c=e.length;c>l;l++)s=n?e[l]:e.charCodeAt(l),o=255&(t^s),a=i[o],t=t>>>8^a;return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var i=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],7:[function(e,t,r){"use strict";var i=e("./utils");r.string2binary=function(e){return i.string2binary(e)},r.string2Uint8Array=function(e){return i.transformTo("uint8array",e)},r.uint8Array2String=function(e){return i.transformTo("string",e)},r.string2Blob=function(e){var t=i.transformTo("arraybuffer",e);return i.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return i.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return i.transformTo(e,t)},r.getTypeOf=function(e){return i.getTypeOf(e)},r.checkSupport=function(e){return i.checkSupport(e)},r.MAX_VALUE_16BITS=i.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=i.MAX_VALUE_32BITS,r.pretty=function(e){return i.pretty(e)},r.findCompression=function(e){return i.findCompression(e)},r.isRegExp=function(e){return i.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako");r.uncompressInputType=i?"uint8array":"array",r.compressInputType=i?"uint8array":"array",r.magic="\b\x00",r.compress=function(e,t){return n.deflateRaw(e,{level:t.level||-1})},r.uncompress=function(e){return n.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var i=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return i.encode(e)},decode:function(e){return i.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),i=e("./zipEntries");t.exports=function(e,t){var n,a,o,s;for(t=t||{},t.base64&&(e=r.decode(e)),a=new i(e,t),n=a.files,o=0;o<n.length;o++)s=n[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t){(function(e){"use strict";t.exports=function(t,r){return new e(t,r)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var i=e("./uint8ArrayReader");r.prototype=new i,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),i=e("./utils"),n=e("./crc32"),a=e("./signature"),o=e("./defaults"),s=e("./base64"),l=e("./compressions"),c=e("./compressedObject"),h=e("./nodeBuffer"),u=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),m=function(e){if(e._data instanceof c&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===i.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},p=function(e){var t=m(e),n=i.getTypeOf(t);return"string"===n?!e.options.binary&&r.nodebuffer?h(t,"utf-8"):e.asBinary():t},g=function(e){var t=m(this);return null===t||"undefined"==typeof t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?A.utf8decode(t):i.transformTo("string",t),e||this.options.binary||(t=i.transformTo("string",A.utf8encode(t))),t)},v=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};v.prototype={asText:function(){return g.call(this,!0)},asBinary:function(){return g.call(this,!1)},asNodeBuffer:function(){var e=p(this);return i.transformTo("nodebuffer",e)},asUint8Array:function(){var e=p(this);return i.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var r,i="";for(r=0;t>r;r++)i+=String.fromCharCode(255&e),e>>>=8;return i},b=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof r[t]&&(r[t]=arguments[e][t]);return r},w=function(e){return e=e||{},e.base64!==!0||null!==e.binary&&void 0!==e.binary||(e.binary=!0),e=b(e,o),e.date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},_=function(e,t,r){var n,a=i.getTypeOf(t);if(r=w(r),"string"==typeof r.unixPermissions&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&16384&r.unixPermissions&&(r.dir=!0),r.dosPermissions&&16&r.dosPermissions&&(r.dir=!0),r.dir&&(e=k(e)),r.createFolders&&(n=x(e))&&E.call(this,n,!0),r.dir||null===t||"undefined"==typeof t)r.base64=!1,r.binary=!1,t=null,a=null;else if("string"===a)r.binary&&!r.base64&&r.optimizedBinaryString!==!0&&(t=i.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(a||t instanceof c))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=i.transformTo("uint8array",t))}var o=new v(e,t,r);return this.files[e]=o,o},x=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},k=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},E=function(e,t){return t="undefined"!=typeof t?t:!1,e=k(e),this.files[e]||_.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},C=function(e,t,r){var a,o=new c;return e._data instanceof c?(o.uncompressedSize=e._data.uncompressedSize,o.crc32=e._data.crc32,0===o.uncompressedSize||e.dir?(t=l.STORE,o.compressedContent="",o.crc32=0):e._data.compressionMethod===t.magic?o.compressedContent=e._data.getCompressedContent():(a=e._data.getContent(),o.compressedContent=t.compress(i.transformTo(t.compressInputType,a),r))):(a=p(e),(!a||0===a.length||e.dir)&&(t=l.STORE,a=""),o.uncompressedSize=a.length,o.crc32=n(a),o.compressedContent=t.compress(i.transformTo(t.compressInputType,a),r)),o.compressedSize=o.compressedContent.length,o.compressionMethod=t.magic,o},R=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16},z=function(e){return 63&(e||0)},S=function(e,t,r,o,s){var l,c,h,d,f=(r.compressedContent,i.transformTo("string",u.utf8encode(t.name))),m=t.comment||"",p=i.transformTo("string",u.utf8encode(m)),g=f.length!==t.name.length,v=p.length!==m.length,b=t.options,w="",_="",x="";h=t._initialMetadata.dir!==t.dir?t.dir:b.dir,d=t._initialMetadata.date!==t.date?t.date:b.date;var k=0,E=0;h&&(k|=16),"UNIX"===s?(E=798,k|=R(t.unixPermissions,h)):(E=20,k|=z(t.dosPermissions,h)),l=d.getHours(),l<<=6,l|=d.getMinutes(),l<<=5,l|=d.getSeconds()/2,c=d.getFullYear()-1980,c<<=4,c|=d.getMonth()+1,c<<=5,c|=d.getDate(),g&&(_=y(1,1)+y(n(f),4)+f,w+="up"+y(_.length,2)+_),v&&(x=y(1,1)+y(this.crc32(p),4)+p,w+="uc"+y(x.length,2)+x);var C="";C+="\n\x00",C+=g||v?"\x00\b":"\x00\x00",C+=r.compressionMethod,C+=y(l,2),C+=y(c,2),C+=y(r.crc32,4),C+=y(r.compressedSize,4),C+=y(r.uncompressedSize,4),C+=y(f.length,2),C+=y(w.length,2);var S=a.LOCAL_FILE_HEADER+C+f+w,A=a.CENTRAL_FILE_HEADER+y(E,2)+C+y(p.length,2)+"\x00\x00\x00\x00"+y(k,4)+y(o,4)+f+w+p;return{fileRecord:S,dirRecord:A,compressedObject:r}},A={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,i,n,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],n=new v(i.name,i._data,b(i.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,n)&&a.push(n));return a},file:function(e,t,r){if(1===arguments.length){if(i.isRegExp(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}return this.filter(function(t,r){return!r.dir&&t===e})[0]||null}return e=this.root+e,_.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(i.isRegExp(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=this.root+e,r=E.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(e){e=b(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),i.checkSupport(e.type),("darwin"===e.platform||"freebsd"===e.platform||"linux"===e.platform||"sunos"===e.platform)&&(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var t,r,n=[],o=0,c=0,h=i.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var u in this.files)if(this.files.hasOwnProperty(u)){var m=this.files[u],p=m.options.compression||e.compression.toUpperCase(),g=l[p];if(!g)throw new Error(p+" is not a valid compression method !");var v=m.options.compressionOptions||e.compressionOptions||{},w=C.call(this,m,g,v),_=S.call(this,u,m,w,o,e.platform);o+=_.fileRecord.length+w.compressedSize,c+=_.dirRecord.length,n.push(_)}var x="";x=a.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+y(n.length,2)+y(n.length,2)+y(c,4)+y(o,4)+y(h.length,2)+h;var k=e.type.toLowerCase();for(t="uint8array"===k||"arraybuffer"===k||"blob"===k||"nodebuffer"===k?new f(o+c+x.length):new d(o+c+x.length),r=0;r<n.length;r++)t.append(n[r].fileRecord),t.append(n[r].compressedObject.compressedContent);for(r=0;r<n.length;r++)t.append(n[r].dirRecord);t.append(x);var E=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return i.transformTo(e.type.toLowerCase(),E);case"blob":return i.arrayBuffer2Blob(i.transformTo("arraybuffer",E),e.mimeType);case"base64":return e.base64?s.encode(E):E;default:return E}},crc32:function(e,t){return n(e,t)},utf8encode:function(e){return i.transformTo("string",u.utf8encode(e))},utf8decode:function(e){return u.utf8decode(e)}};t.exports=A},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=e("./dataReader"),n=e("./utils");r.prototype=new i,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),i=function(){this.data=[]};i.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=i},{"./utils":21}],17:[function(e,t,r){(function(e){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof e,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=0===new Blob([t],{type:"application/zip"}).size}catch(i){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=new n;a.append(t),r.blob=0===a.getBlob("application/zip").size}catch(i){r.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var i=e("./dataReader");r.prototype=new i,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===i&&this.data[a+3]===n)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),i=function(e){this.data=new Uint8Array(e),this.index=0};i.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=i},{"./utils":21}],20:[function(e,t,r){"use strict";for(var i=e("./utils"),n=e("./support"),a=e("./nodeBuffer"),o=new Array(256),s=0;256>s;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;o[254]=o[254]=1;var l=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;s>a;a++)r=e.charCodeAt(a),55296===(64512&r)&&s>a+1&&(i=e.charCodeAt(a+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),a++)),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=n.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;l>o;a++)r=e.charCodeAt(a),55296===(64512&r)&&s>a+1&&(i=e.charCodeAt(a+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),a++)),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},c=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&128===(192&e[r]);)r--;return 0>r?t:0===r?t:r+o[e[r]]>t?r:t},h=function(e){var t,r,n,a,s=e.length,l=new Array(2*s);for(r=0,t=0;s>t;)if(n=e[t++],128>n)l[r++]=n;else if(a=o[n],a>4)l[r++]=65533,t+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&s>t;)n=n<<6|63&e[t++],a--;a>1?l[r++]=65533:65536>n?l[r++]=n:(n-=65536,l[r++]=55296|n>>10&1023,l[r++]=56320|1023&n)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),i.applyFromCharCode(l)};r.utf8encode=function(e){return n.nodebuffer?a(e,"utf-8"):l(e)},r.utf8decode=function(e){if(n.nodebuffer)return i.transformTo("nodebuffer",e).toString("utf-8");e=i.transformTo(n.uint8array?"uint8array":"array",e);for(var t=[],r=0,a=e.length,o=65536;a>r;){var s=c(e,Math.min(r+o,a));t.push(n.uint8array?h(e.subarray(r,s)):h(e.slice(r,s))),r=s}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function i(e){return e}function n(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function a(e){var t=65536,i=[],n=e.length,a=r.getTypeOf(e),o=0,s=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,c(0))}}catch(l){s=!1}if(!s){for(var h="",u=0;u<e.length;u++)h+=String.fromCharCode(e[u]);return h}for(;n>o&&t>1;)try{i.push("array"===a||"nodebuffer"===a?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,n))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,n)))),o+=t}catch(l){t=Math.floor(t/2)}return i.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),l=e("./compressions"),c=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e,t){r.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(i){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=new n;return a.append(e),a.getBlob(t)}catch(i){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=a;var h={};h.string={string:i,array:function(e){return n(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return n(e,new Uint8Array(e.length))},nodebuffer:function(e){return n(e,c(e.length))}},h.array={string:a,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(e)}},h.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(new Uint8Array(e))}},h.uint8array={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return c(e)}},h.nodebuffer={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:i},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var i=r.getTypeOf(t),n=h[i][e](t);return n},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&c.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){var t=s[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,i="";for(r=0;r<(e||"").length;r++)t=e.charCodeAt(r),i+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return i},r.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var i=e("./stringReader"),n=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),c=e("./support"),h=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=h.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44,n=0;i>n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)e=new l({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e){var t=!0;try{this.reader.setIndex(0),this.checkSignature(s.LOCAL_FILE_HEADER),t=!1}catch(r){}throw new Error(t?"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===e)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||c.uint8array?"nodebuffer"===t?new n(e):new a(o.transformTo("uint8array",e)):new i(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var i=e("./stringReader"),n=e("./utils"),a=e("./compressedObject"),o=e("./object"),s=0,l=3;r.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var i=e.index;e.setIndex(t);var n=e.readData(r);return e.setIndex(i),n}},prepareContent:function(e,t,r,i,a){return function(){var e=n.transformTo(i.uncompressInputType,this.getCompressedContent()),t=i.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(t=n.findCompression(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,e===s&&(this.dosPermissions=63&this.externalFileAttributes),e===l&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileName.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new i(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,i,n=e.index;
for(this.extraFields=this.extraFields||{};e.index<n+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),i=e.readString(r),this.extraFields[t]={id:t,length:r,value:i}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new i(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new i(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r=e("./lib/utils/common").assign,i=e("./lib/deflate"),n=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};r(o,i,n,a),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function i(e,t){var r=new y(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}function n(e,t){return t=t||{},t.raw=!0,i(e,t)}function a(e,t){return t=t||{},t.gzip=!0,i(e,t)}var o=e("./zlib/deflate.js"),s=e("./utils/common"),l=e("./utils/strings"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=0,d=4,f=0,m=1,p=-1,g=0,v=8,y=function(e){this.options=s.assign({level:p,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==f)throw new Error(c[r]);t.header&&o.deflateSetHeader(this.strm,t.header)};y.prototype.push=function(e,t){var r,i,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:t===!0?d:u,n.input="string"==typeof e?l.string2buf(e):e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(a),n.next_out=0,n.avail_out=a),r=o.deflate(n,i),r!==m&&r!==f)return this.onEnd(r),this.ended=!0,!1;(0===n.avail_out||0===n.avail_in&&i===d)&&this.onData("string"===this.options.to?l.buf2binstring(s.shrinkBuf(n.output,n.next_out)):s.shrinkBuf(n.output,n.next_out))}while((n.avail_in>0||0===n.avail_out)&&r!==m);return i===d?(r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===f):!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===f&&(this.result="string"===this.options.to?this.chunks.join(""):s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=y,r.deflate=i,r.deflateRaw=n,r.gzip=a},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function i(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}function n(e,t){return t=t||{},t.raw=!0,i(e,t)}var a=e("./zlib/inflate.js"),o=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=e("./zlib/gzheader"),d=function(e){this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=a.inflateInit2(this.strm,t.windowBits);if(r!==l.Z_OK)throw new Error(c[r]);this.header=new u,a.inflateGetHeader(this.strm,this.header)};d.prototype.push=function(e,t){var r,i,n,c,h,u=this.strm,d=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,u.input="string"==typeof e?s.binstring2buf(e):e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new o.Buf8(d),u.next_out=0,u.avail_out=d),r=a.inflate(u,l.Z_NO_FLUSH),r!==l.Z_STREAM_END&&r!==l.Z_OK)return this.onEnd(r),this.ended=!0,!1;u.next_out&&(0===u.avail_out||r===l.Z_STREAM_END||0===u.avail_in&&i===l.Z_FINISH)&&("string"===this.options.to?(n=s.utf8border(u.output,u.next_out),c=u.next_out-n,h=s.buf2string(u.output,n),u.next_out=c,u.avail_out=d-c,c&&o.arraySet(u.output,u.output,n,c,0),this.onData(h)):this.onData(o.shrinkBuf(u.output,u.next_out)))}while(u.avail_in>0&&r!==l.Z_STREAM_END);return r===l.Z_STREAM_END&&(i=l.Z_FINISH),i===l.Z_FINISH?(r=a.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l.Z_OK):!0},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=d,r.inflate=i,r.inflateRaw=n,r.ungzip=i},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)return void e.set(t.subarray(r,r+i),n);for(var a=0;i>a;a++)e[n+a]=t[r+a]},flattenChunks:function(e){var t,r,i,n,a,o;for(i=0,t=0,r=e.length;r>t;t++)i+=e[t].length;for(o=new Uint8Array(i),n=0,t=0,r=e.length;r>t;t++)a=e[t],o.set(a,n),n+=a.length;return o}},a={arraySet:function(e,t,r,i,n){for(var a=0;i>a;a++)e[n+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(i)},{}],28:[function(e,t,r){"use strict";function i(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",i=0;t>i;i++)r+=String.fromCharCode(e[i]);return r}var n=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(s){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){o=!1}for(var l=new n.Buf8(256),c=0;256>c;c++)l[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;l[254]=l[254]=1,r.string2buf=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;s>a;a++)r=e.charCodeAt(a),55296===(64512&r)&&s>a+1&&(i=e.charCodeAt(a+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),a++)),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=new n.Buf8(l),o=0,a=0;l>o;a++)r=e.charCodeAt(a),55296===(64512&r)&&s>a+1&&(i=e.charCodeAt(a+1),56320===(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),a++)),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return i(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;i>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,a,o,s=t||e.length,c=new Array(2*s);for(n=0,r=0;s>r;)if(a=e[r++],128>a)c[n++]=a;else if(o=l[a],o>4)c[n++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&s>r;)a=a<<6|63&e[r++],o--;o>1?c[n++]=65533:65536>a?c[n++]=a:(a-=65536,c[n++]=55296|a>>10&1023,c[n++]=56320|1023&a)}return i(c,n)},r.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&128===(192&e[r]);)r--;return 0>r?t:0===r?t:r+l[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";function r(e,t,r,i){for(var n=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){o=r>2e3?2e3:r,r-=o;do n=n+t[i++]|0,a=a+n|0;while(--o);n%=65521,a%=65521}return n|a<<16|0}t.exports=r},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";function r(){for(var e,t=[],r=0;256>r;r++){e=r;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}function i(e,t,r,i){var a=n,o=i+r;e=-1^e;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}var n=r();t.exports=i},{}],32:[function(e,t,r){"use strict";function i(e,t){return e.msg=T[t],t}function n(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(S.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function h(e,t,r,i){var n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,S.arraySet(t,e.input,e.next_in,n,r),1===e.state.wrap?e.adler=M(e.adler,t,n,r):2===e.state.wrap&&(e.adler=B(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)}function u(e,t){var r,i,n=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-ce?e.strstart-(e.w_size-ce):0,c=e.window,h=e.w_mask,u=e.prev,d=e.strstart+le,f=c[a+o-1],m=c[a+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do if(r=t,c[r+o]===m&&c[r+o-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do;while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&d>a);if(i=le-(d-a),a=d-le,i>o){if(e.match_start=t,o=i,i>=s)break;f=c[a+o-1],m=c[a+o]}}while((t=u[t&h])>l&&0!==--n);return o<=e.lookahead?o:e.lookahead}function d(e){var t,r,i,n,a,o=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-ce)){S.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,r=e.hash_size,t=r;do i=e.head[--t],e.head[t]=i>=o?i-o:0;while(--r);r=o,t=r;do i=e.prev[--t],e.prev[t]=i>=o?i-o:0;while(--r);n+=o}if(0===e.strm.avail_in)break;if(r=h(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=se)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+se-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<se)););}while(e.lookahead<ce&&0!==e.strm.avail_in)}function f(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===N)return ye;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,s(e,!1),0===e.strm.avail_out))return ye;if(e.strstart-e.block_start>=e.w_size-ce&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===D?(s(e,!0),0===e.strm.avail_out?we:_e):e.strstart>e.block_start&&(s(e,!1),0===e.strm.avail_out)?ye:ye}function m(e,t){for(var r,i;;){if(e.lookahead<ce){if(d(e),e.lookahead<ce&&t===N)return ye;if(0===e.lookahead)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-ce&&(e.match_length=u(e,r)),e.match_length>=se)if(i=A._tr_tally(e,e.strstart-e.match_start,e.match_length-se),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=se){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=e.strstart<se-1?e.strstart:se-1,t===D?(s(e,!0),0===e.strm.avail_out?we:_e):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:be}function p(e,t){for(var r,i,n;;){if(e.lookahead<ce){if(d(e),e.lookahead<ce&&t===N)return ye;if(0===e.lookahead)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=se-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-ce&&(e.match_length=u(e,r),e.match_length<=5&&(e.strategy===q||e.match_length===se&&e.strstart-e.match_start>4096)&&(e.match_length=se-1)),e.prev_length>=se&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-se,i=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-se),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=se-1,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return ye}else if(e.match_available){if(i=A._tr_tally(e,0,e.window[e.strstart-1]),i&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ye}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<se-1?e.strstart:se-1,t===D?(s(e,!0),0===e.strm.avail_out?we:_e):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:be}function g(e,t){for(var r,i,n,a,o=e.window;;){if(e.lookahead<=le){if(d(e),e.lookahead<=le&&t===N)return ye;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=se&&e.strstart>0&&(n=e.strstart-1,i=o[n],i===o[++n]&&i===o[++n]&&i===o[++n])){a=e.strstart+le;do;while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&a>n);e.match_length=le-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=se?(r=A._tr_tally(e,1,e.match_length-se),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===D?(s(e,!0),0===e.strm.avail_out?we:_e):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:be}function v(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===N)return ye;break}if(e.match_length=0,r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===D?(s(e,!0),0===e.strm.avail_out?we:_e):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:be}function y(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=z[e.level].max_lazy,e.good_match=z[e.level].good_length,e.nice_match=z[e.level].nice_length,e.max_chain_length=z[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=se-1,e.match_available=0,e.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*ae),this.dyn_dtree=new S.Buf16(2*(2*ie+1)),this.bl_tree=new S.Buf16(2*(2*ne+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(oe+1),this.heap=new S.Buf16(2*re+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*re+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=W,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ue:ge,e.adler=2===t.wrap?0:1,t.last_flush=N,A._tr_init(t),L):i(e,I)}function _(e){var t=w(e);return t===L&&y(e.state),t}function x(e,t){return e&&e.state?2!==e.state.wrap?I:(e.state.gzhead=t,L):I}function k(e,t,r,n,a,o){if(!e)return I;var s=1;if(t===U&&(t=6),0>n?(s=0,n=-n):n>15&&(s=2,n-=16),1>a||a>X||r!==Y||8>n||n>15||0>t||t>9||0>o||o>K)return i(e,I);8===n&&(n=9);var l=new b;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+se-1)/se),l.window=new S.Buf8(2*l.w_size),l.head=new S.Buf16(l.hash_size),l.prev=new S.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new S.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,_(e)}function E(e,t){return k(e,t,Y,J,Q,Z)}function C(e,t){var r,s,h,u;if(!e||!e.state||t>O||0>t)return e?i(e,I):I;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ve&&t!==D)return i(e,0===e.avail_out?$:I);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ue)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=B(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=de):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,xe),s.status=ge);else{var d=Y+(s.w_bits-8<<4)<<8,f=-1;f=s.strategy>=G||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=f<<6,0!==s.strstart&&(d|=he),d+=31-d%31,s.status=ge,c(s,d),0!==s.strstart&&(c(s,e.adler>>>16),c(s,65535&e.adler)),e.adler=1}if(s.status===de)if(s.gzhead.extra){for(h=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),o(e),h=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=fe)}else s.status=fe;if(s.status===fe)if(s.gzhead.name){h=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),o(e),h=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),0===u&&(s.gzindex=0,s.status=me)}else s.status=me;if(s.status===me)if(s.gzhead.comment){h=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),o(e),h=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>h&&(e.adler=B(e.adler,s.pending_buf,s.pending-h,h)),0===u&&(s.status=pe)}else s.status=pe;if(s.status===pe&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=ge)):s.status=ge),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,L}else if(0===e.avail_in&&n(t)<=n(r)&&t!==D)return i(e,$);if(s.status===ve&&0!==e.avail_in)return i(e,$);if(0!==e.avail_in||0!==s.lookahead||t!==N&&s.status!==ve){var m=s.strategy===G?v(s,t):s.strategy===V?g(s,t):z[s.level].func(s,t);if((m===we||m===_e)&&(s.status=ve),m===ye||m===we)return 0===e.avail_out&&(s.last_flush=-1),L;if(m===be&&(t===P?A._tr_align(s):t!==O&&(A._tr_stored_block(s,0,0,!1),t===j&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,L}return t!==D?L:s.wrap<=0?H:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(c(s,e.adler>>>16),c(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?L:H)}function R(e){var t;return e&&e.state?(t=e.state.status,t!==ue&&t!==de&&t!==fe&&t!==me&&t!==pe&&t!==ge&&t!==ve?i(e,I):(e.state=null,t===ge?i(e,F):L)):I}var z,S=e("../utils/common"),A=e("./trees"),M=e("./adler32"),B=e("./crc32"),T=e("./messages"),N=0,P=1,j=3,D=4,O=5,L=0,H=1,I=-2,F=-3,$=-5,U=-1,q=1,G=2,V=3,K=4,Z=0,W=2,Y=8,X=9,J=15,Q=8,ee=29,te=256,re=te+1+ee,ie=30,ne=19,ae=2*re+1,oe=15,se=3,le=258,ce=le+se+1,he=32,ue=42,de=69,fe=73,me=91,pe=103,ge=113,ve=666,ye=1,be=2,we=3,_e=4,xe=3,ke=function(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n};z=[new ke(0,0,0,0,f),new ke(4,4,8,4,m),new ke(4,5,16,8,m),new ke(4,6,32,32,m),new ke(4,4,16,16,p),new ke(8,16,32,32,p),new ke(8,16,128,128,p),new ke(8,32,128,256,p),new ke(32,128,258,1024,p),new ke(32,258,258,4096,p)],r.deflateInit=E,r.deflateInit2=k,r.deflateReset=_,r.deflateResetKeep=w,r.deflateSetHeader=x,r.deflate=C,r.deflateEnd=R,r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],34:[function(e,t){"use strict";var r=30,i=12;t.exports=function(e,t){var n,a,o,s,l,c,h,u,d,f,m,p,g,v,y,b,w,_,x,k,E,C,R,z,S;n=e.state,a=e.next_in,z=e.input,o=a+(e.avail_in-5),s=e.next_out,S=e.output,l=s-(t-e.avail_out),c=s+(e.avail_out-257),h=n.dmax,u=n.wsize,d=n.whave,f=n.wnext,m=n.window,p=n.hold,g=n.bits,v=n.lencode,y=n.distcode,b=(1<<n.lenbits)-1,w=(1<<n.distbits)-1;e:do{15>g&&(p+=z[a++]<<g,g+=8,p+=z[a++]<<g,g+=8),_=v[p&b];t:for(;;){if(x=_>>>24,p>>>=x,g-=x,x=_>>>16&255,0===x)S[s++]=65535&_;else{if(!(16&x)){if(0===(64&x)){_=v[(65535&_)+(p&(1<<x)-1)];continue t}if(32&x){n.mode=i;break e}e.msg="invalid literal/length code",n.mode=r;break e}k=65535&_,x&=15,x&&(x>g&&(p+=z[a++]<<g,g+=8),k+=p&(1<<x)-1,p>>>=x,g-=x),15>g&&(p+=z[a++]<<g,g+=8,p+=z[a++]<<g,g+=8),_=y[p&w];r:for(;;){if(x=_>>>24,p>>>=x,g-=x,x=_>>>16&255,!(16&x)){if(0===(64&x)){_=y[(65535&_)+(p&(1<<x)-1)];continue r}e.msg="invalid distance code",n.mode=r;break e}if(E=65535&_,x&=15,x>g&&(p+=z[a++]<<g,g+=8,x>g&&(p+=z[a++]<<g,g+=8)),E+=p&(1<<x)-1,E>h){e.msg="invalid distance too far back",n.mode=r;break e}if(p>>>=x,g-=x,x=s-l,E>x){if(x=E-x,x>d&&n.sane){e.msg="invalid distance too far back",n.mode=r;break e}if(C=0,R=m,0===f){if(C+=u-x,k>x){k-=x;do S[s++]=m[C++];while(--x);C=s-E,R=S}}else if(x>f){if(C+=u+f-x,x-=f,k>x){k-=x;do S[s++]=m[C++];while(--x);if(C=0,k>f){x=f,k-=x;do S[s++]=m[C++];while(--x);C=s-E,R=S}}}else if(C+=f-x,k>x){k-=x;do S[s++]=m[C++];while(--x);C=s-E,R=S}for(;k>2;)S[s++]=R[C++],S[s++]=R[C++],S[s++]=R[C++],k-=3;k&&(S[s++]=R[C++],k>1&&(S[s++]=R[C++]))}else{C=s-E;do S[s++]=S[C++],S[s++]=S[C++],S[s++]=S[C++],k-=3;while(k>2);k&&(S[s++]=S[C++],k>1&&(S[s++]=S[C++]))}break}}break}}while(o>a&&c>s);k=g>>3,a-=k,g-=k<<3,p&=(1<<g)-1,e.next_in=a,e.next_out=s,e.avail_in=o>a?5+(o-a):5-(a-o),e.avail_out=c>s?257+(c-s):257-(s-c),n.hold=p,n.bits=g}},{}],35:[function(e,t,r){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new v.Buf32(me),t.distcode=t.distdyn=new v.Buf32(pe),t.sane=1,t.back=-1,S):B}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,a(e)):B}function s(e,t){var r,i;return e&&e.state?(i=e.state,0>t?(r=0,t=-t):(r=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,o(e))):B}function l(e,t){var r,i;return e?(i=new n,e.state=i,i.window=null,r=s(e,t),r!==S&&(e.state=null),r):B}function c(e){return l(e,ve)}function h(e){if(ye){var t;for(p=new v.Buf32(512),g=new v.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(_(k,e.lens,0,288,p,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;_(E,e.lens,0,32,g,0,e.work,{bits:5}),ye=!1}e.lencode=p,e.lenbits=9,e.distcode=g,e.distbits=5}function u(e,t,r,i){var n,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new v.Buf8(a.wsize)),i>=a.wsize?(v.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),v.arraySet(a.window,t,r-i,n,a.wnext),i-=n,i?(v.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function d(e,t){var r,n,a,o,s,l,c,d,f,m,p,g,me,pe,ge,ve,ye,be,we,_e,xe,ke,Ee,Ce,Re=0,ze=new v.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;r=e.state,r.mode===K&&(r.mode=Z),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,f=r.bits,m=l,p=c,ke=S;e:for(;;)switch(r.mode){case D:if(0===r.wrap){r.mode=Z;break}for(;16>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(2&r.wrap&&35615===d){r.check=0,ze[0]=255&d,ze[1]=d>>>8&255,r.check=b(r.check,ze,2,0),d=0,f=0,r.mode=O;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=ue;break}if((15&d)!==j){e.msg="unknown compression method",r.mode=ue;break}if(d>>>=4,f-=4,xe=(15&d)+8,0===r.wbits)r.wbits=xe;else if(xe>r.wbits){e.msg="invalid window size",r.mode=ue;break}r.dmax=1<<xe,e.adler=r.check=1,r.mode=512&d?G:K,d=0,f=0;break;case O:for(;16>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(r.flags=d,(255&r.flags)!==j){e.msg="unknown compression method",r.mode=ue;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ue;break}r.head&&(r.head.text=d>>8&1),512&r.flags&&(ze[0]=255&d,ze[1]=d>>>8&255,r.check=b(r.check,ze,2,0)),d=0,f=0,r.mode=L;case L:for(;32>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.head&&(r.head.time=d),512&r.flags&&(ze[0]=255&d,ze[1]=d>>>8&255,ze[2]=d>>>16&255,ze[3]=d>>>24&255,r.check=b(r.check,ze,4,0)),d=0,f=0,r.mode=H;case H:for(;16>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&r.flags&&(ze[0]=255&d,ze[1]=d>>>8&255,r.check=b(r.check,ze,2,0)),d=0,f=0,r.mode=I;case I:if(1024&r.flags){for(;16>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.length=d,r.head&&(r.head.extra_len=d),512&r.flags&&(ze[0]=255&d,ze[1]=d>>>8&255,r.check=b(r.check,ze,2,0)),d=0,f=0}else r.head&&(r.head.extra=null);r.mode=F;case F:if(1024&r.flags&&(g=r.length,g>l&&(g=l),g&&(r.head&&(xe=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),v.arraySet(r.head.extra,n,o,g,xe)),512&r.flags&&(r.check=b(r.check,n,g,o)),l-=g,o+=g,r.length-=g),r.length))break e;r.length=0,r.mode=$;case $:if(2048&r.flags){if(0===l)break e;g=0;do xe=n[o+g++],r.head&&xe&&r.length<65536&&(r.head.name+=String.fromCharCode(xe));while(xe&&l>g);if(512&r.flags&&(r.check=b(r.check,n,g,o)),l-=g,o+=g,xe)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=U;case U:if(4096&r.flags){if(0===l)break e;g=0;do xe=n[o+g++],r.head&&xe&&r.length<65536&&(r.head.comment+=String.fromCharCode(xe));while(xe&&l>g);if(512&r.flags&&(r.check=b(r.check,n,g,o)),l-=g,o+=g,xe)break e}else r.head&&(r.head.comment=null);r.mode=q;case q:if(512&r.flags){for(;16>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ue;break}d=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=K;break;case G:for(;32>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}e.adler=r.check=i(d),d=0,f=0,r.mode=V;case V:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=f,M;e.adler=r.check=1,r.mode=K;case K:if(t===R||t===z)break e;case Z:if(r.last){d>>>=7&f,f-=7&f,r.mode=le;break}for(;3>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}switch(r.last=1&d,d>>>=1,f-=1,3&d){case 0:r.mode=W;break;case 1:if(h(r),r.mode=te,t===z){d>>>=2,f-=2;break e}break;case 2:r.mode=J;break;case 3:e.msg="invalid block type",r.mode=ue}d>>>=2,f-=2;break;case W:for(d>>>=7&f,f-=7&f;32>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if((65535&d)!==(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ue;break}if(r.length=65535&d,d=0,f=0,r.mode=Y,t===z)break e;case Y:r.mode=X;case X:if(g=r.length){if(g>l&&(g=l),g>c&&(g=c),0===g)break e;v.arraySet(a,n,o,g,s),l-=g,o+=g,c-=g,s+=g,r.length-=g;break}r.mode=K;break;case J:for(;14>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(r.nlen=(31&d)+257,d>>>=5,f-=5,r.ndist=(31&d)+1,d>>>=5,f-=5,r.ncode=(15&d)+4,d>>>=4,f-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ue;break}r.have=0,r.mode=Q;case Q:for(;r.have<r.ncode;){for(;3>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.lens[Se[r.have++]]=7&d,d>>>=3,f-=3}for(;r.have<19;)r.lens[Se[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ee={bits:r.lenbits},ke=_(x,r.lens,0,19,r.lencode,0,r.work,Ee),r.lenbits=Ee.bits,ke){e.msg="invalid code lengths set",r.mode=ue;break}r.have=0,r.mode=ee;case ee:for(;r.have<r.nlen+r.ndist;){for(;Re=r.lencode[d&(1<<r.lenbits)-1],ge=Re>>>24,ve=Re>>>16&255,ye=65535&Re,!(f>=ge);){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(16>ye)d>>>=ge,f-=ge,r.lens[r.have++]=ye;else{if(16===ye){for(Ce=ge+2;Ce>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(d>>>=ge,f-=ge,0===r.have){e.msg="invalid bit length repeat",r.mode=ue;break}xe=r.lens[r.have-1],g=3+(3&d),d>>>=2,f-=2}else if(17===ye){for(Ce=ge+3;Ce>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}d>>>=ge,f-=ge,xe=0,g=3+(7&d),d>>>=3,f-=3}else{for(Ce=ge+7;Ce>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}d>>>=ge,f-=ge,xe=0,g=11+(127&d),d>>>=7,f-=7}if(r.have+g>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ue;break}for(;g--;)r.lens[r.have++]=xe}}if(r.mode===ue)break;
if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ue;break}if(r.lenbits=9,Ee={bits:r.lenbits},ke=_(k,r.lens,0,r.nlen,r.lencode,0,r.work,Ee),r.lenbits=Ee.bits,ke){e.msg="invalid literal/lengths set",r.mode=ue;break}if(r.distbits=6,r.distcode=r.distdyn,Ee={bits:r.distbits},ke=_(E,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ee),r.distbits=Ee.bits,ke){e.msg="invalid distances set",r.mode=ue;break}if(r.mode=te,t===z)break e;case te:r.mode=re;case re:if(l>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=f,w(e,p),s=e.next_out,a=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,f=r.bits,r.mode===K&&(r.back=-1);break}for(r.back=0;Re=r.lencode[d&(1<<r.lenbits)-1],ge=Re>>>24,ve=Re>>>16&255,ye=65535&Re,!(f>=ge);){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(ve&&0===(240&ve)){for(be=ge,we=ve,_e=ye;Re=r.lencode[_e+((d&(1<<be+we)-1)>>be)],ge=Re>>>24,ve=Re>>>16&255,ye=65535&Re,!(f>=be+ge);){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}d>>>=be,f-=be,r.back+=be}if(d>>>=ge,f-=ge,r.back+=ge,r.length=ye,0===ve){r.mode=se;break}if(32&ve){r.back=-1,r.mode=K;break}if(64&ve){e.msg="invalid literal/length code",r.mode=ue;break}r.extra=15&ve,r.mode=ie;case ie:if(r.extra){for(Ce=r.extra;Ce>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=ne;case ne:for(;Re=r.distcode[d&(1<<r.distbits)-1],ge=Re>>>24,ve=Re>>>16&255,ye=65535&Re,!(f>=ge);){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(0===(240&ve)){for(be=ge,we=ve,_e=ye;Re=r.distcode[_e+((d&(1<<be+we)-1)>>be)],ge=Re>>>24,ve=Re>>>16&255,ye=65535&Re,!(f>=be+ge);){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}d>>>=be,f-=be,r.back+=be}if(d>>>=ge,f-=ge,r.back+=ge,64&ve){e.msg="invalid distance code",r.mode=ue;break}r.offset=ye,r.extra=15&ve,r.mode=ae;case ae:if(r.extra){for(Ce=r.extra;Ce>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ue;break}r.mode=oe;case oe:if(0===c)break e;if(g=p-c,r.offset>g){if(g=r.offset-g,g>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ue;break}g>r.wnext?(g-=r.wnext,me=r.wsize-g):me=r.wnext-g,g>r.length&&(g=r.length),pe=r.window}else pe=a,me=s-r.offset,g=r.length;g>c&&(g=c),c-=g,r.length-=g;do a[s++]=pe[me++];while(--g);0===r.length&&(r.mode=re);break;case se:if(0===c)break e;a[s++]=r.length,c--,r.mode=re;break;case le:if(r.wrap){for(;32>f;){if(0===l)break e;l--,d|=n[o++]<<f,f+=8}if(p-=c,e.total_out+=p,r.total+=p,p&&(e.adler=r.check=r.flags?b(r.check,a,p,s-p):y(r.check,a,p,s-p)),p=c,(r.flags?d:i(d))!==r.check){e.msg="incorrect data check",r.mode=ue;break}d=0,f=0}r.mode=ce;case ce:if(r.wrap&&r.flags){for(;32>f;){if(0===l)break e;l--,d+=n[o++]<<f,f+=8}if(d!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ue;break}d=0,f=0}r.mode=he;case he:ke=A;break e;case ue:ke=T;break e;case de:return N;case fe:default:return B}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=f,(r.wsize||p!==e.avail_out&&r.mode<ue&&(r.mode<le||t!==C))&&u(e,e.output,e.next_out,p-e.avail_out)?(r.mode=de,N):(m-=e.avail_in,p-=e.avail_out,e.total_in+=m,e.total_out+=p,r.total+=p,r.wrap&&p&&(e.adler=r.check=r.flags?b(r.check,a,p,e.next_out-p):y(r.check,a,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(r.mode===K?128:0)+(r.mode===te||r.mode===Y?256:0),(0===m&&0===p||t===C)&&ke===S&&(ke=P),ke)}function f(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,S}function m(e,t){var r;return e&&e.state?(r=e.state,0===(2&r.wrap)?B:(r.head=t,t.done=!1,S)):B}var p,g,v=e("../utils/common"),y=e("./adler32"),b=e("./crc32"),w=e("./inffast"),_=e("./inftrees"),x=0,k=1,E=2,C=4,R=5,z=6,S=0,A=1,M=2,B=-2,T=-3,N=-4,P=-5,j=8,D=1,O=2,L=3,H=4,I=5,F=6,$=7,U=8,q=9,G=10,V=11,K=12,Z=13,W=14,Y=15,X=16,J=17,Q=18,ee=19,te=20,re=21,ie=22,ne=23,ae=24,oe=25,se=26,le=27,ce=28,he=29,ue=30,de=31,fe=32,me=852,pe=592,ge=15,ve=ge,ye=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=a,r.inflateInit=c,r.inflateInit2=l,r.inflate=d,r.inflateEnd=f,r.inflateGetHeader=m,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),i=15,n=852,a=592,o=0,s=1,l=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,f,m,p,g,v,y){var b,w,_,x,k,E,C,R,z,S=y.bits,A=0,M=0,B=0,T=0,N=0,P=0,j=0,D=0,O=0,L=0,H=null,I=0,F=new r.Buf16(i+1),$=new r.Buf16(i+1),U=null,q=0;for(A=0;i>=A;A++)F[A]=0;for(M=0;m>M;M++)F[t[f+M]]++;for(N=S,T=i;T>=1&&0===F[T];T--);if(N>T&&(N=T),0===T)return p[g++]=20971520,p[g++]=20971520,y.bits=1,0;for(B=1;T>B&&0===F[B];B++);for(B>N&&(N=B),D=1,A=1;i>=A;A++)if(D<<=1,D-=F[A],0>D)return-1;if(D>0&&(e===o||1!==T))return-1;for($[1]=0,A=1;i>A;A++)$[A+1]=$[A]+F[A];for(M=0;m>M;M++)0!==t[f+M]&&(v[$[t[f+M]]++]=M);if(e===o?(H=U=v,E=19):e===s?(H=c,I-=257,U=h,q-=257,E=256):(H=u,U=d,E=-1),L=0,M=0,A=B,k=g,P=N,j=0,_=-1,O=1<<N,x=O-1,e===s&&O>n||e===l&&O>a)return 1;for(var G=0;;){G++,C=A-j,v[M]<E?(R=0,z=v[M]):v[M]>E?(R=U[q+v[M]],z=H[I+v[M]]):(R=96,z=0),b=1<<A-j,w=1<<P,B=w;do w-=b,p[k+(L>>j)+w]=C<<24|R<<16|z|0;while(0!==w);for(b=1<<A-1;L&b;)b>>=1;if(0!==b?(L&=b-1,L+=b):L=0,M++,0===--F[A]){if(A===T)break;A=t[f+v[M]]}if(A>N&&(L&x)!==_){for(0===j&&(j=N),k+=B,P=A-j,D=1<<P;T>P+j&&(D-=F[P+j],!(0>=D));)P++,D<<=1;if(O+=1<<P,e===s&&O>n||e===l&&O>a)return 1;_=L&x,p[_]=N<<24|P<<16|k-g|0}}return 0!==L&&(p[k+L]=A-j<<24|64<<16|0),y.bits=N,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function i(e){for(var t=e.length;--t>=0;)e[t]=0}function n(e){return 256>e?oe[e]:oe[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,r){e.bi_valid>K-r?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>K-e.bi_valid,e.bi_valid+=r-K):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function s(e,t,r){o(e,r[2*t],r[2*t+1])}function l(e,t){var r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1}function c(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function h(e,t){var r,i,n,a,o,s,l=t.dyn_tree,c=t.max_code,h=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,m=t.stat_desc.max_length,p=0;for(a=0;V>=a;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;G>r;r++)i=e.heap[r],a=l[2*l[2*i+1]+1]+1,a>m&&(a=m,p++),l[2*i+1]=a,i>c||(e.bl_count[a]++,o=0,i>=f&&(o=d[i-f]),s=l[2*i],e.opt_len+=s*(a+o),u&&(e.static_len+=s*(h[2*i+1]+o)));if(0!==p){do{for(a=m-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[m]--,p-=2}while(p>0);for(a=m;0!==a;a--)for(i=e.bl_count[a];0!==i;)n=e.heap[--r],n>c||(l[2*n+1]!==a&&(e.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),i--)}}function u(e,t,r){var i,n,a=new Array(V+1),o=0;for(i=1;V>=i;i++)a[i]=o=o+r[i-1]<<1;for(n=0;t>=n;n++){var s=e[2*n+1];0!==s&&(e[2*n]=l(a[s]++,s))}}function d(){var e,t,r,i,n,a=new Array(V+1);for(r=0,i=0;I-1>i;i++)for(le[i]=r,e=0;e<1<<Q[i];e++)se[r++]=i;for(se[r-1]=i,n=0,i=0;16>i;i++)for(ce[i]=n,e=0;e<1<<ee[i];e++)oe[n++]=i;for(n>>=7;U>i;i++)for(ce[i]=n<<7,e=0;e<1<<ee[i]-7;e++)oe[256+n++]=i;for(t=0;V>=t;t++)a[t]=0;for(e=0;143>=e;)ne[2*e+1]=8,e++,a[8]++;for(;255>=e;)ne[2*e+1]=9,e++,a[9]++;for(;279>=e;)ne[2*e+1]=7,e++,a[7]++;for(;287>=e;)ne[2*e+1]=8,e++,a[8]++;for(u(ne,$+1,a),e=0;U>e;e++)ae[2*e+1]=5,ae[2*e]=l(e,5);he=new fe(ne,Q,F+1,$,V),ue=new fe(ae,ee,0,U,V),de=new fe(new Array(0),te,0,q,Z)}function f(e){var t;for(t=0;$>t;t++)e.dyn_ltree[2*t]=0;for(t=0;U>t;t++)e.dyn_dtree[2*t]=0;for(t=0;q>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*W]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function m(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function p(e,t,r,i){m(e),i&&(a(e,r),a(e,~r)),M.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function g(e,t,r,i){var n=2*t,a=2*r;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]}function v(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&g(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!g(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function y(e,t,r){var i,a,l,c,h=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*h]<<8|e.pending_buf[e.d_buf+2*h+1],a=e.pending_buf[e.l_buf+h],h++,0===i?s(e,a,t):(l=se[a],s(e,l+F+1,t),c=Q[l],0!==c&&(a-=le[l],o(e,a,c)),i--,l=n(i),s(e,l,r),c=ee[l],0!==c&&(i-=ce[l],o(e,i,c)));while(h<e.last_lit);s(e,W,t)}function b(e,t){var r,i,n,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=G,r=0;l>r;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)n=e.heap[++e.heap_len]=2>c?++c:0,a[2*n]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=o[2*n+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)v(e,a,r);n=l;do r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],v(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,a[2*n]=a[2*r]+a[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,a[2*r+1]=a[2*i+1]=n,e.heap[1]=n++,v(e,a,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],h(e,t),u(a,c,e.bl_count)}function w(e,t,r){var i,n,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,i=0;r>=i;i++)n=o,o=t[2*(i+1)+1],++s<l&&n===o||(c>s?e.bl_tree[2*n]+=s:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*Y]++):10>=s?e.bl_tree[2*X]++:e.bl_tree[2*J]++,s=0,a=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4))}function _(e,t,r){var i,n,a=-1,l=t[1],c=0,h=7,u=4;for(0===l&&(h=138,u=3),i=0;r>=i;i++)if(n=l,l=t[2*(i+1)+1],!(++c<h&&n===l)){if(u>c){do s(e,n,e.bl_tree);while(0!==--c)}else 0!==n?(n!==a&&(s(e,n,e.bl_tree),c--),s(e,Y,e.bl_tree),o(e,c-3,2)):10>=c?(s(e,X,e.bl_tree),o(e,c-3,3)):(s(e,J,e.bl_tree),o(e,c-11,7));c=0,a=n,0===l?(h=138,u=3):n===l?(h=6,u=3):(h=7,u=4)}}function x(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),b(e,e.bl_desc),t=q-1;t>=3&&0===e.bl_tree[2*re[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function k(e,t,r,i){var n;for(o(e,t-257,5),o(e,r-1,5),o(e,i-4,4),n=0;i>n;n++)o(e,e.bl_tree[2*re[n]+1],3);_(e,e.dyn_ltree,t-1),_(e,e.dyn_dtree,r-1)}function E(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return T;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return N;for(t=32;F>t;t++)if(0!==e.dyn_ltree[2*t])return N;return T}function C(e){pe||(d(),pe=!0),e.l_desc=new me(e.dyn_ltree,he),e.d_desc=new me(e.dyn_dtree,ue),e.bl_desc=new me(e.bl_tree,de),e.bi_buf=0,e.bi_valid=0,f(e)}function R(e,t,r,i){o(e,(j<<1)+(i?1:0),3),p(e,t,r,!0)}function z(e){o(e,D<<1,3),s(e,W,ne),c(e)}function S(e,t,r,i){var n,a,s=0;e.level>0?(e.strm.data_type===P&&(e.strm.data_type=E(e)),b(e,e.l_desc),b(e,e.d_desc),s=x(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,n>=a&&(n=a)):n=a=r+5,n>=r+4&&-1!==t?R(e,t,r,i):e.strategy===B||a===n?(o(e,(D<<1)+(i?1:0),3),y(e,ne,ae)):(o(e,(O<<1)+(i?1:0),3),k(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),y(e,e.dyn_ltree,e.dyn_dtree)),f(e),i&&m(e)}function A(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(se[r]+F+1)]++,e.dyn_dtree[2*n(t)]++),e.last_lit===e.lit_bufsize-1}var M=e("../utils/common"),B=4,T=0,N=1,P=2,j=0,D=1,O=2,L=3,H=258,I=29,F=256,$=F+1+I,U=30,q=19,G=2*$+1,V=15,K=16,Z=7,W=256,Y=16,X=17,J=18,Q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ee=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ie=512,ne=new Array(2*($+2));i(ne);var ae=new Array(2*U);i(ae);var oe=new Array(ie);i(oe);var se=new Array(H-L+1);i(se);var le=new Array(I);i(le);var ce=new Array(U);i(ce);var he,ue,de,fe=function(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length},me=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},pe=!1;r._tr_init=C,r._tr_stored_block=R,r._tr_flush_block=S,r._tr_tally=A,r._tr_align=z},{"../utils/common":27}],39:[function(e,t){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}]},{},[9])(9)}),define("io/loader/tcmLoader",["require","../util/object2three","../util/jszip"],function(require){function e(e,t){function r(){if(null==e.ui)setTimeout(r,10);else e.ui.refs.containerright.refs.verticallist.refs.lightBox.setState({light:e.light.children})}e.light.removeAll();for(var i=0;i<t.length;i++){var n=o.light(t[i]);e.light.add(n)}r()}function t(e,t){var r=e.stage.$2d,i=e.stage.$3d,n=e.stage.cameraController;n.param.cameraAngleA=t.a,n.param.cameraAngleB=t.b,n.updateCameraPosition(),r.param.scale=t.s,r.param.cameraLookAt={x:t.o[0],y:t.o[1]},i.param.cameraRadius=t.r,i.param.cameraAngleA=t.a,i.param.cameraAngleB=t.b,i.param.cameraLookAt={x:t.l[0],y:t.l[1],z:t.l[2]},i.updateCameraPosition()}function r(e,t){function r(){if(null==e.ui)return void setTimeout(r,10);if(e.ui.refs.containerright.refs.verticallist.refs.meshBox.setState({meshes:e.stage.$3d.children}),"$3d"!==e.stage.type)e.stage.$2d.loadMesh(),e.stage.$2d.renderMesh()}e.stage.removeAll();for(var i=0;i<t.length;i++){var n=o.mesh(t[i],e);if(null!=n)e.stage.add(n)}r()}function i(e,t,r){function n(){a.fs.write(s,{},function(n){var s=n.target,l=new Blob([e.files[o].asArrayBuffer()]);s.onwriteend=function(n){i.apply(a,[e,t,r])},s.onerror=function(n){i.apply(a,[e,t,r])},s.write(l)})}if(0===t.length)return void r();var a=this,o=t.pop(),s="/"+window.editorKey+"/"+o;a.fs.md("/"+window.editorKey+"/.texture",n)}function n(i){var n=this;if(i.hasOwnProperty("lights")&&i.lights instanceof Array&&i.lights.length>0)e(n,i.lights);if(i.hasOwnProperty("camera"))t(n,i.camera);if(i.hasOwnProperty("groups")&&i.groups instanceof Array)n.ui.refs.containerright.refs.verticallist.refs.meshBox.setState({group:i.groups});if(i.hasOwnProperty("meshes")&&i.meshes instanceof Array&&i.meshes.length>0)r(n,i.meshes)}function a(e,t){function r(){var e=JSON.parse(o.files[".content"].asText());n.apply(a,[e])}var a=this;try{var o=new s(e);if(!o.files[".content"])return void t(!1);var l=[];for(var c in o.files)if(0===c.indexOf(".texture/"))l.push(c);else;i.apply(a,[o,l,r]),t(!0)}catch(h){t(!1)}}var o=require("../util/object2three"),s=require("../util/jszip");return a}),define("io/exporter/confExporter",["require","config/editorDefaultConf"],function(require){function e(){var e=t;return e.grid={size:this.stage.$3d.param.gridSize,visible:this.stage.$3d.param.showGrid},e.controlBar=this.ui.refs.containerleft.refs.controlbar.state,e}var t=require("config/editorDefaultConf");return e}),define("io/util/three2object",["require"],function(require){function e(e){var t={image:e.image?e.image.path||e.uuid:e.uuid,mapping:e.mapping,repeat:[e.repeat.x,e.repeat.y],offset:[e.offset.x,e.offset.y],wrap:[e.wrapS,e.wrapT],minFilter:e.minFilter,magFilter:e.magFilter,anisotropy:e.anisotropy};return t}function t(t){var r={color:t.color.getHex(),emissive:t.emissive.getHex(),opacity:t.opacity,transparent:t.transparent,side:t.side,type:t.type,visible:t.visible,wireframe:t.wireframe};if(t.map)r.map=e(t.map);else r.map=null;return r}function r(e){var t={};t.type=e.type,t.parameters=e.parameters,t.faces=[];for(var r=0;r<e.faces.length;r++){var i=e.faces[r];t.faces.push(i.a),t.faces.push(i.b),t.faces.push(i.c)}t.vertices=[];for(var r=0;r<e.vertices.length;r++){var n=e.vertices[r];t.vertices.push(n.x),t.vertices.push(n.y),t.vertices.push(n.z)}return t}return{mesh:function(e){var i={};i.type=e.type,i.name=e.name,i.birth=e.birth,i.locked=e.locked,i.group=e.group,i.visible=e.visible,i.material=t(e.material),i.material.color=e[window.editorKey].color,i.material.emissive=e[window.editorKey].emissive,i.geometry=r(e.geometry),i.matrix=[];for(var n=0;n<e.matrix.elements.length;n++)i.matrix.push(e.matrix.elements[n]);return i},camera:function(e){return{a:parseInt(e.cameraController.param.cameraAngleA),b:parseInt(e.cameraController.param.cameraAngleB),r:parseInt(e.$3d.param.cameraRadius),l:[parseInt(e.$3d.param.cameraLookAt.x),parseInt(e.$3d.param.cameraLookAt.y),parseInt(e.$3d.param.cameraLookAt.z)],s:e.$2d.param.scale,o:[parseInt(e.$2d.param.cameraLookAt.x),parseInt(e.$2d.param.cameraLookAt.y)]}},light:function(e){var t=e.toJSON().object;return t.birth=e.birth,t.locked=e.locked,t.visible=e.visible,delete t.uuid,t}}}),define("io/util/compressor",["require"],function(require){function e(e,t){var r=e.toString().indexOf(".")>-1?parseFloat(e.toFixed(t)):e;if(Math.abs(r)<.001)r=0;return r}function t(r,i){for(var n in r)if("string"!=typeof r[n])if(!(r[n]instanceof Array))if(isNaN(r[n])||"number"!=typeof r[n])if("object"!=typeof r[n]);else t(r[n],i);else r[n]=e(r[n],i);else for(var a=r[n],o=0;o<a.length;o++)if(!isNaN(a[o])&&"number"==typeof a[o])a[o]=e(a[o],i);else;else;}return t}),define("io/exporter/tcmExporter",["require","../util/jszip","../util/three2object","../util/compressor"],function(require){function e(e){function n(){if(0===s.length)return o.file(".content",JSON.stringify(l)),void e(o.generate({type:"blob"}));var t=s.pop(),r=t.split("/").pop();a.fs.read(t,function(e){if(e instanceof FileError)return void n();else return o.file(".texture/"+r,e.target.result),void n()},{type:"readAsArrayBuffer"})}var a=this,o=new t,s=[],l={};l.meshes=[],l.lights=[],l.groups=[],l.camera=r.camera(a.stage),l.groups=JSON.stringify(a.ui.refs.containerright.refs.verticallist.refs.meshBox.state.group),l.groups=JSON.parse(l.groups);for(var c=0;c<l.groups.length;c++)delete l.groups[c].children;for(var h in a.stage.$3d.children){var u=a.stage.$3d.children[h],d=r.mesh(u);if(i(d,2),l.meshes.push(d),u.material.map&&u.material.map.image&&u.material.map.image.path)s.push(u.material.map.image.path)}for(var h in a.light.children){var f=r.light(a.light.children[h]);i(f,2),l.lights.push(f)}n()}var t=require("../util/jszip"),r=require("../util/three2object"),i=require("../util/compressor");return e}),define("component/explorer.jsx",["require"],function(require){function e(e){for(var t=0,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];e>1024;)e/=1024,t++;return e.toFixed(0===t?0:2)+r[t]}var t=0;return React.createClass({getDefaultProps:function(){return{button1:"Open",button2:"Cancel"}},getInitialState:function(){return{selected:"",files:[],sorter:0,desc:0}},componentDidMount:function(){this.listFiles()},listFiles:function(){function e(e){function i(a){if(a===e.length){if(n.sort(t),r.state.desc)n.reverse();return void r.setState({files:n,selected:""})}var o=e[a];if(0===o.name.indexOf(window.editorKey))return void i(a+1);var s={name:o.name,isFile:o.isFile,path:o.fullPath};o.getMetadata(function(e){s.mtime=e.modificationTime,s.size=e.size,n.push(s),i(a+1)})}var n=[];i(0,r)}function t(e,t){var i={0:function(e,t){return e.name.localeCompare(t.name)},1:function(e,t){return e.size<t.size},2:function(e,t){return e.mtime.getTime()-t.mtime.getTime()}};if(e.isFile&&!t.isFile)return 1;if(!e.isFile&&t.isFile)return-1;else return i[r.state.sorter+""](e,t)}var r=this;this.props.fs.dir(e)},removeMakeInputDom:function(){var e=this.refs.filelist.getDOMNode();try{for(var r=e.getElementsByTagName("input"),i=0;i<r.length;i++)e.removeChild(r[i])}catch(n){}e.scrollTop=t,this.listFiles()},itemClickHandler:function(e){var t=e.target;if("deleteClickHandler"!==t.title){for(var r=t.dataset.path;!r&&t!=document.body;)t=t.parentNode,r=t.dataset.path;if("true"===t.dataset.isFile){var i=r.split("/").pop();if(i===this.state.selected)return void this.enterClickHandler();this.setState({selected:i})}else{var n=this;this.props.fs.cd(r,function(){n.listFiles()})}}},upClickHandler:function(){var e=this.props.fs.getWorkingDirectory().fullPath.split("/");e.pop();var t=e.join("/");if(!(t.indexOf(window.editorKey)<0)){var r=this;this.props.fs.cd(t,function(){r.listFiles()})}},sortListHandler:function(e){var t=~~e.target.sorter,r=this.state.desc;if(t===this.state.sorter)this.setState({desc:!r});else this.setState({sorter:t,desc:0});this.listFiles()},makeClickHandler:function(){var e=this.refs.filelist.getDOMNode();t=e.scrollTop,e.scrollTop=e.scrollHeight;var r=document.createElement("input");r.type="text",e.appendChild(r),r.focus()},makeInputKeyUpHandler:function(e){if(13===e.keyCode){var t=this;return void t.props.fs.md(e.target.value,function(){t.removeMakeInputDom()})}if(27===e.keyCode)return void this.removeMakeInputDom();else return void 0},deleteClickHandler:function(e){function t(){r.listFiles()}var r=this;if("true"===e.target.dataset.isFile)this.props.fs.del(e.target.dataset.path,t);else this.props.fs.deltree(e.target.dataset.path,t)},enterClickHandler:function(e){if(""!==this.state.selected){var t=this.props.fs.getWorkingDirectory().fullPath+"/"+this.state.selected;if("string"==typeof this.props.filetype&&this.props.filetype.length>0&&t.split(".").pop()!==this.props.filetype)t=t+"."+this.props.filetype;for(var r=!1,i=0;i<this.state.files.length;i++)if(this.state.files[i].path===t){r=!0;break}if("save"!==this.props.mode||!r||window.confirm("The file already exists, overwrite it?")){if("save"!==this.props.mode&&!r)return void alert("File does not exist!");if("function"==typeof this.props.onEnter)this.props.onEnter(t)}}},closeClickHandler:function(){if("function"==typeof this.props.onCancel)this.props.onCancel()},inputChangeHandler:function(e){this.setState({selected:e.target.value})},inputKeyUpHandler:function(e){if(13===e.keyCode&&"save"===this.props.mode)this.enterClickHandler()},render:function(){function t(t){var i={className:t.isFile?"iconfont icon-wenjian":"iconfont icon-wenjianjia"},n={"data-path":t.path,"data-is-file":t.isFile,title:"deleteClickHandler",className:"iconfont icon-shanchu",onClick:r.deleteClickHandler},a={"data-path":t.path,"data-is-file":t.isFile,className:"tr",onClick:r.itemClickHandler};return React.createElement("div",React.__spread({},a),React.createElement("div",React.__spread({},n)),React.createElement("div",null,React.createElement("div",React.__spread({},i)),t.name),React.createElement("div",null,t.isFile?e(t.size):"--"),React.createElement("div",null,t.mtime.format("YYYY/MM/DD hh:mm:ss")))}var r=this,i={className:"filelist",ref:"filelist",onKeyUp:this.makeInputKeyUpHandler,onBlur:this.removeMakeInputDom};return React.createElement("div",{className:"explorer"},React.createElement("div",{className:"iconfont icon-xinjianwenjianjia",onClick:this.makeClickHandler}),React.createElement("div",{className:"iconfont icon-wodedingdan35",onClick:this.upClickHandler}),React.createElement("div",{className:"address-bar"},this.props.fs.getWorkingDirectory().fullPath.replace("/"+window.editorKey,"")+"/"),React.createElement("div",{className:"th"},React.createElement("div",{"data-sorter":"0",onClick:this.sortListHandler},"name"),React.createElement("div",{"data-sorter":"1",onClick:this.sortListHandler},"size"),React.createElement("div",{"data-sorter":"2",onClick:this.sortListHandler},"modify time")),React.createElement("div",React.__spread({},i),this.state.files.map(t)),React.createElement("div",{className:"foot-bar"},React.createElement("div",{className:"button",onClick:this.closeClickHandler},this.props.button2),React.createElement("div",{className:"button",onClick:this.enterClickHandler},this.props.button1),"file name:",React.createElement("input",{type:"text",value:this.state.selected,ref:"inputbox",onKeyUp:this.inputKeyUpHandler,onChange:this.inputChangeHandler})))}})}),define("ui/component/explorer.jsx",["component/explorer.jsx"],function(e){return e}),define("io/main",["require","widget/dialog.jsx","./util/FileSaver","./loader/confLoader","./loader/tcmLoader","./exporter/confExporter","./exporter/tcmExporter","component/explorer.jsx"],function(require){function e(e){this.routing=e.routing}var t=require("widget/dialog.jsx"),r=require("./util/FileSaver"),i={conf:require("./loader/confLoader"),tcm:require("./loader/tcmLoader")},n={conf:require("./exporter/confExporter"),tcm:require("./exporter/tcmExporter")};return e.prototype.readFile=function(e,t){var r=["readAsBinaryString","readAsText","readAsDataURL","readAsArrayBuffer"],i=this.routing.fs;return t=r.indexOf(t)<0?"readAsText":t,new Promise(function(r,n){function a(e){e instanceof FileError?n():r(e.target.result)}i.read(e,a,{type:t})})},e.prototype.writeFile=function(e,t){var r=this.routing.fs;return new Promise(function(i,n){r.write(e,{data:t},function(e){e instanceof FileError?n():i()})})},e.prototype.callLoader=function(e,t){var r=this.routing;return new Promise(function(n,a){function o(e){!e?a("fail to parse."):n()}if(i.hasOwnProperty(e)&&"function"==typeof i[e])i[e].apply(r,[t,o]);else a("Unable to parse "+e.toUpperCase()+" file.")})},e.prototype.callExporter=function(e){var t=this.routing;return new Promise(function(r,i){function a(e){!e?i():r(e)}if(n.hasOwnProperty(e)&&"function"==typeof n[e]){var o=n[e].apply(t,[a]);o&&r(o)}else i()})},e.prototype.upload=function(){var e=this.routing.ui.refs.importdoor.getDOMNode();return new Promise(function(t,r){e.onchange=function(e){var i=e.target.files[0],n=new FileReader;n.onload=function(){e.target.onchange=null,e.target.value="",t({name:i.name,blob:this.result})},n.onerror=function(e){r(e)},n.readAsArrayBuffer(i)},e.click()})},e.prototype.download=function(e,t){return r(e,t),new Promise(function(e,t){e()})},e.prototype.openExplorer=function(e,r){var i="|backspace|enter|esc|",n=this.routing;return new Promise(function(a,o){var s=null,l=function(e){n.keyboard.removeListener(i),s.close(),"string"==typeof e?a(e):o(!0)};s=new t,n.keyboard.addListener(i,function(e){switch(e){case"backspace":s.ui.content.upClickHandler();break;case"enter":s.ui.content.enterClickHandler();break;case"esc":l()}}),s.pop({title:e,focus:"inputbox",content:require("component/explorer.jsx"),onClose:l,contentProps:{fs:n.fs,mode:e.toLowerCase(),button1:e,filetype:r,onEnter:function(e){l(e)},onCancel:function(){l()}}})})},e}),function(e){function t(e,t){e=e||"",t="function"==typeof console[t]?t:"log",console[t](e)}function r(e,t){var r="string"==typeof e?e.split("/"):[],i="string"==typeof t?t.split("/"):[];if(0===i.length)return e;if(""===i[0])r=[];for(var n=0;n<i.length;n++)if("."!==i[n])if(".."!==i[n])r.push(i[n]);else r.pop();else;var a=[];for(n=0;n<r.length;n++)if(""!==r[n])a.push(r[n]);else;return"/"+a.join("/")}function i(e,t){return t="function"==typeof t?t:function(){},e=e||{},function(){t.apply(e,arguments)}}function n(e,t){var n=t.root;e.version=o,e.dir=function(e,a){function o(t){var r=t.createReader();r.readEntries(e,e)}e=i(this,e),t.root.getDirectory(r(n.fullPath,a),{},o,e)},e.cd=function(e,a){function o(e){n=e,a(e)}a=i(this,a),t.root.getDirectory(r(n.fullPath,e),{},o,a)},e.md=function(e,a){a=i(this,a),t.root.getDirectory(r(n.fullPath,e),{create:!0},a,a)},e.rd=function(e,a){function o(e){e.remove(a,a)}a=i(this,a),t.root.getDirectory(r(n.fullPath,e),{},o,a)},e.deltree=function(e,a){function o(e){e.removeRecursively(a,a)}a=i(this,a),t.root.getDirectory(r(n.fullPath,e),{},o,a)},e.create=function(e,a){a=i(this,a),t.root.getFile(r(n.fullPath,e),{create:!0,exclusive:!0},a,a)},e.del=function(e,a){function o(e){e.remove(a,a)}a=i(this,a),t.root.getFile(r(n.fullPath,e),{create:!1},o,a)},e.open=function(e,a){a=i(this,a),t.root.getFile(r(n.fullPath,e),{create:!1},a,a)},e.copy=function(e,a,o){function s(r){function i(e){e.copyTo(r,null,o,o)}function n(){t.root.getDirectory(e,{},i,o)}t.root.getFile(e,{create:!1},i,n)}o=i(this,o),a=r(n.fullPath,a),e=r(n.fullPath,e),t.root.getDirectory(a,{},s,o)},e.move=function(e,a,o){function s(r){function i(e){e.moveTo(r,null,o,o)}function n(){t.root.getDirectory(e,{},i,o)}t.root.getFile(e,{create:!1},i,n)}o=i(this,o),a=r(n.fullPath,a),e=r(n.fullPath,e),t.root.getDirectory(a,{},s,o)},e.ren=function(e,a,o){function s(e){e.getParent(function(t){e.moveTo(t,a,o,o)})}function l(){t.root.getFile(e,{create:!1},s,o)}o=i(this,o),e=r(n.fullPath,e),t.root.getDirectory(e,{},s,l)},e.read=function(e,a,o){function s(e){var t=new FileReader;if(t.onloadend=function(e){a(e)},"function"==typeof t[o.type])t[o.type](e,o.encoding)}function l(e){e.file(s,a)}a=i(this,a),e=r(n.fullPath,e),o=o||{},o.type=o.type||"readAsText",o.encoding=o.encoding||"utf8",t.root.getFile(e,{},l,a)},e.write=function(e,a,o){function s(e){e.createWriter(h)}function l(e){e.remove(c,o)}function c(){t.root.getFile(e,{create:!0},s,o)}function h(e){e.seek(e.length),e.onwriteend=function(e){o(e)},e.write(a.data)}o=i(this,o),e=r(n.fullPath,e),a=a||{},a.data=a.data instanceof Blob?a.data:new Blob([""]),a.append=a.hasOwnProperty("append")?a.append:!1,t.root.getFile(e,{create:!0},a.append?s:l,o)},e.getWorkingDirectory=function(){return n}}function a(e,r){function i(r){n(c,r),t("FileSystem "+c.version),e(c)}function o(){t("Your browser don't support!","warn"),e()}if(!(this instanceof a))return new a(r,e);e="function"==typeof e?e:function(){},r=r||{};var s=~~r.size||104857600,l=window.requestFileSystem||window.webkitRequestFileSystem,c=this;if("function"==typeof l)l(window.TEMPORARY,s,i,o);else o();return this}if("function"==typeof define)define("io/util/filesystem",["require"],function(require){return a});else e.FileSystem=a,e.fs=a;var o="0.0.1"}(window),define("io/keyboard",["require"],function(require){var e={8:"backspace",9:"tab",12:"clear",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageUp",34:"pageDown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",41:"select",42:"print",43:"execute",45:"insert",46:"delete",47:"help",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"s0",97:"s1",98:"s2",99:"s3",100:"s4",101:"s5",102:"s6",103:"s7",104:"s8",105:"s9",106:"s*",107:"s+",109:"s-",110:"s.",111:"s/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"f13",125:"f14",126:"f15",127:"f16",128:"f17",129:"f18",130:"f19",131:"f20",132:"f21",133:"f22",134:"f23",135:"f24",144:"numLock",145:"scrollLock",186:";",187:"=",188:"<",189:"-",190:">",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t=["ctrl+s","ctrl+o","ctrl+f5","f5","f1"],r=["backspace"],i={"ctrl+o":"pop-open","ctrl+s":"pop-save","ctrl+shift+s":"pop-saveas",1:"view-3d",2:"view-xoz",3:"view-xoy",4:"view-zoy",d:"mouse-pickgeo",f:"mouse-pickjoint",l:"mouse-picklight",w:"mouse-cameramove",e:"trans-move",r:"trans-rotate",t:"trans-scale","=":"trans-enlarge","-":"trans-narrow",g:"trans-coordinatetoggle",esc:"tool-detach"},n={};return{translate:function(t){var r=e.hasOwnProperty(t.keyCode)?e[t.keyCode]:"unknow";if(t.shiftKey)r="shift+"+r;if(t.altKey)r="alt+"+r;if(t.ctrlKey)r="ctrl+"+r;return r},preventDefault:function(e){var i=this.translate(e);if(t.indexOf(i)>-1)return!0;else return r.indexOf(i)>-1&&"BODY"===e.target.tagName},key2cmd:function(e){return i[e]},addListener:function(e,t){n[e]=t},removeListener:function(e){delete n[e]},depatch:function(e){
var t=!1;for(var r in n)if(r.indexOf("|"+e+"|")>-1&&"function"==typeof n[r])n[r](e),t=!0;return t}}}),define("main",["require","./extend","./application.jsx","./stage/main","./command/main","./transformer/main","./morpher/main","./light/main","./io/main","./io/util/filesystem","./io/keyboard","config"],function(require){function e(){console.log("Your browser does not support TcEditor.")}function t(){return new Promise(function(e,t){v.filePath=null,v.imgCache={},v.keyboard=g,v.io=new m({routing:v}),v.fs=new p(function(r){r?e():t()})})}function r(){return new Promise(function(e,t){v.fs.md(window.editorKey,function(r){r instanceof FileError?t():e()})}).then(function(){return new Promise(function(e,t){v.fs.cd(window.editorKey,function(r){r instanceof FileError?t():e()})})},e)}function i(){var e=React.createElement(l,{commandRouting:function(){v.main.apply(v,arguments)}});return new Promise(function(t,r){try{v.ui=React.render(e,document.body,t)}catch(i){r()}})}function n(){return new Promise(function(e,t){var r=v.ui.refs.containerleft.refs.stage.refs;v.ui.refs.containerleft.refs.stage.getDOMNode();v.stage=new c({container1:r.cameracontroller.getDOMNode(),container2:r.stage2d.getDOMNode(),container3:r.stage3d.getDOMNode()}),v.transformer=new u(v.stage),v.morpher=new d(v.stage),v.light=new f({stage:v.stage,ui:v.ui}),e()})}function a(){function e(e){var t=y.editorDefaultConf;try{t=JSON.parse(e)}catch(r){}return v.io.callLoader("conf",t)}function t(){return v.io.callLoader("conf",y.editorDefaultConf)}return v.io.readFile("/"+window.editorKey+"/"+window.editorKey+"conf").then(e,t)}function o(){function e(e){return{clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX+e.target.parentNode.offsetLeft,offsetY:e.offsetY+e.target.parentNode.offsetTop,target:e.target,button:e.button}}return new Promise(function(t,r){var i=v.ui.refs.containerleft,n=v.ui.refs.containerleft.refs.stage.getDOMNode();v.transformer.onChange=function(e){i.refs.stage.setState({activeMesh:e})},v.morpher.onChange=function(e){i.refs.stage.setState({activeJoint:e})},n.addEventListener("mousedown",function(t){v.mousedown(e(t))}),n.addEventListener("mouseup",function(t){v.mouseup(e(t))}),n.addEventListener("mouseleave",function(t){v.mouseleave(e(t))}),n.addEventListener("mousemove",function(t){v.mousemove(e(t))}),n.oncontextmenu=function(e){return v.mouseRightClick(e),!1},n.onmousewheel=function(e){return v.stage.zoom(e),e.stopPropagation(),!1},window.onresize=function(){if(null!=v.stage)v.stage.resize()},document.onkeydown=function(e){if(g.preventDefault(e))e.preventDefault()},document.onkeyup=function(e){if("BODY"===e.target.tagName){var t=g.translate(e);if(!g.depatch(t)){var r=g.key2cmd(t);if(void 0!==r)return void v.main(r);else return void 0}}},t()})}function s(){return new Promise(function(e,t){function r(){if(null==v.ui)return void setTimeout(r,10);else return v.ui.refs.containerright.refs.verticallist.refs.lightBox.setState({light:v.light.children}),void e()}r()})}require("./extend");var l=require("./application.jsx"),c=require("./stage/main"),h=require("./command/main"),u=require("./transformer/main"),d=require("./morpher/main"),f=require("./light/main"),m=require("./io/main"),p=require("./io/util/filesystem"),g=require("./io/keyboard"),v=new h("mouse-cameramove"),y=require("config");t().then(r,e).then(i,e).then(n,e).then(a,e).then(o,e).then(s,e)});