var TCeditor=TCeditor||{};
TCeditor.geometry=function(w){function v(c){var d=500,d=d=500,d=c[0]-5,f=c[1]+5,n=c[3]+5,s=c[2]-5,g=c[5]+5,c=c[4]-5,l=THREE.SceneUtils.createMultiMaterialObject(new THREE.CubeGeometry(f-d,n-s,g-c,1,1,1),[new THREE.MeshBasicMaterial({color:16776960,wireframe:!0,transparent:!0,opacity:1})]);l.position.x=0.5*(f+d);l.position.y=0.5*(n+s);l.position.z=0.5*(g+c);return l}function f(c,d,f,n,s,g){function l(c,d){F=function(c,d){return c.apply(this,d)};F.prototype=c.prototype;return new F(c,d)}var e="",e=
[],h=[],h={PlaneGeometry:"g1",g1:"PlaneGeometry",CubeGeometry:"g2",g2:"CubeGeometry",SphereGeometry:"g3",g3:"SphereGeometry",IcosahedronGeometry:"g4",g4:"IcosahedronGeometry",CylinderGeometry:"g5",g5:"CylinderGeometry",TorusGeometry:"g6",g6:"TorusGeometry",TextGeometry:"g7",g7:"TextGeometry",LatheGeometry:"g8",g8:"LatheGeometry",shapesGeometry:"g9",g9:"shapesGeometry",tubeGeometry:"g10",g10:"tubeGeometry",surfaceGeometry:"g11",g11:"surfaceGeometry"};c.type&&(c={t:c.type,a:c.args});-1<c.t.indexOf("Geometry")?
(e=c.t,c.t=h[c.t]):e=h[c.t];"CylinderGeometry"==e&&0==c.a[0]&&(c.a[0]=1);h=[];"tubeGeometry"==e||"surfaceGeometry"==e?h.push(new THREE.MeshLambertMaterial({color:16777215})):(h.push(new THREE.MeshLambertMaterial({color:16777215})),h.push(new THREE.MeshBasicMaterial({color:0,wireframe:!0,opacity:1})));h=d||h;if("shapesGeometry"==e){for(var q={amount:c.a[1],bevelEnabled:!1,bevelSegments:1,steps:1,bevelThickness:1,material:0,extrudeMaterial:1},m=[],i=c.a[0],k=[],d=0;d<i.length;d++){e=!1;if(0<k.length)for(var o=
0;o<k.length;o++)if(k[o].x==i[d][0]&&k[o].y==i[d][1]){e=!0;break}e||(k.push({x:i[d][0],y:i[d][1]}),m.push(new THREE.Vector2(i[d][0],i[d][1])))}k=new THREE.Object3D;m=new THREE.Shape(m);for(d=0;d<h.length;d++){var j=m.extrude(q),e=h[d];j.materials=[e,e];THREE.GeometryUtils.center(j);i=new THREE.Mesh(j,new THREE.MeshFaceMaterial);e=j.vertices;k.add(i)}e=j.vertices}else if("surfaceGeometry"==e)tube=new THREE.ParametricGeometry(p(c.a),parseInt(c.a.s),parseInt(c.a.s),1),k=THREE.SceneUtils.createMultiMaterialObject(tube,
h),k.children[0].doubleSided=!0,e=tube.vertices;else{k=new THREE.SubdivisionModifier(f);j=null;if("IcosahedronGeometry"==e)j=new THREE.IcosahedronGeometry(c.a[0],c.a[1]);else if("LatheGeometry"==e){m=[];i=c.a[0];for(d=0;d<i.length;d++)m.push(new THREE.Vector3(0,i[d][1],i[d][0]));j=new THREE.LatheGeometry(m,c.a[1],c.a[2]);j.doubleSided=!0}else if("tubeGeometry"==e){j=parseInt(c.a[1])||200;q=parseInt(c.a[3])||5;m=parseInt(c.a[2])||20;i=parseInt(c.a[4]);o=[];for(d=0;d<c.a[0].length;d++)o.push(new THREE.Vector3(c.a[0][d][0],
c.a[0][d][1],c.a[0][d][2]));d=new THREE.SplineCurve3(o);j=new THREE.TubeGeometry(d,j,q,m,i,!1)}else j=l(THREE[e],c.a);d=THREE.GeometryUtils.clone(j);d.mergeVertices();k.modify(d);k=THREE.SceneUtils.createMultiMaterialObject(d,h);if("PlaneGeometry"==e)for(d=0;d<k.children.length;d++)k.children[d].doubleSided=!0;e=j.vertices}h=99999;j=-99999;q=-9999;m=9999;i=-9999;o=9999;for(d=0;d<e.length;d++){if(e[d].x<h)h=e[d].x;if(e[d].x>j)j=e[d].x;if(e[d].y>q)q=e[d].y;if(e[d].y<m)m=e[d].y;if(e[d].z>i)i=e[d].z;
if(e[d].z<o)o=e[d].z}h=[h,j,m,q,o,i];d=new THREE.Object3D;d.add(k);d.position=n;d.rotation=s;d.iscontainer=!0;d.debug=v(h);d.id=(new Date).getTime();d.params=c;d.corner=f;d.materialsStr=g;return d}function p(c){var d=[-3,-2.95,-2.9,-2.85,-2.8,-2.75,-2.7,-2.65,-2.6,-2.55,-2.5,-2.45,-2.4,-2.35,-2.3,-2.25,-2.2,-2.15,-2.1,-2.05,-2,-1.95,-1.9,-1.85,-1.8,-1.75,-1.7,-1.65,-1.6,-1.55,-1.5,-1.45,-1.4,-1.35,-1.3,-1.25,-1.2,-1.15,-1.1,-1.05,-1,-0.95,-0.9,-0.85,-0.8,-0.75,-0.7,-0.65,-0.6,-0.55,-0.5,-0.45,-0.4,
-0.35,-0.3,-0.25,-0.2,-0.15,-0.1,-0.05,-1.02141E-14,0.05,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45,0.5,0.55,0.6,0.65,0.7,0.75,0.8,0.85,0.9,0.95,1,1.05,1.1,1.15,1.2,1.25,1.3,1.35,1.4,1.45,1.5,1.55,1.6,1.65,1.7,1.75,1.8,1.85,1.9,1.95,2,2.05,2.1,2.15,2.2,2.25,2.3,2.35,2.4,2.45,2.5,2.55,2.6,2.65,2.7,2.75,2.8,2.85,2.9,2.95,3],f=[0.004431848,0.005142641,0.005952532,0.006872767,0.007915452,0.009093563,0.010420935,0.011912244,0.013582969,0.015449347,0.0175283,0.019837354,0.02239453,0.02521822,0.028327038,0.031739652,
0.035474593,0.039550042,0.043983596,0.048792019,0.053990967,0.059594706,0.065615815,0.072064874,0.078950158,0.086277319,0.094049077,0.102264925,0.110920835,0.120009001,0.129517596,0.139430566,0.149727466,0.160383327,0.171368592,0.182649085,0.194186055,0.205936269,0.217852177,0.229882141,0.241970725,0.254059056,0.26608525,0.277984886,0.289691553,0.301137432,0.312253933,0.32297236,0.333224603,0.342943855,0.352065327,0.360526962,0.36827014,0.375240347,0.381387815,0.386668117,0.391042694,0.394479331,
0.396952547,0.398443914,0.39894228,0.398443914,0.396952547,0.394479331,0.391042694,0.386668117,0.381387815,0.375240347,0.36827014,0.360526962,0.352065327,0.342943855,0.333224603,0.32297236,0.312253933,0.301137432,0.289691553,0.277984886,0.26608525,0.254059056,0.241970725,0.229882141,0.217852177,0.205936269,0.194186055,0.182649085,0.171368592,0.160383327,0.149727466,0.139430566,0.129517596,0.120009001,0.110920835,0.102264925,0.094049077,0.086277319,0.078950158,0.072064874,0.065615815,0.059594706,0.053990967,
0.048792019,0.043983596,0.039550042,0.035474593,0.031739652,0.028327038,0.02521822,0.02239453,0.019837354,0.0175283,0.015449347,0.013582969,0.011912244,0.010420935,0.009093563,0.007915452,0.006872767,0.005952532,0.005142641,0.004431848],n=function(c){for(var g=0,l=0;l<d.length-1;l++)if(c>=d[l]&&c<=d[l+1]){g=0.5*(f[l]+f[l+1]);break}return g};return function(d,g){var f=0,e=0,h=0;switch(c.t){case "s01":length=parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);arr=c.p;t=g;h0=arr[0][0]*(1-t)*(1-t)*
(1-t)+3*arr[0][1]*t*(1-t)*(1-t)+3*arr[0][2]*t*t*(1-t)+arr[0][3]*t*t*t;h1=arr[1][0]*(1-t)*(1-t)*(1-t)+3*arr[1][1]*t*(1-t)*(1-t)+3*arr[1][2]*t*t*(1-t)+arr[1][3]*t*t*t;h2=arr[2][0]*(1-t)*(1-t)*(1-t)+3*arr[2][1]*t*(1-t)*(1-t)+3*arr[2][2]*t*t*(1-t)+arr[2][3]*t*t*t;h3=arr[3][0]*(1-t)*(1-t)*(1-t)+3*arr[3][1]*t*(1-t)*(1-t)+3*arr[3][2]*t*t*(1-t)+arr[3][3]*t*t*t;t=d;h=height*(h0*(1-t)*(1-t)*(1-t)+3*h1*t*(1-t)*(1-t)+3*h2*t*t*(1-t)+h3*t*t*t);f=length*(g-0.5);e=width*(d-0.5);break;case "s02":length=parseInt(c.l);
width=parseInt(c.w);height=parseInt(c.h);t=parseFloat(c.i);d-=0.5;g-=0.5;f=g*length;e=d*width;h=height*((d*d+g*g)/(-t*t)+1);break;case "s03":r=parseInt(c.r);as=c.a;bs=c.b;a=g*(as[1]-as[0])+as[0];b=d*(bs[1]-bs[0])+bs[0];f=r*Math.cos(a)*Math.cos(b);e=r*Math.cos(a)*Math.sin(b);h=r*Math.sin(a);break;case "s04":length=parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);d-=0.5;g-=0.5;uf=n(Math.sqrt(9*d*d+9*g*g));f=g*length;e=d*width;h=height*uf;break;case "s05":length=parseInt(c.l);width=parseInt(c.w);
height=parseInt(c.h);p0=0;p1=parseFloat(c.p[0]);p2=parseFloat(c.p[1]);p3=parseFloat(c.p[2]);pn=0;t=d;f=(g-0.5)*length;h=height*(p0*(1-t)*(1-t)*(1-t)*(1-t)+4*p1*t*(1-t)*(1-t)*(1-t)+6*p2*t*t*(1-t)*(1-t)+4*p3*t*t*t*(1-t)+pn*t*t*t*t);e=(d-0.5)*width;break;case "s06":length=parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);p1=parseFloat(c.p[0]);p2=parseFloat(c.p[1]);pn=p0=0;t=d;f=(g-0.5)*length;h=height*(p0*(1-t)*(1-t)*(1-t)+3*p1*t*(1-t)*(1-t)+3*p2*t*t*(1-t)+pn*t*t*t);e=(d-0.5)*width;break;case "s07":length=
parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);d-=0.5;g-=0.5;uf=n(3*d);f=g*length;e=d*width;h=height*uf;break;case "s08":length=parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);t=parseFloat(c.i);d-=0.5;f=(g-0.5)*length;e=d*width;h=height*(d*d/(-t*t)+1);break;case "s09":length=parseInt(c.l);width=parseInt(c.w);height=parseInt(c.h);as=c.a;d-=0.5;f=(g-0.5)*length;e=d*width;a=d*(as[1]-as[0])+as[0];h=Math.cos(a)*height;break;case "s10":r=parseInt(c.r),d-=0.5,g-=0.5,cosx=g/Math.sqrt(d*d+g*
g),sinx=d/Math.sqrt(d*d+g*g),0.25<d*d+g*g?(f=0.5*r*cosx,e=0.5*r*sinx):(f=g*r,e=d*r)}return new THREE.Vector3(f,h,e)}}var u=new TCeditor.materials(w);return{produce:function(c,d,p,n,s,g){return f(c,d,p,n,s,g)},createGeo:function(c){a:{var d=null;switch(c.geo){case "planeBtn":d={t:c.type,a:[parseInt(c.args.length),parseInt(c.args.width),parseInt(c.args.lengthcut),parseInt(c.args.widthcut)]};break;case "cubeBtn":d={t:c.type,a:[parseInt(c.args.length),parseInt(c.args.height),parseInt(c.args.width),parseInt(c.args.lengthCut),
parseInt(c.args.widthCut),parseInt(c.args.heightCut)]};break;case "sphereBtn":d={t:c.type,a:[parseInt(c.args.radius),parseInt(c.args.radiusCut),parseInt(c.args.heightCut)]};break;case "icosahedronBtn":d={t:c.type,a:[parseInt(c.args.size),parseInt(c.args.seg)]};break;case "cylinderBtn":d={t:c.type,a:[1,parseInt(c.args.radius),parseInt(c.args.height),parseInt(c.args.radiusCut),parseInt(c.args.heightCut)]};break;case "cylinderCBtn":d={t:c.type,a:[1,parseInt(c.args.radius),parseInt(c.args.height),parseInt(c.args.radiusCut),
parseInt(c.args.heightCut)]};break;case "cylinderBBtn":d={t:c.type,a:[parseInt(c.args.radius),parseInt(c.args.radius),parseInt(c.args.height),parseInt(c.args.radiusCut),parseInt(c.args.heightCut)]};break;case "cylinderDBtn":d={t:c.type,a:[parseInt(c.args.radius),parseInt(c.args.radius),parseInt(c.args.height),parseInt(c.args.radiusCut),parseInt(c.args.heightCut)]};break;case "torusBtn":d={t:c.type,a:[parseInt(c.args.radius),parseInt(c.args.thick),parseInt(c.args.radiusCut),parseInt(c.args.thickCut),
Math.PI*parseInt(c.args.rot)/180]};break;case "cylinderEBtn":d={t:c.type,a:[parseInt(c.args.topRadius),parseInt(c.args.bottomRadius),parseInt(c.args.height),parseInt(c.args.radiusCut),parseInt(c.args.heightCut)]};break;case "textBtn":if(""==c.args.text)c.args.text="tctctc.com";d={t:c.type,a:[c.args.text,{size:parseInt(c.args.size),height:parseInt(c.args.deep),curveSegments:parseInt(c.args.cut)}]};break;case "latheBtn":d={t:c.type,a:[c.args.points,c.args.cut,c.args.rot]};break;case "shapesBtn":d={t:c.type,
a:[c.args.points,c.args.height]};break;case "tubeBtn":d={t:c.type,a:[c.args.points,c.args.segments,c.args.radseg,c.args.radius,c.args.closed]};break;case "surfaceBtn":d={t:c.type,a:c.args};break;default:alert("error:geometry.js>>function _createGeo():"+c.geo);c=void 0;break a}var p=null;0<c.materialStr.length&&(p=u.makeMultiMaterial(c.materialStr));var n=parseInt(c.corner),c=f(d,p,n,c.position,c.rotation,c.materialStr)}return c}}};TCeditor=TCeditor||{};
TCeditor.materials=function(w){var v=function(f){if("M5"==f)return new THREE.MeshBasicMaterial({envMap:w.renderTarget});if(0==f.indexOf("M4"))return tmp=f.split(":"),color="0x"+tmp[3],specular="0x"+tmp[4],metal=!1,"true"==tmp[6]&&(metal=!0),new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(tmp[1]),opacity:parseFloat(tmp[2]),color:parseInt(color),specular:parseInt(specular),shininess:parseInt(tmp[5]),metal:metal});if(0==f.indexOf("M3"))return tmp=f.split(":"),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(tmp[1]),opacity:parseFloat(tmp[2])});
if(0==f.indexOf("M2"))return tmp=f.split("_"),3>tmp.length&&tmp.push(1),color="0x"+tmp[1],new THREE.MeshLambertMaterial({color:parseInt(color),opacity:parseFloat(tmp[2])});if(0==f.indexOf("M1"))return tmp=f.split("_"),color="0x"+tmp[1],new THREE.MeshBasicMaterial({color:parseInt(color),wireframe:!0,opacity:1})};return{makeMaterial:function(f){return v(f)},makeMultiMaterial:function(f){var p;if(0==f.length)p=[];else{p=[];for(var u=[],u=0>f.indexOf(";")?[f]:f.split(";"),f=0;f<u.length;f++){var c=v(u[f]);
c&&p.push(c)}}return p}}};
